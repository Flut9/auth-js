parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"kqQd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ROOT_FORM=void 0;var e=document.getElementById("form");exports.ROOT_FORM=e;
},{}],"chA2":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];Object.defineProperty(exports,"__esModule",{value:!0}),exports.Sha1=exports.RANDOM_FACTOR=exports.MAX_VALUE_MILLIS=exports.FirebaseError=exports.ErrorFactory=exports.Deferred=exports.CONSTANTS=void 0,exports.areCookiesEnabled=T,exports.assertionError=exports.assert=void 0,exports.async=tt,exports.base64urlEncodeWithoutPadding=exports.base64Encode=exports.base64Decode=exports.base64=void 0,exports.calculateBackoffMillis=dt,exports.contains=F,exports.createMockUserToken=d,exports.createSubscribe=Y,exports.decode=void 0,exports.deepCopy=u,exports.deepEqual=H,exports.deepExtend=f,exports.errorPrefix=st,exports.extractQuerystring=X,exports.getGlobal=D,exports.getModularInstance=yt,exports.getUA=b,exports.isAdmin=void 0,exports.isBrowser=x,exports.isBrowserExtension=g,exports.isElectron=v,exports.isEmpty=$,exports.isIE=A,exports.isIndexedDBAvailable=C,exports.isMobileCordova=_,exports.isNode=y,exports.isNodeSdk=S,exports.isReactNative=E,exports.isSafari=O,exports.isUWP=m,exports.issuedAtTime=exports.isValidTimestamp=exports.isValidFormat=void 0,exports.jsonEval=I,exports.map=J,exports.ordinal=bt,exports.querystring=G,exports.querystringDecode=K,exports.safeGet=z,exports.stringToByteArray=exports.stringLength=void 0,exports.stringify=P,exports.validateArgCount=void 0,exports.validateCallback=it,exports.validateContextObject=ct,exports.validateIndexedDBOpenable=w,exports.validateNamespace=nt;const e={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};exports.CONSTANTS=e;const r=function(t,e){if(!t)throw o(e)};exports.assert=r;const o=function(t){return new Error("Firebase Database ("+e.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};exports.assertionError=o;const s=function(t){const e=[];let r=0;for(let o=0;o<t.length;o++){let s=t.charCodeAt(o);s<128?e[r++]=s:s<2048?(e[r++]=s>>6|192,e[r++]=63&s|128):55296==(64512&s)&&o+1<t.length&&56320==(64512&t.charCodeAt(o+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++o)),e[r++]=s>>18|240,e[r++]=s>>12&63|128,e[r++]=s>>6&63|128,e[r++]=63&s|128):(e[r++]=s>>12|224,e[r++]=s>>6&63|128,e[r++]=63&s|128)}return e},n=function(t){const e=[];let r=0,o=0;for(;r<t.length;){const s=t[r++];if(s<128)e[o++]=String.fromCharCode(s);else if(s>191&&s<224){const n=t[r++];e[o++]=String.fromCharCode((31&s)<<6|63&n)}else if(s>239&&s<365){const n=((7&s)<<18|(63&t[r++])<<12|(63&t[r++])<<6|63&t[r++])-65536;e[o++]=String.fromCharCode(55296+(n>>10)),e[o++]=String.fromCharCode(56320+(1023&n))}else{const n=t[r++],i=t[r++];e[o++]=String.fromCharCode((15&s)<<12|(63&n)<<6|63&i)}}return e.join("")},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let s=0;s<t.length;s+=3){const e=t[s],n=s+1<t.length,i=n?t[s+1]:0,c=s+2<t.length,a=c?t[s+2]:0,h=e>>2,u=(3&e)<<4|i>>4;let f=(15&i)<<2|a>>6,l=63&a;c||(l=64,n||(f=64)),o.push(r[h],r[u],r[f],r[l])}return o.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(s(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):n(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let s=0;s<t.length;){const e=r[t.charAt(s++)],n=s<t.length?r[t.charAt(s)]:0,i=++s<t.length?r[t.charAt(s)]:64,c=++s<t.length?r[t.charAt(s)]:64;if(++s,null==e||null==n||null==i||null==c)throw Error();const a=e<<2|n>>4;if(o.push(a),64!==i){const t=n<<4&240|i>>2;if(o.push(t),64!==c){const t=i<<6&192|c;o.push(t)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};exports.base64=i;const c=function(t){const e=s(t);return i.encodeByteArray(e,!0)};exports.base64Encode=c;const a=function(t){return c(t).replace(/\./g,"")};exports.base64urlEncodeWithoutPadding=a;const h=function(t){try{return i.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function u(t){return f(void 0,t)}function f(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(const r in e)e.hasOwnProperty(r)&&l(r)&&(t[r]=f(t[r],e[r]));return t}function l(t){return"__proto__"!==t}exports.base64Decode=h;class p{constructor(){this.reject=(()=>{}),this.resolve=(()=>{}),this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),"function"==typeof t&&(this.promise.catch(()=>{}),1===t.length?t(e):t(e,r))}}}function d(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r=e||"demo-project",o=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const n=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:o,exp:o+3600,auth_time:o,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(n)),""].join(".")}function b(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function _(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(b())}function y(){try{return"[object process]"===Object.prototype.toString.call(t.process)}catch(e){return!1}}function x(){return"object"==typeof self&&self.self===self}function g(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function E(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function v(){return b().indexOf("Electron/")>=0}function A(){const t=b();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function m(){return b().indexOf("MSAppHost/")>=0}function S(){return!0===e.NODE_CLIENT||!0===e.NODE_ADMIN}function O(){return!y()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function C(){return"object"==typeof indexedDB}function w(){return new Promise((t,e)=>{try{let o=!0;const s="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(s);n.onsuccess=(()=>{n.result.close(),o||self.indexedDB.deleteDatabase(s),t(!0)}),n.onupgradeneeded=(()=>{o=!1}),n.onerror=(()=>{var t;e((null===(t=n.error)||void 0===t?void 0:t.message)||"")})}catch(r){e(r)}})}function T(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}function D(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("Unable to locate global object.")}exports.Deferred=p;const N="FirebaseError";class M extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=N,Object.setPrototypeOf(this,M.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,j.prototype.create)}}exports.FirebaseError=M;class j{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){const r=e[0]||{},o=`${this.service}/${t}`,s=this.errors[t],n=s?k(s,r):"Error",i=`${this.serviceName}: ${n} (${o}).`;return new M(o,i,r)}}function k(t,e){return t.replace(B,(t,r)=>{const o=e[r];return null!=o?String(o):`<${r}?>`})}exports.ErrorFactory=j;const B=/\{\$([^}]+)}/g;function I(t){return JSON.parse(t)}function P(t){return JSON.stringify(t)}const L=function(t){let e={},r={},o={},s="";try{const i=t.split(".");e=I(h(i[0])||""),r=I(h(i[1])||""),s=i[2],o=r.d||{},delete r.d}catch(n){}return{header:e,claims:r,data:o,signature:s}};exports.decode=L;const V=function(t){const e=L(t).claims,r=Math.floor((new Date).getTime()/1e3);let o=0,s=0;return"object"==typeof e&&(e.hasOwnProperty("nbf")?o=e.nbf:e.hasOwnProperty("iat")&&(o=e.iat),s=e.hasOwnProperty("exp")?e.exp:o+86400),!!r&&!!o&&!!s&&r>=o&&r<=s};exports.isValidTimestamp=V;const R=function(t){const e=L(t).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null};exports.issuedAtTime=R;const W=function(t){const e=L(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")};exports.isValidFormat=W;const U=function(t){const e=L(t).claims;return"object"==typeof e&&!0===e.admin};function F(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function z(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function $(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function J(t,e,r){const o={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(o[s]=e.call(r,t[s],s,t));return o}function H(t,e){if(t===e)return!0;const r=Object.keys(t),o=Object.keys(e);for(const s of r){if(!o.includes(s))return!1;const r=t[s],n=e[s];if(q(r)&&q(n)){if(!H(r,n))return!1}else if(r!==n)return!1}for(const s of o)if(!r.includes(s))return!1;return!0}function q(t){return null!==t&&"object"==typeof t}function G(t){const e=[];for(const[r,o]of Object.entries(t))Array.isArray(o)?o.forEach(t=>{e.push(encodeURIComponent(r)+"="+encodeURIComponent(t))}):e.push(encodeURIComponent(r)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function K(t){const e={};return t.replace(/^\?/,"").split("&").forEach(t=>{if(t){const[r,o]=t.split("=");e[decodeURIComponent(r)]=decodeURIComponent(o)}}),e}function X(t){const e=t.indexOf("?");if(!e)return"";const r=t.indexOf("#",e);return t.substring(e,r>0?r:void 0)}exports.isAdmin=U;class Q{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);const r=this.W_;if("string"==typeof t)for(let u=0;u<16;u++)r[u]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let u=0;u<16;u++)r[u]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let u=16;u<80;u++){const t=r[u-3]^r[u-8]^r[u-14]^r[u-16];r[u]=4294967295&(t<<1|t>>>31)}let o,s,n=this.chain_[0],i=this.chain_[1],c=this.chain_[2],a=this.chain_[3],h=this.chain_[4];for(let u=0;u<80;u++){u<40?u<20?(o=a^i&(c^a),s=1518500249):(o=i^c^a,s=1859775393):u<60?(o=i&c|a&(i|c),s=2400959708):(o=i^c^a,s=3395469782);const t=(n<<5|n>>>27)+o+h+s+r[u]&4294967295;h=a,a=c,c=4294967295&(i<<30|i>>>2),i=n,n=t}this.chain_[0]=this.chain_[0]+n&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295}update(t,e){if(null==t)return;void 0===e&&(e=t.length);const r=e-this.blockSize;let o=0;const s=this.buf_;let n=this.inbuf_;for(;o<e;){if(0===n)for(;o<=r;)this.compress_(t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(s[n]=t.charCodeAt(o),++o,++n===this.blockSize){this.compress_(s),n=0;break}}else for(;o<e;)if(s[n]=t[o],++o,++n===this.blockSize){this.compress_(s),n=0;break}}this.inbuf_=n,this.total_+=e}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let o=this.blockSize-1;o>=56;o--)this.buf_[o]=255&e,e/=256;this.compress_(this.buf_);let r=0;for(let o=0;o<5;o++)for(let e=24;e>=0;e-=8)t[r]=this.chain_[o]>>e&255,++r;return t}}function Y(t,e){const r=new Z(t,e);return r.subscribe.bind(r)}exports.Sha1=Q;class Z{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(t=>{this.error(t)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,r){let o;if(void 0===t&&void 0===e&&void 0===r)throw new Error("Missing Observer.");void 0===(o=et(t,["next","error","complete"])?t:{next:t,error:e,complete:r}).next&&(o.next=rt),void 0===o.error&&(o.error=rt),void 0===o.complete&&(o.complete=rt);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?o.error(this.finalError):o.complete()}catch(t){}}),this.observers.push(o),s}unsubscribeOne(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[t])try{e(this.observers[t])}catch(r){"undefined"!=typeof console&&console.error&&console.error(r)}})}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function tt(t,e){return(...r)=>{Promise.resolve(!0).then(()=>{t(...r)}).catch(t=>{e&&e(t)})}}function et(t,e){if("object"!=typeof t||null===t)return!1;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}function rt(){}const ot=function(t,e,r,o){let s;if(o<e?s="at least "+e:o>r&&(s=0===r?"none":"no more than "+r),s){throw new Error(t+" failed: Was called with "+o+(1===o?" argument.":" arguments.")+" Expects "+s+".")}};function st(t,e){return`${t} failed: ${e} argument `}function nt(t,e,r){if((!r||e)&&"string"!=typeof e)throw new Error(st(t,"namespace")+"must be a valid firebase namespace.")}function it(t,e,r,o){if((!o||r)&&"function"!=typeof r)throw new Error(st(t,e)+"must be a valid function.")}function ct(t,e,r,o){if((!o||r)&&("object"!=typeof r||null===r))throw new Error(st(t,e)+"must be a valid context object.")}exports.validateArgCount=ot;const at=function(t){const e=[];let o=0;for(let s=0;s<t.length;s++){let n=t.charCodeAt(s);if(n>=55296&&n<=56319){const e=n-55296;r(++s<t.length,"Surrogate pair missing trail surrogate."),n=65536+(e<<10)+(t.charCodeAt(s)-56320)}n<128?e[o++]=n:n<2048?(e[o++]=n>>6|192,e[o++]=63&n|128):n<65536?(e[o++]=n>>12|224,e[o++]=n>>6&63|128,e[o++]=63&n|128):(e[o++]=n>>18|240,e[o++]=n>>12&63|128,e[o++]=n>>6&63|128,e[o++]=63&n|128)}return e};exports.stringToByteArray=at;const ht=function(t){let e=0;for(let r=0;r<t.length;r++){const o=t.charCodeAt(r);o<128?e++:o<2048?e+=2:o>=55296&&o<=56319?(e+=4,r++):e+=3}return e};exports.stringLength=ht;const ut=1e3,ft=2,lt=144e5;exports.MAX_VALUE_MILLIS=lt;const pt=.5;function dt(t,e=ut,r=ft){const o=e*Math.pow(r,t),s=Math.round(pt*o*(Math.random()-.5)*2);return Math.min(lt,o+s)}function bt(t){return Number.isFinite(t)?t+_t(t):`${t}`}function _t(t){const e=(t=Math.abs(t))%100;if(e>=10&&e<=20)return"th";const r=t%10;return 1===r?"st":2===r?"nd":3===r?"rd":"th"}function yt(t){return t&&t._delegate?t._delegate:t}exports.RANDOM_FACTOR=pt;
},{}],"vhY9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Provider=exports.ComponentContainer=exports.Component=void 0;var t=require("@firebase/util");class e{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}exports.Component=e;const n="[DEFAULT]";class i{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const e=new t.Deferred;if(this.instancesDeferred.set(n,e),this.isInitialized(n)||this.shouldAutoInitialize())try{const t=this.getOrInitializeService({instanceIdentifier:n});t&&e.resolve(t)}catch(i){}}return this.instancesDeferred.get(n).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),i=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(i)return null;throw s}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(r(t))try{this.getOrInitializeService({instanceIdentifier:n})}catch(e){}for(const[t,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:i});n.resolve(t)}catch(e){}}}}clearInstance(t=n){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...t.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return null!=this.component}isInitialized(t=n){return this.instances.has(t)}getOptions(t=n){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[s,r]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(s)&&r.resolve(i)}return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&t(r,i),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch(i){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:s(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(i){}return n||null}normalizeInstanceIdentifier(t=n){return this.component?this.component.multipleInstances?t:n:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function s(t){return t===n?void 0:t}function r(t){return"EAGER"===t.instantiationMode}exports.Provider=i;class o{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new i(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}exports.ComponentContainer=o;
},{"@firebase/util":"chA2"}],"JJem":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Logger=exports.LogLevel=void 0,exports.setLogLevel=i,exports.setUserLogHandler=g;const e=[];var r;exports.LogLevel=r,function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(exports.LogLevel=r={}));const t={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},o=r.INFO,l={[r.DEBUG]:"log",[r.VERBOSE]:"log",[r.INFO]:"info",[r.WARN]:"warn",[r.ERROR]:"error"},s=(e,r,...t)=>{if(r<e.logLevel)return;const o=(new Date).toISOString(),s=l[r];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${r})`);console[s](`[${o}]  ${e.name}:`,...t)};class n{constructor(r){this.name=r,this._logLevel=o,this._logHandler=s,this._userLogHandler=null,e.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in r))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?t[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,r.DEBUG,...e),this._logHandler(this,r.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,r.VERBOSE,...e),this._logHandler(this,r.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,r.INFO,...e),this._logHandler(this,r.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,r.WARN,...e),this._logHandler(this,r.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,r.ERROR,...e),this._logHandler(this,r.ERROR,...e)}}function i(r){e.forEach(e=>{e.setLogLevel(r)})}function g(o,l){for(const s of e){let e=null;l&&l.level&&(e=t[l.level]),s.userLogHandler=null===o?null:(t,l,...s)=>{const n=s.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(r){return null}}).filter(e=>e).join(" ");l>=(null!=e?e:t.logLevel)&&o({level:r[l].toLowerCase(),message:n,args:s,type:t.name})}}}exports.Logger=n;
},{}],"F1qz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.i=exports.a=void 0,exports.r=v,exports.u=void 0,exports.w=I;const e=(e,t)=>t.some(t=>e instanceof t);let t,r;function n(){return t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function o(){return r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}exports.i=e;const s=new WeakMap,i=new WeakMap,a=new WeakMap,c=new WeakMap,u=new WeakMap;function p(e){const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{t(I(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&s.set(t,e)}).catch(()=>{}),u.set(t,e),t}function f(e){if(i.has(e))return;const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)});i.set(e,t)}exports.a=u;let d={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return i.get(e);if("objectStoreNames"===t)return e.objectStoreNames||a.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return I(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function v(e){d=e(d)}function D(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?o().includes(e)?function(...t){return e.apply(B(this),t),I(s.get(this))}:function(...t){return I(e.apply(B(this),t))}:function(t,...r){const n=e.call(B(this),t,...r);return a.set(n,t.sort?t.sort():[t]),I(n)}}function m(t){return"function"==typeof t?D(t):(t instanceof IDBTransaction&&f(t),e(t,n())?new Proxy(t,d):t)}function I(e){if(e instanceof IDBRequest)return p(e);if(c.has(e))return c.get(e);const t=m(e);return t!==e&&(c.set(e,t),u.set(t,e)),t}const B=e=>u.get(e);exports.u=B;
},{}],"JZvK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.deleteDB=n,exports.openDB=t,Object.defineProperty(exports,"unwrap",{enumerable:!0,get:function(){return e.u}}),Object.defineProperty(exports,"wrap",{enumerable:!0,get:function(){return e.w}});var e=require("./wrap-idb-value.js");function t(t,n,{blocked:r,upgrade:o,blocking:d,terminated:i}={}){const s=indexedDB.open(t,n),a=(0,e.w)(s);return o&&s.addEventListener("upgradeneeded",t=>{o((0,e.w)(s.result),t.oldVersion,t.newVersion,(0,e.w)(s.transaction))}),r&&s.addEventListener("blocked",()=>r()),a.then(e=>{i&&e.addEventListener("close",()=>i()),d&&e.addEventListener("versionchange",()=>d())}).catch(()=>{}),a}function n(t,{blocked:n}={}){const r=indexedDB.deleteDatabase(t);return n&&r.addEventListener("blocked",()=>n()),(0,e.w)(r).then(()=>void 0)}const r=["get","getKey","getAll","getAllKeys","count"],o=["put","add","delete","clear"],d=new Map;function i(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(d.get(t))return d.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=o.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!r.includes(n))return;const a=async function(e,...t){const r=this.transaction(e,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&r.done]))[0]};return d.set(t,a),a}(0,e.r)(e=>({...e,get:(t,n,r)=>i(t,n)||e.get(t,n,r),has:(t,n)=>!!i(t,n)||e.has(t,n)}));
},{"./wrap-idb-value.js":"F1qz"}],"h2Mb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"FirebaseError",{enumerable:!0,get:function(){return a.FirebaseError}}),exports._DEFAULT_ENTRY_NAME=exports.SDK_VERSION=void 0,exports._addComponent=M,exports._addOrOverwriteComponent=B,exports._apps=void 0,exports._clearComponents=V,exports._components=void 0,exports._getProvider=U,exports._registerComponent=T,exports._removeServiceInstance=R,exports.deleteApp=Q,exports.getApp=Y,exports.getApps=G,exports.initializeApp=W,exports.onLog=Z,exports.registerVersion=X,exports.setLogLevel=ee;var e=require("@firebase/component"),t=require("@firebase/logger"),a=require("@firebase/util"),r=require("idb");class n{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(s(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}function s(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}const i="@firebase/app",o="0.7.26",c=new t.Logger("@firebase/app"),p="@firebase/app-compat",h="@firebase/analytics-compat",l="@firebase/analytics",f="@firebase/app-check-compat",d="@firebase/app-check",g="@firebase/auth",b="@firebase/auth-compat",u="@firebase/database",m="@firebase/database-compat",_="@firebase/functions",w="@firebase/functions-compat",v="@firebase/installations",C="@firebase/installations-compat",D="@firebase/messaging",E="@firebase/messaging-compat",y="@firebase/performance",x="@firebase/performance-compat",S="@firebase/remote-config",I="@firebase/remote-config-compat",P="@firebase/storage",O="@firebase/storage-compat",$="@firebase/firestore",A="@firebase/firestore-compat",N="firebase",j="9.8.3",k="[DEFAULT]";exports._DEFAULT_ENTRY_NAME=k;const F={[i]:"fire-core",[p]:"fire-core-compat",[l]:"fire-analytics",[h]:"fire-analytics-compat",[d]:"fire-app-check",[f]:"fire-app-check-compat",[g]:"fire-auth",[b]:"fire-auth-compat",[u]:"fire-rtdb",[m]:"fire-rtdb-compat",[_]:"fire-fn",[w]:"fire-fn-compat",[v]:"fire-iid",[C]:"fire-iid-compat",[D]:"fire-fcm",[E]:"fire-fcm-compat",[y]:"fire-perf",[x]:"fire-perf-compat",[S]:"fire-rc",[I]:"fire-rc-compat",[P]:"fire-gcs",[O]:"fire-gcs-compat",[$]:"fire-fst",[A]:"fire-fst-compat","fire-js":"fire-js",[N]:"fire-js-all"},H=new Map;exports._apps=H;const L=new Map;function M(e,t){try{e.container.addComponent(t)}catch(a){c.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,a)}}function B(e,t){e.container.addOrOverwriteComponent(t)}function T(e){const t=e.name;if(L.has(t))return c.debug(`There were multiple attempts to register component ${t}.`),!1;L.set(t,e);for(const a of H.values())M(a,e);return!0}function U(e,t){const a=e.container.getProvider("heartbeat").getImmediate({optional:!0});return a&&a.triggerHeartbeat(),e.container.getProvider(t)}function R(e,t,a=k){U(e,t).clearInstance(a)}function V(){L.clear()}exports._components=L;const q={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."},z=new a.ErrorFactory("app","Firebase",q);class J{constructor(t,a,r){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},a),this._name=a.name,this._automaticDataCollectionEnabled=a.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new e.Component("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw z.create("app-deleted",{appName:this._name})}}const K="9.8.3";function W(t,r={}){if("object"!=typeof r){r={name:r}}const n=Object.assign({name:k,automaticDataCollectionEnabled:!1},r),s=n.name;if("string"!=typeof s||!s)throw z.create("bad-app-name",{appName:String(s)});const i=H.get(s);if(i){if((0,a.deepEqual)(t,i.options)&&(0,a.deepEqual)(n,i.config))return i;throw z.create("duplicate-app",{appName:s})}const o=new e.ComponentContainer(s);for(const e of L.values())o.addComponent(e);const c=new J(t,n,o);return H.set(s,c),c}function Y(e=k){const t=H.get(e);if(!t)throw z.create("no-app",{appName:e});return t}function G(){return Array.from(H.values())}async function Q(e){const t=e.name;H.has(t)&&(H.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function X(t,a,r){var n;let s=null!==(n=F[t])&&void 0!==n?n:t;r&&(s+=`-${r}`);const i=s.match(/\s|\//),o=a.match(/\s|\//);if(i||o){const e=[`Unable to register library "${s}" with version "${a}":`];return i&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&e.push("and"),o&&e.push(`version name "${a}" contains illegal characters (whitespace or "/")`),void c.warn(e.join(" "))}T(new e.Component(`${s}-version`,()=>({library:s,version:a}),"VERSION"))}function Z(e,a){if(null!==e&&"function"!=typeof e)throw z.create("invalid-log-argument");(0,t.setUserLogHandler)(e,a)}function ee(e){(0,t.setLogLevel)(e)}exports.SDK_VERSION="9.8.3";const te="firebase-heartbeat-database",ae=1,re="firebase-heartbeat-store";let ne=null;function se(){return ne||(ne=(0,r.openDB)(te,ae,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(re)}}}).catch(e=>{throw z.create("storage-open",{originalErrorMessage:e.message})})),ne}async function ie(e){var t;try{return(await se()).transaction(re).objectStore(re).get(ce(e))}catch(a){throw z.create("storage-get",{originalErrorMessage:null===(t=a)||void 0===t?void 0:t.message})}}async function oe(e,t){var a;try{const n=(await se()).transaction(re,"readwrite"),s=n.objectStore(re);return await s.put(t,ce(e)),n.done}catch(r){throw z.create("storage-set",{originalErrorMessage:null===(a=r)||void 0===a?void 0:a.message})}}function ce(e){return`${e.name}!${e.options.appId}`}const pe=1024,he=2592e6;class le{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ge(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=fe();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some(e=>e.date===t))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=he}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=fe(),{heartbeatsToSend:t,unsentEntries:r}=de(this._heartbeatsCache.heartbeats),n=(0,a.base64urlEncodeWithoutPadding)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}}function fe(){return(new Date).toISOString().substring(0,10)}function de(e,t=pe){const a=[];let r=e.slice();for(const n of e){const e=a.find(e=>e.agent===n.agent);if(e){if(e.dates.push(n.date),be(a)>t){e.dates.pop();break}}else if(a.push({agent:n.agent,dates:[n.date]}),be(a)>t){a.pop();break}r=r.slice(1)}return{heartbeatsToSend:a,unsentEntries:r}}class ge{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,a.isIndexedDBAvailable)()&&(0,a.validateIndexedDBOpenable)().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){return await ie(this.app)||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return oe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:a.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return oe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...e.heartbeats]})}}}function be(e){return(0,a.base64urlEncodeWithoutPadding)(JSON.stringify({version:2,heartbeats:e})).length}function ue(t){T(new e.Component("platform-logger",e=>new n(e),"PRIVATE")),T(new e.Component("heartbeat",e=>new le(e),"PRIVATE")),X(i,o,t),X(i,o,"esm2017"),X("fire-js","")}ue("");
},{"@firebase/component":"vhY9","@firebase/logger":"JJem","@firebase/util":"chA2","idb":"JZvK"}],"qQDx":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStatEventTarget=exports.default=exports.createWebChannelTransport=exports.XhrIo=exports.WebChannel=exports.Stat=exports.FetchXmlHttpFactory=exports.EventType=exports.Event=exports.ErrorCode=void 0;var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},i={};exports.default=i;var n,s=s||{},r=e||self;function o(){}function h(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function a(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function l(t){return Object.prototype.hasOwnProperty.call(t,u)&&t[u]||(t[u]=++c)}var u="closure_uid_"+(1e9*Math.random()>>>0),c=0;function f(t,e,i){return t.call.apply(t.bind,arguments)}function g(t,e,i){if(!t)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,n),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function p(t,e,i){return(p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?f:g).apply(null,arguments)}function d(t,e){var i=Array.prototype.slice.call(arguments,1);return function(){var e=i.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function v(t,e){function i(){}i.prototype=e.prototype,t.Z=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.Vb=function(t,i,n){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return e.prototype[i].apply(t,s)}}function y(){this.s=this.s,this.o=this.o}var m=0,b={};y.prototype.s=!1,y.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0!=m)){var t=l(this);delete b[t]}},y.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const w=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let i=0;i<t.length;i++)if(i in t&&t[i]===e)return i;return-1},T=Array.prototype.forEach?function(t,e,i){Array.prototype.forEach.call(t,e,i)}:function(t,e,i){const n=t.length,s="string"==typeof t?t.split(""):t;for(let r=0;r<n;r++)r in s&&e.call(i,s[r],r,t)};function E(t){t:{var e=Bi;const i=t.length,n="string"==typeof t?t.split(""):t;for(let s=0;s<i;s++)if(s in n&&e.call(void 0,n[s],s,t)){e=s;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}function S(t){return Array.prototype.concat.apply([],arguments)}function x(t){const e=t.length;if(0<e){const i=Array(e);for(let n=0;n<e;n++)i[n]=t[n];return i}return[]}function j(t){return/^[\s\xa0]*$/.test(t)}var C,I=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function A(t,e){return-1!=t.indexOf(e)}function R(t,e){return t<e?-1:t>e?1:0}t:{var O=r.navigator;if(O){var P=O.userAgent;if(P){C=P;break t}}C=""}function D(t,e,i){for(const n in t)e.call(i,t[n],n,t)}function M(t){const e={};for(const i in t)e[i]=t[i];return e}var L="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function X(t,e){let i,n;for(let s=1;s<arguments.length;s++){for(i in n=arguments[s])t[i]=n[i];for(let e=0;e<L.length;e++)i=L[e],Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}}function H(t){return H[" "](t),t}function k(t){var e=q;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}H[" "]=o;var _,B=A(C,"Opera"),F=A(C,"Trident")||A(C,"MSIE"),N=A(C,"Edge"),U=N||F,K=A(C,"Gecko")&&!(A(C.toLowerCase(),"webkit")&&!A(C,"Edge"))&&!(A(C,"Trident")||A(C,"MSIE"))&&!A(C,"Edge"),Y=A(C.toLowerCase(),"webkit")&&!A(C,"Edge");function G(){var t=r.document;return t?t.documentMode:void 0}t:{var J="",W=function(){var t=C;return K?/rv:([^\);]+)(\)|;)/.exec(t):N?/Edge\/([\d\.]+)/.exec(t):F?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t):Y?/WebKit\/(\S+)/.exec(t):B?/(?:Version)[ \/]?(\S+)/.exec(t):void 0}();if(W&&(J=W?W[1]:""),F){var V=G();if(null!=V&&V>parseFloat(J)){_=String(V);break t}}_=J}var $,q={};function z(){return k(function(){let t=0;const e=I(String(_)).split("."),i=I("9").split("."),n=Math.max(e.length,i.length);for(let o=0;0==t&&o<n;o++){var s=e[o]||"",r=i[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==s[0].length&&0==r[0].length)break;t=R(0==s[1].length?0:parseInt(s[1],10),0==r[1].length?0:parseInt(r[1],10))||R(0==s[2].length,0==r[2].length)||R(s[2],r[2]),s=s[3],r=r[3]}while(0==t)}return 0<=t})}if(r.document&&F){var Z=G();$=Z||(parseInt(_,10)||void 0)}else $=void 0;var Q=$,tt=function(){if(!r.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{r.addEventListener("test",o,e),r.removeEventListener("test",o,e)}catch(i){}return t}();function et(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function it(t,e){if(et.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var i=this.type=t.type,n=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(K){t:{try{H(e.nodeName);var s=!0;break t}catch(r){}s=!1}s||(e=null)}}else"mouseover"==i?e=t.fromElement:"mouseout"==i&&(e=t.toElement);this.relatedTarget=e,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:nt[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&it.Z.h.call(this)}}et.prototype.h=function(){this.defaultPrevented=!0},v(it,et);var nt={2:"touch",3:"pen",4:"mouse"};it.prototype.h=function(){it.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var st="closure_listenable_"+(1e6*Math.random()|0),rt=0;function ot(t,e,i,n,s){this.listener=t,this.proxy=null,this.src=e,this.type=i,this.capture=!!n,this.ia=s,this.key=++rt,this.ca=this.fa=!1}function ht(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function at(t){this.src=t,this.g={},this.h=0}function lt(t,e){var i=e.type;if(i in t.g){var n,s=t.g[i],r=w(s,e);(n=0<=r)&&Array.prototype.splice.call(s,r,1),n&&(ht(e),0==t.g[i].length&&(delete t.g[i],t.h--))}}function ut(t,e,i,n){for(var s=0;s<t.length;++s){var r=t[s];if(!r.ca&&r.listener==e&&r.capture==!!i&&r.ia==n)return s}return-1}at.prototype.add=function(t,e,i,n,s){var r=t.toString();(t=this.g[r])||(t=this.g[r]=[],this.h++);var o=ut(t,e,n,s);return-1<o?(e=t[o],i||(e.fa=!1)):((e=new ot(e,this.src,r,!!n,s)).fa=i,t.push(e)),e};var ct="closure_lm_"+(1e6*Math.random()|0),ft={};function gt(t,e,i,n,s){if(n&&n.once)return vt(t,e,i,n,s);if(Array.isArray(e)){for(var r=0;r<e.length;r++)gt(t,e[r],i,n,s);return null}return i=St(i),t&&t[st]?t.N(e,i,a(n)?!!n.capture:!!n,s):pt(t,e,i,!1,n,s)}function pt(t,e,i,n,s,r){if(!e)throw Error("Invalid event type");var o=a(s)?!!s.capture:!!s,h=Tt(t);if(h||(t[ct]=h=new at(t)),(i=h.add(e,i,n,o,r)).proxy)return i;if(n=dt(),i.proxy=n,n.src=t,n.listener=i,t.addEventListener)tt||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),n,s);else if(t.attachEvent)t.attachEvent(bt(e.toString()),n);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(n)}return i}function dt(){var t=wt;return function e(i){return t.call(e.src,e.listener,i)}}function vt(t,e,i,n,s){if(Array.isArray(e)){for(var r=0;r<e.length;r++)vt(t,e[r],i,n,s);return null}return i=St(i),t&&t[st]?t.O(e,i,a(n)?!!n.capture:!!n,s):pt(t,e,i,!0,n,s)}function yt(t,e,i,n,s){if(Array.isArray(e))for(var r=0;r<e.length;r++)yt(t,e[r],i,n,s);else n=a(n)?!!n.capture:!!n,i=St(i),t&&t[st]?(t=t.i,(e=String(e).toString())in t.g&&(-1<(i=ut(r=t.g[e],i,n,s))&&(ht(r[i]),Array.prototype.splice.call(r,i,1),0==r.length&&(delete t.g[e],t.h--)))):t&&(t=Tt(t))&&(e=t.g[e.toString()],t=-1,e&&(t=ut(e,i,n,s)),(i=-1<t?e[t]:null)&&mt(i))}function mt(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[st])lt(e.i,t);else{var i=t.type,n=t.proxy;e.removeEventListener?e.removeEventListener(i,n,t.capture):e.detachEvent?e.detachEvent(bt(i),n):e.addListener&&e.removeListener&&e.removeListener(n),(i=Tt(e))?(lt(i,t),0==i.h&&(i.src=null,e[ct]=null)):ht(t)}}}function bt(t){return t in ft?ft[t]:ft[t]="on"+t}function wt(t,e){if(t.ca)t=!0;else{e=new it(e,this);var i=t.listener,n=t.ia||t.src;t.fa&&mt(t),t=i.call(n,e)}return t}function Tt(t){return(t=t[ct])instanceof at?t:null}var Et="__closure_events_fn_"+(1e9*Math.random()>>>0);function St(t){return"function"==typeof t?t:(t[Et]||(t[Et]=function(e){return t.handleEvent(e)}),t[Et])}function xt(){y.call(this),this.i=new at(this),this.P=this,this.I=null}function jt(t,e){var i,n=t.I;if(n)for(i=[];n;n=n.I)i.push(n);if(t=t.P,n=e.type||e,"string"==typeof e)e=new et(e,t);else if(e instanceof et)e.target=e.target||t;else{var s=e;X(e=new et(n,t),s)}if(s=!0,i)for(var r=i.length-1;0<=r;r--){var o=e.g=i[r];s=Ct(o,n,!0,e)&&s}if(s=Ct(o=e.g=t,n,!0,e)&&s,s=Ct(o,n,!1,e)&&s,i)for(r=0;r<i.length;r++)s=Ct(o=e.g=i[r],n,!1,e)&&s}function Ct(t,e,i,n){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.ca&&o.capture==i){var h=o.listener,a=o.ia||o.src;o.fa&&lt(t.i,o),s=!1!==h.call(a,n)&&s}}return s&&!n.defaultPrevented}v(xt,y),xt.prototype[st]=!0,xt.prototype.removeEventListener=function(t,e,i,n){yt(this,t,e,i,n)},xt.prototype.M=function(){if(xt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var i=e.g[t],n=0;n<i.length;n++)ht(i[n]);delete e.g[t],e.h--}}this.I=null},xt.prototype.N=function(t,e,i,n){return this.i.add(String(t),e,!1,i,n)},xt.prototype.O=function(t,e,i,n){return this.i.add(String(t),e,!0,i,n)};var It=r.JSON.stringify;function At(){var t=kt;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}class Rt{constructor(){this.h=this.g=null}add(t,e){const i=Pt.get();i.set(t,e),this.h?this.h.next=i:this.g=i,this.h=i}}var Ot,Pt=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new Dt,t=>t.reset());class Dt{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Mt(t){r.setTimeout(()=>{throw t},0)}function Lt(t,e){Ot||Xt(),Ht||(Ot(),Ht=!0),kt.add(t,e)}function Xt(){var t=r.Promise.resolve(void 0);Ot=function(){t.then(_t)}}var Ht=!1,kt=new Rt;function _t(){for(var t;t=At();){try{t.h.call(t.g)}catch(i){Mt(i)}var e=Pt;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Ht=!1}function Bt(t,e){xt.call(this),this.h=t||1,this.g=e||r,this.j=p(this.kb,this),this.l=Date.now()}function Ft(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Nt(t,e,i){if("function"==typeof t)i&&(t=p(t,i));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=p(t.handleEvent,t)}return 2147483647<Number(e)?-1:r.setTimeout(t,e||0)}function Ut(t){t.g=Nt(()=>{t.g=null,t.i&&(t.i=!1,Ut(t))},t.j);const e=t.h;t.h=null,t.m.apply(null,e)}v(Bt,xt),(n=Bt.prototype).da=!1,n.S=null,n.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),jt(this,"tick"),this.da&&(Ft(this),this.start()))}},n.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},n.M=function(){Bt.Z.M.call(this),Ft(this),delete this.g};class Kt extends y{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Ut(this)}M(){super.M(),this.g&&(r.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Yt(t){y.call(this),this.h=t,this.g={}}v(Yt,y);var Gt=[];function Jt(t,e,i,n){Array.isArray(i)||(i&&(Gt[0]=i.toString()),i=Gt);for(var s=0;s<i.length;s++){var r=gt(e,i[s],n||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}}function Wt(t){D(t.g,function(t,e){this.g.hasOwnProperty(e)&&mt(t)},t),t.g={}}function Vt(){this.g=!0}function $t(t,e,i,n,s,r){t.info(function(){if(t.g)if(r)for(var o="",h=r.split("&"),a=0;a<h.length;a++){var l=h[a].split("=");if(1<l.length){var u=l[0];l=l[1];var c=u.split("_");o=2<=c.length&&"type"==c[1]?o+(u+"=")+l+"&":o+(u+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+n+") [attempt "+s+"]: "+e+"\n"+i+"\n"+o})}function qt(t,e,i,n,s,r,o){t.info(function(){return"XMLHTTP RESP ("+n+") [ attempt "+s+"]: "+e+"\n"+i+"\n"+r+" "+o})}function zt(t,e,i,n){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+Qt(t,i)+(n?" "+n:"")})}function Zt(t,e){t.info(function(){return"TIMEOUT: "+e})}function Qt(t,e){if(!t.g)return e;if(!e)return null;try{var i=JSON.parse(e);if(i)for(t=0;t<i.length;t++)if(Array.isArray(i[t])){var n=i[t];if(!(2>n.length)){var s=n[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<s.length;o++)s[o]=""}}}return It(i)}catch(h){return e}}Yt.prototype.M=function(){Yt.Z.M.call(this),Wt(this)},Yt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Vt.prototype.Aa=function(){this.g=!1},Vt.prototype.info=function(){};var te={},ee=null;function ie(){return ee=ee||new xt}function ne(t){et.call(this,te.Ma,t)}function se(t){const e=ie();jt(e,new ne(e,t))}function re(t,e){et.call(this,te.STAT_EVENT,t),this.stat=e}function oe(t){const e=ie();jt(e,new re(e,t))}function he(t,e){et.call(this,te.Na,t),this.size=e}function ae(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return r.setTimeout(function(){t()},e)}te.Ma="serverreachability",v(ne,et),te.STAT_EVENT="statevent",v(re,et),te.Na="timingevent",v(he,et);var le={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},ue={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function ce(){}function fe(t){return t.h||(t.h=t.i())}function ge(){}ce.prototype.h=null;var pe,de={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function ve(){et.call(this,"d")}function ye(){et.call(this,"c")}function me(){}function be(t,e,i,n){this.l=t,this.j=e,this.m=i,this.X=n||1,this.V=new Yt(this),this.P=Te,t=U?125:void 0,this.W=new Bt(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new we}function we(){this.i=null,this.g="",this.h=!1}v(ve,et),v(ye,et),v(me,ce),me.prototype.g=function(){return new XMLHttpRequest},me.prototype.i=function(){return{}},pe=new me;var Te=45e3,Ee={},Se={};function xe(t,e,i){t.K=1,t.v=$e(Ke(e)),t.s=i,t.U=!0,je(t,null)}function je(t,e){t.F=Date.now(),Re(t),t.A=Ke(t.v);var i=t.A,n=t.X;Array.isArray(n)||(n=[String(n)]),ui(i.h,"t",n),t.C=0,i=t.l.H,t.h=new we,t.g=yn(t.l,i?e:null,!t.s),0<t.O&&(t.L=new Kt(p(t.Ia,t,t.g),t.O)),Jt(t.V,t.g,"readystatechange",t.gb),e=t.H?M(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),se(1),$t(t.j,t.u,t.A,t.m,t.X,t.s)}function Ce(t){return!!t.g&&("GET"==t.u&&2!=t.K&&t.l.Ba)}function Ie(t,e,i){let n,s=!0;for(;!t.I&&t.C<i.length;){if((n=Ae(t,i))==Se){4==e&&(t.o=4,oe(14),s=!1),zt(t.j,t.m,null,"[Incomplete Response]");break}if(n==Ee){t.o=4,oe(15),zt(t.j,t.m,i,"[Invalid Chunk]"),s=!1;break}zt(t.j,t.m,n,null),Le(t,n)}Ce(t)&&n!=Se&&n!=Ee&&(t.h.g="",t.C=0),4!=e||0!=i.length||t.h.h||(t.o=1,oe(16),s=!1),t.i=t.i&&s,s?0<i.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+i.length),ln(e),e.L=!0,oe(11))):(zt(t.j,t.m,i,"[Invalid Chunked Response]"),Me(t),De(t))}function Ae(t,e){var i=t.C,n=e.indexOf("\n",i);return-1==n?Se:(i=Number(e.substring(i,n)),isNaN(i)?Ee:(n+=1)+i>e.length?Se:(e=e.substr(n,i),t.C=n+i,e))}function Re(t){t.Y=Date.now()+t.P,Oe(t,t.P)}function Oe(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=ae(p(t.eb,t),e)}function Pe(t){t.B&&(r.clearTimeout(t.B),t.B=null)}function De(t){0==t.l.G||t.I||fn(t.l,t)}function Me(t){Pe(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Ft(t.W),Wt(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Le(t,e){try{var i=t.l;if(0!=i.G&&(i.g==t||mi(i.i,t)))if(i.I=t.N,!t.J&&mi(i.i,t)&&3==i.G){try{var n=i.Ca.g.parse(e)}catch(l){n=null}if(Array.isArray(n)&&3==n.length){var s=n;if(0==s[0]){t:if(!i.u){if(i.g){if(!(i.g.F+3e3<t.F))break t;cn(i),Zi(i)}an(i),oe(18)}}else i.ta=s[1],0<i.ta-i.U&&37500>s[2]&&i.N&&0==i.A&&!i.v&&(i.v=ae(p(i.ab,i),6e3));if(1>=yi(i.i)&&i.ka){try{i.ka()}catch(l){}i.ka=void 0}}else pn(i,11)}else if((t.J||i.g==t)&&cn(i),!j(e))for(s=i.Ca.g.parse(e),e=0;e<s.length;e++){let l=s[e];if(i.U=l[0],l=l[1],2==i.G)if("c"==l[0]){i.J=l[1],i.la=l[2];const e=l[3];null!=e&&(i.ma=e,i.h.info("VER="+i.ma));const s=l[4];null!=s&&(i.za=s,i.h.info("SVER="+i.za));const u=l[5];null!=u&&"number"==typeof u&&0<u&&(n=1.5*u,i.K=n,i.h.info("backChannelRequestTimeoutMs_="+n)),n=i;const c=t.g;if(c){const t=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=n.i;!r.g&&(A(t,"spdy")||A(t,"quic")||A(t,"h2"))&&(r.j=r.l,r.g=new Set,r.h&&(bi(r,r.h),r.h=null))}if(n.D){const t=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(n.sa=t,Ve(n.F,n.D,t))}}i.G=3,i.j&&i.j.xa(),i.$&&(i.O=Date.now()-t.F,i.h.info("Handshake RTT: "+i.O+"ms"));var o=t;if((n=i).oa=vn(n,n.H?n.la:null,n.W),o.J){wi(n.i,o);var h=o,a=n.K;a&&h.setTimeout(a),h.B&&(Pe(h),Re(h)),n.g=o}else hn(n);0<i.l.length&&en(i)}else"stop"!=l[0]&&"close"!=l[0]||pn(i,7);else 3==i.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?pn(i,7):zi(i):"noop"!=l[0]&&i.j&&i.j.wa(l),i.A=0)}se(4)}catch(l){}}function Xe(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(h(t)){for(var e=[],i=t.length,n=0;n<i;n++)e.push(t[n]);return e}for(n in e=[],i=0,t)e[i++]=t[n];return e}function He(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(h(t)||"string"==typeof t)T(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var i=t.T();else if(t.R&&"function"==typeof t.R)i=void 0;else if(h(t)||"string"==typeof t){i=[];for(var n=t.length,s=0;s<n;s++)i.push(s)}else for(s in i=[],n=0,t)i[n++]=s;s=(n=Xe(t)).length;for(var r=0;r<s;r++)e.call(void 0,n[r],i&&i[r],t)}}function ke(t,e){this.h={},this.g=[],this.i=0;var i=arguments.length;if(1<i){if(i%2)throw Error("Uneven number of arguments");for(var n=0;n<i;n+=2)this.set(arguments[n],arguments[n+1])}else if(t)if(t instanceof ke)for(i=t.T(),n=0;n<i.length;n++)this.set(i[n],t.get(i[n]));else for(n in t)this.set(n,t[n])}function _e(t){if(t.i!=t.g.length){for(var e=0,i=0;e<t.g.length;){var n=t.g[e];Be(t.h,n)&&(t.g[i++]=n),e++}t.g.length=i}if(t.i!=t.g.length){var s={};for(i=e=0;e<t.g.length;)Be(s,n=t.g[e])||(t.g[i++]=n,s[n]=1),e++;t.g.length=i}}function Be(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(n=be.prototype).setTimeout=function(t){this.P=t},n.gb=function(t){t=t.target;const e=this.L;e&&3==Gi(t)?e.l():this.Ia(t)},n.Ia=function(t){try{if(t==this.g)t:{const c=Gi(this.g);var e=this.g.Da();const f=this.g.ba();if(!(3>c)&&(3!=c||U||this.g&&(this.h.h||this.g.ga()||Ji(this.g)))){this.I||4!=c||7==e||se(8==e||0>=f?3:2),Pe(this);var i=this.g.ba();this.N=i;e:if(Ce(this)){var n=Ji(this.g);t="";var s=n.length,o=4==Gi(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Me(this),De(this);var h="";break e}this.h.i=new r.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(n[e],{stream:o&&e==s-1});n.splice(0,s),this.h.g+=t,this.C=0,h=this.h.g}else h=this.g.ga();if(this.i=200==i,qt(this.j,this.u,this.A,this.m,this.X,c,i),this.i){if(this.$&&!this.J){e:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(a)){var u=a;break e}}u=null}if(!(i=u)){this.i=!1,this.o=3,oe(12),Me(this),De(this);break t}zt(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Le(this,i)}this.U?(Ie(this,c,h),U&&this.i&&3==c&&(Jt(this.V,this.W,"tick",this.fb),this.W.start())):(zt(this.j,this.m,h,null),Le(this,h)),4==c&&Me(this),this.i&&!this.I&&(4==c?fn(this.l,this):(this.i=!1,Re(this)))}else 400==i&&0<h.indexOf("Unknown SID")?(this.o=3,oe(12)):(this.o=0,oe(13)),Me(this),De(this)}}}catch(c){}},n.fb=function(){if(this.g){var t=Gi(this.g),e=this.g.ga();this.C<e.length&&(Pe(this),Ie(this,t,e),this.i&&4!=t&&Re(this))}},n.cancel=function(){this.I=!0,Me(this)},n.eb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(Zt(this.j,this.A),2!=this.K&&(se(3),oe(17)),Me(this),this.o=2,De(this)):Oe(this,this.Y-t)},(n=ke.prototype).R=function(){_e(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},n.T=function(){return _e(this),this.g.concat()},n.get=function(t,e){return Be(this.h,t)?this.h[t]:e},n.set=function(t,e){Be(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},n.forEach=function(t,e){for(var i=this.T(),n=0;n<i.length;n++){var s=i[n],r=this.get(s);t.call(e,r,s,this)}};var Fe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ne(t,e){if(t){t=t.split("&");for(var i=0;i<t.length;i++){var n=t[i].indexOf("="),s=null;if(0<=n){var r=t[i].substring(0,n);s=t[i].substring(n+1)}else r=t[i];e(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}function Ue(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Ue){this.g=void 0!==e?e:t.g,Ye(this,t.j),this.s=t.s,Ge(this,t.i),Je(this,t.m),this.l=t.l,e=t.h;var i=new oi;i.i=e.i,e.g&&(i.g=new ke(e.g),i.h=e.h),We(this,i),this.o=t.o}else t&&(i=String(t).match(Fe))?(this.g=!!e,Ye(this,i[1]||"",!0),this.s=Ze(i[2]||""),Ge(this,i[3]||"",!0),Je(this,i[4]),this.l=Ze(i[5]||"",!0),We(this,i[6]||"",!0),this.o=Ze(i[7]||"")):(this.g=!!e,this.h=new oi(null,this.g))}function Ke(t){return new Ue(t)}function Ye(t,e,i){t.j=i?Ze(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Ge(t,e,i){t.i=i?Ze(e,!0):e}function Je(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function We(t,e,i){e instanceof oi?(t.h=e,fi(t.h,t.g)):(i||(e=Qe(e,si)),t.h=new oi(e,t.g))}function Ve(t,e,i){t.h.set(e,i)}function $e(t){return Ve(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function qe(t){return t instanceof Ue?Ke(t):new Ue(t,void 0)}function ze(t,e,i,n){var s=new Ue(null,void 0);return t&&Ye(s,t),e&&Ge(s,e),i&&Je(s,i),n&&(s.l=n),s}function Ze(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Qe(t,e,i){return"string"==typeof t?(t=encodeURI(t).replace(e,ti),i&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ti(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ue.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Qe(e,ei,!0),":");var i=this.i;return(i||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Qe(e,ei,!0),"@"),t.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(i=this.m)&&t.push(":",String(i))),(i=this.l)&&(this.i&&"/"!=i.charAt(0)&&t.push("/"),t.push(Qe(i,"/"==i.charAt(0)?ni:ii,!0))),(i=this.h.toString())&&t.push("?",i),(i=this.o)&&t.push("#",Qe(i,ri)),t.join("")};var ei=/[#\/\?@]/g,ii=/[#\?:]/g,ni=/[#\?]/g,si=/[#\?@]/g,ri=/#/g;function oi(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function hi(t){t.g||(t.g=new ke,t.h=0,t.i&&Ne(t.i,function(e,i){t.add(decodeURIComponent(e.replace(/\+/g," ")),i)}))}function ai(t,e){hi(t),e=ci(t,e),Be(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Be((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&_e(t)))}function li(t,e){return hi(t),e=ci(t,e),Be(t.g.h,e)}function ui(t,e,i){ai(t,e),0<i.length&&(t.i=null,t.g.set(ci(t,e),x(i)),t.h+=i.length)}function ci(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function fi(t,e){e&&!t.j&&(hi(t),t.i=null,t.g.forEach(function(t,e){var i=e.toLowerCase();e!=i&&(ai(this,e),ui(this,i,t))},t)),t.j=e}(n=oi.prototype).add=function(t,e){hi(this),this.i=null,t=ci(this,t);var i=this.g.get(t);return i||this.g.set(t,i=[]),i.push(e),this.h+=1,this},n.forEach=function(t,e){hi(this),this.g.forEach(function(i,n){T(i,function(i){t.call(e,i,n,this)},this)},this)},n.T=function(){hi(this);for(var t=this.g.R(),e=this.g.T(),i=[],n=0;n<e.length;n++)for(var s=t[n],r=0;r<s.length;r++)i.push(e[n]);return i},n.R=function(t){hi(this);var e=[];if("string"==typeof t)li(this,t)&&(e=S(e,this.g.get(ci(this,t))));else{t=this.g.R();for(var i=0;i<t.length;i++)e=S(e,t[i])}return e},n.set=function(t,e){return hi(this),this.i=null,li(this,t=ci(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},n.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},n.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),i=0;i<e.length;i++){var n=e[i],s=encodeURIComponent(String(n));n=this.R(n);for(var r=0;r<n.length;r++){var o=s;""!==n[r]&&(o+="="+encodeURIComponent(String(n[r]))),t.push(o)}}return this.i=t.join("&")};var gi=class{constructor(t,e){this.h=t,this.g=e}};function pi(t){this.l=t||di,r.PerformanceNavigationTiming?t=0<(t=r.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(r.g&&r.g.Ea&&r.g.Ea()&&r.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var di=10;function vi(t){return!!t.h||!!t.g&&t.g.size>=t.j}function yi(t){return t.h?1:t.g?t.g.size:0}function mi(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function bi(t,e){t.g?t.g.add(e):t.h=e}function wi(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Ti(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const i of t.g.values())e=e.concat(i.D);return e}return x(t.i)}function Ei(){}function Si(){this.g=new Ei}function xi(t,e,i){const n=i||"";try{He(t,function(t,i){let s=t;a(t)&&(s=It(t)),e.push(n+i+"="+encodeURIComponent(s))})}catch(s){throw e.push(n+"type="+encodeURIComponent("_badmap")),s}}function ji(t,e){const i=new Vt;if(r.Image){const n=new Image;n.onload=d(Ci,i,n,"TestLoadImage: loaded",!0,e),n.onerror=d(Ci,i,n,"TestLoadImage: error",!1,e),n.onabort=d(Ci,i,n,"TestLoadImage: abort",!1,e),n.ontimeout=d(Ci,i,n,"TestLoadImage: timeout",!1,e),r.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=t}else e(!1)}function Ci(t,e,i,n,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(n)}catch(r){}}function Ii(t){this.l=t.$b||null,this.j=t.ib||!1}function Ai(t,e){xt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Ri,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}pi.prototype.cancel=function(){if(this.i=Ti(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},Ei.prototype.stringify=function(t){return r.JSON.stringify(t,void 0)},Ei.prototype.parse=function(t){return r.JSON.parse(t,void 0)},v(Ii,ce),Ii.prototype.g=function(){return new Ai(this.l,this.j)},Ii.prototype.i=function(t){return function(){return t}}({}),v(Ai,xt);var Ri=0;function Oi(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Pi(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Di(t)}function Di(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(n=Ai.prototype).open=function(t,e){if(this.readyState!=Ri)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Di(this)},n.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||r).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},n.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Pi(this)),this.readyState=Ri},n.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Di(this)),this.g&&(this.readyState=3,Di(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==r.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Oi(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},n.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Pi(this):Di(this),3==this.readyState&&Oi(this)}},n.Ua=function(t){this.g&&(this.response=this.responseText=t,Pi(this))},n.Ta=function(t){this.g&&(this.response=t,Pi(this))},n.ha=function(){this.g&&Pi(this)},n.setRequestHeader=function(t,e){this.v.append(t,e)},n.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var i=e.next();!i.done;)i=i.value,t.push(i[0]+": "+i[1]),i=e.next();return t.join("\r\n")},Object.defineProperty(Ai.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Mi=r.JSON.parse;function Li(t){xt.call(this),this.headers=new ke,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Xi,this.K=this.L=!1}v(Li,xt);var Xi="",Hi=/^https?$/i,ki=["POST","PUT"];function _i(t){return F&&z()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}function Bi(t){return"content-type"==t.toLowerCase()}function Fi(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Ni(t),Ki(t)}function Ni(t){t.D||(t.D=!0,jt(t,"complete"),jt(t,"error"))}function Ui(t){if(t.h&&void 0!==s&&(!t.C[1]||4!=Gi(t)||2!=t.ba()))if(t.v&&4==Gi(t))Nt(t.Fa,0,t);else if(jt(t,"readystatechange"),4==Gi(t)){t.h=!1;try{const s=t.ba();t:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var i;if(!(i=e)){var n;if(n=0===s){var o=String(t.H).match(Fe)[1]||null;if(!o&&r.self&&r.self.location){var h=r.self.location.protocol;o=h.substr(0,h.length-1)}n=!Hi.test(o?o.toLowerCase():"")}i=n}if(i)jt(t,"complete"),jt(t,"success");else{t.m=6;try{var a=2<Gi(t)?t.g.statusText:""}catch(l){a=""}t.j=a+" ["+t.ba()+"]",Ni(t)}}finally{Ki(t)}}}function Ki(t,e){if(t.g){Yi(t);const n=t.g,s=t.C[0]?o:null;t.g=null,t.C=null,e||jt(t,"ready");try{n.onreadystatechange=s}catch(i){}}}function Yi(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(r.clearTimeout(t.A),t.A=null)}function Gi(t){return t.g?t.g.readyState:0}function Ji(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Xi:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Wi(t){let e="";return D(t,function(t,i){e+=i,e+=":",e+=t,e+="\r\n"}),e}function Vi(t,e,i){t:{for(n in i){var n=!1;break t}n=!0}n||(i=Wi(i),"string"==typeof t?null!=i&&encodeURIComponent(String(i)):Ve(t,e,i))}function $i(t,e,i){return i&&i.internalChannelParams&&i.internalChannelParams[t]||e}function qi(t){this.za=0,this.l=[],this.h=new Vt,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=$i("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=$i("baseRetryDelayMs",5e3,t),this.$a=$i("retryDelaySeedMs",1e4,t),this.Ya=$i("forwardChannelMaxRetries",2,t),this.ra=$i("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new pi(t&&t.concurrentRequestLimit),this.Ca=new Si,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function zi(t){if(Qi(t),3==t.G){var e=t.V++,i=Ke(t.F);Ve(i,"SID",t.J),Ve(i,"RID",e),Ve(i,"TYPE","terminate"),rn(t,i),(e=new be(t,t.h,e,void 0)).K=2,e.v=$e(Ke(i)),i=!1,r.navigator&&r.navigator.sendBeacon&&(i=r.navigator.sendBeacon(e.v.toString(),"")),!i&&r.Image&&((new Image).src=e.v,i=!0),i||(e.g=yn(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Re(e)}dn(t)}function Zi(t){t.g&&(ln(t),t.g.cancel(),t.g=null)}function Qi(t){Zi(t),t.u&&(r.clearTimeout(t.u),t.u=null),cn(t),t.i.cancel(),t.m&&("number"==typeof t.m&&r.clearTimeout(t.m),t.m=null)}function tn(t,e){t.l.push(new gi(t.Za++,e)),3==t.G&&en(t)}function en(t){vi(t.i)||t.m||(t.m=!0,Lt(t.Ha,t),t.C=0)}function nn(t,e){return!(yi(t.i)>=t.i.j-(t.m?1:0))&&(t.m?(t.l=e.D.concat(t.l),!0):!(1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya))&&(t.m=ae(p(t.Ha,t,e),gn(t,t.C)),t.C++,!0))}function sn(t,e){var i;i=e?e.m:t.V++;const n=Ke(t.F);Ve(n,"SID",t.J),Ve(n,"RID",i),Ve(n,"AID",t.U),rn(t,n),t.o&&t.s&&Vi(n,t.o,t.s),i=new be(t,t.h,i,t.C+1),null===t.o&&(i.H=t.s),e&&(t.l=e.D.concat(t.l)),e=on(t,i,1e3),i.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),bi(t.i,i),xe(i,n,e)}function rn(t,e){t.j&&He({},function(t,i){Ve(e,i,t)})}function on(t,e,i){i=Math.min(t.l.length,i);var n=t.j?p(t.j.Oa,t.j,t):null;t:{var s=t.l;let e=-1;for(;;){const t=["count="+i];-1==e?0<i?(e=s[0].h,t.push("ofs="+e)):e=0:t.push("ofs="+e);let o=!0;for(let h=0;h<i;h++){let i=s[h].h;const a=s[h].g;if(0>(i-=e))e=Math.max(0,s[h].h-100),o=!1;else try{xi(a,t,"req"+i+"_")}catch(r){n&&n(a)}}if(o){n=t.join("&");break t}}}return t=t.l.splice(0,i),e.D=t,n}function hn(t){t.g||t.u||(t.Y=1,Lt(t.Ga,t),t.A=0)}function an(t){return!(t.g||t.u||3<=t.A)&&(t.Y++,t.u=ae(p(t.Ga,t),gn(t,t.A)),t.A++,!0)}function ln(t){null!=t.B&&(r.clearTimeout(t.B),t.B=null)}function un(t){t.g=new be(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Ke(t.oa);Ve(e,"RID","rpc"),Ve(e,"SID",t.J),Ve(e,"CI",t.N?"0":"1"),Ve(e,"AID",t.U),rn(t,e),Ve(e,"TYPE","xmlhttp"),t.o&&t.s&&Vi(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var i=t.g;t=t.la,i.K=1,i.v=$e(Ke(e)),i.s=null,i.U=!0,je(i,t)}function cn(t){null!=t.v&&(r.clearTimeout(t.v),t.v=null)}function fn(t,e){var i=null;if(t.g==e){cn(t),ln(t),t.g=null;var n=2}else{if(!mi(t.i,e))return;i=e.D,wi(t.i,e),n=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==n){i=e.s?e.s.length:0,e=Date.now()-e.F;var s=t.C;jt(n=ie(),new he(n,i,e,s)),en(t)}else hn(t);else if(3==(s=e.o)||0==s&&0<t.I||!(1==n&&nn(t,e)||2==n&&an(t)))switch(i&&0<i.length&&(e=t.i,e.i=e.i.concat(i)),s){case 1:pn(t,5);break;case 4:pn(t,10);break;case 3:pn(t,6);break;default:pn(t,2)}}function gn(t,e){let i=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(i*=2),i*e}function pn(t,e){if(t.h.info("Error code "+e),2==e){var i=null;t.j&&(i=null);var n=p(t.jb,t);i||(i=new Ue("//www.google.com/images/cleardot.gif"),r.location&&"http"==r.location.protocol||Ye(i,"https"),$e(i)),ji(i.toString(),n)}else oe(2);t.G=0,t.j&&t.j.va(e),dn(t),Qi(t)}function dn(t){t.G=0,t.I=-1,t.j&&(0==Ti(t.i).length&&0==t.l.length||(t.i.i.length=0,x(t.l),t.l.length=0),t.j.ua())}function vn(t,e,i){let n=qe(i);if(""!=n.i)e&&Ge(n,e+"."+n.i),Je(n,n.m);else{const t=r.location;n=ze(t.protocol,e?e+"."+t.hostname:t.hostname,+t.port,i)}return t.aa&&D(t.aa,function(t,e){Ve(n,e,t)}),e=t.D,i=t.sa,e&&i&&Ve(n,e,i),Ve(n,"VER",t.ma),rn(t,n),n}function yn(t,e,i){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=i&&t.Ba&&!t.qa?new Li(new Ii({ib:!0})):new Li(t.qa)).L=t.H,e}function mn(){}function bn(){if(F&&!(10<=Number(Q)))throw Error("Environmental error: no available transport.")}function wn(t,e){xt.call(this),this.g=new qi(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!j(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!j(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new Sn(this)}function Tn(t){ve.call(this);var e=t.__sm__;if(e){t:{for(const i in e){t=i;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function En(){ye.call(this),this.status=1}function Sn(t){this.g=t}(n=Li.prototype).ea=function(t,e,i,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():pe.g(),this.C=this.u?fe(this.u):fe(pe),this.g.onreadystatechange=p(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void Fi(this,o)}t=i||"";const s=new ke(this.headers);n&&He(n,function(t,e){s.set(e,t)}),n=E(s.T()),i=r.FormData&&t instanceof r.FormData,!(0<=w(ki,e))||n||i||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Yi(this),0<this.B&&((this.K=_i(this.g))?(this.g.timeout=this.B,this.g.ontimeout=p(this.pa,this)):this.A=Nt(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){Fi(this,o)}},n.pa=function(){void 0!==s&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,jt(this,"timeout"),this.abort(8))},n.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,jt(this,"complete"),jt(this,"abort"),Ki(this))},n.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ki(this,!0)),Li.Z.M.call(this)},n.Fa=function(){this.s||(this.F||this.v||this.l?Ui(this):this.cb())},n.cb=function(){Ui(this)},n.ba=function(){try{return 2<Gi(this)?this.g.status:-1}catch(t){return-1}},n.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},n.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Mi(e)}},n.Da=function(){return this.m},n.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(n=qi.prototype).ma=8,n.G=1,n.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},n.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const s=new be(this,this.h,t,void 0);let r=this.s;if(this.P&&(r?X(r=M(r),this.P):r=this.P),null===this.o&&(s.H=r),this.ja)t:{for(var e=0,i=0;i<this.l.length;i++){var n=this.l[i];if(void 0===(n="__data__"in n.g&&"string"==typeof(n=n.g.__data__)?n.length:void 0))break;if(4096<(e+=n)){e=i;break t}if(4096===e||i===this.l.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=on(this,s,e),Ve(i=Ke(this.F),"RID",t),Ve(i,"CVER",22),this.D&&Ve(i,"X-HTTP-Session-Id",this.D),rn(this,i),this.o&&r&&Vi(i,this.o,r),bi(this.i,s),this.Ra&&Ve(i,"TYPE","init"),this.ja?(Ve(i,"$req",e),Ve(i,"SID","null"),s.$=!0,xe(s,i,null)):xe(s,i,e),this.G=2}}else 3==this.G&&(t?sn(this,t):0==this.l.length||vi(this.i)||sn(this))},n.Ga=function(){if(this.u=null,un(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=ae(p(this.bb,this),t)}},n.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,oe(10),Zi(this),un(this))},n.ab=function(){null!=this.v&&(this.v=null,Zi(this),an(this),oe(19))},n.jb=function(t){t?(this.h.info("Successfully pinged google.com"),oe(2)):(this.h.info("Failed to ping google.com"),oe(1))},(n=mn.prototype).xa=function(){},n.wa=function(){},n.va=function(){},n.ua=function(){},n.Oa=function(){},bn.prototype.g=function(t,e){return new wn(t,e)},v(wn,xt),wn.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,i=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Lt(p(t.hb,t,e))),oe(0),t.W=e,t.aa=i||{},t.N=t.X,t.F=vn(t,null,t.W),en(t)},wn.prototype.close=function(){zi(this.g)},wn.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,tn(this.g,e)}else this.v?((e={}).__data__=It(t),tn(this.g,e)):tn(this.g,t)},wn.prototype.M=function(){this.g.j=null,delete this.j,zi(this.g),delete this.g,wn.Z.M.call(this)},v(Tn,ve),v(En,ye),v(Sn,mn),Sn.prototype.xa=function(){jt(this.g,"a")},Sn.prototype.wa=function(t){jt(this.g,new Tn(t))},Sn.prototype.va=function(t){jt(this.g,new En(t))},Sn.prototype.ua=function(){jt(this.g,"b")},bn.prototype.createWebChannel=bn.prototype.g,wn.prototype.send=wn.prototype.u,wn.prototype.open=wn.prototype.m,wn.prototype.close=wn.prototype.close,le.NO_ERROR=0,le.TIMEOUT=8,le.HTTP_ERROR=6,ue.COMPLETE="complete",ge.EventType=de,de.OPEN="a",de.CLOSE="b",de.ERROR="c",de.MESSAGE="d",xt.prototype.listen=xt.prototype.N,Li.prototype.listenOnce=Li.prototype.O,Li.prototype.getLastError=Li.prototype.La,Li.prototype.getLastErrorCode=Li.prototype.Da,Li.prototype.getStatus=Li.prototype.ba,Li.prototype.getResponseJson=Li.prototype.Qa,Li.prototype.getResponseText=Li.prototype.ga,Li.prototype.send=Li.prototype.ea;var xn=i.createWebChannelTransport=function(){return new bn};exports.createWebChannelTransport=xn;var jn=i.getStatEventTarget=function(){return ie()};exports.getStatEventTarget=jn;var Cn=i.ErrorCode=le;exports.ErrorCode=Cn;var In=i.EventType=ue;exports.EventType=In;var An=i.Event=te;exports.Event=An;var Rn=i.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20};exports.Stat=Rn;var On=i.FetchXmlHttpFactory=Ii;exports.FetchXmlHttpFactory=On;var Pn=i.WebChannel=ge;exports.WebChannel=Pn;var Dn=i.XhrIo=Li;exports.XhrIo=Dn;
},{}],"pBGv":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"lBbe":[function(require,module,exports) {
var define;
var process = require("process");
var e,t=require("process");Object.defineProperty(exports,"__esModule",{value:!0}),exports._FieldPath=exports._EmptyAuthCredentialsProvider=exports._EmptyAppCheckTokenProvider=exports._DocumentKey=exports._DatabaseId=exports.WriteBatch=exports.Transaction=exports.Timestamp=exports.SnapshotMetadata=exports.QuerySnapshot=exports.QueryDocumentSnapshot=exports.QueryConstraint=exports.Query=exports.LoadBundleTask=exports.GeoPoint=exports.FirestoreError=exports.Firestore=exports.FieldValue=exports.FieldPath=exports.DocumentSnapshot=exports.DocumentReference=exports.CollectionReference=exports.CACHE_SIZE_UNLIMITED=exports.Bytes=exports.AbstractUserDataWriter=void 0,exports._cast=vl,exports._debugAssert=W,exports._isBase64Available=tt,exports._logWarn=G,exports._setIndexConfiguration=Ah,exports._validateIsNotUsedTogether=ll,exports.addDoc=ph,exports.arrayRemove=Sh,exports.arrayUnion=Th,exports.clearIndexedDbPersistence=ql,exports.collection=bl,exports.collectionGroup=Il,exports.connectFirestoreEmulator=gl,exports.deleteDoc=yh,exports.deleteField=Ih,exports.disableNetwork=Kl,exports.doc=El,exports.documentId=Hl,exports.enableIndexedDbPersistence=Ol,exports.enableMultiTabIndexedDbPersistence=Fl,exports.enableNetwork=Bl,exports.endAt=Yf,exports.endBefore=Hf,exports.ensureFirestoreConfigured=Ml,exports.executeWrite=kh,exports.getDoc=uh,exports.getDocFromCache=sh,exports.getDocFromServer=ch,exports.getDocs=lh,exports.getDocsFromCache=fh,exports.getDocsFromServer=hh,exports.getFirestore=Vl,exports.increment=Dh,exports.initializeFirestore=Ll,exports.limit=Kf,exports.limitToLast=Gf,exports.loadBundle=jl,exports.namedQuery=zl,exports.onSnapshot=mh,exports.onSnapshotsInSync=gh,exports.orderBy=Uf,exports.query=Of,exports.queryEqual=Sl,exports.refEqual=Tl,exports.runTransaction=bh,exports.serverTimestamp=Eh,exports.setDoc=dh,exports.setLogLevel=U,exports.snapshotEqual=Vf,exports.startAfter=Qf,exports.startAt=zf,exports.terminate=Gl,exports.updateDoc=vh,exports.waitForPendingWrites=Ul,exports.where=Pf,exports.writeBatch=_h;var n=require("@firebase/app"),r=require("@firebase/component"),i=require("@firebase/logger"),a=require("@firebase/util"),u=require("@firebase/webchannel-wrapper");function o(e,t,n){return(o=E()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&w(i,n.prototype),i}).apply(null,arguments)}function s(){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=c(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}}).apply(this,arguments)}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}function l(e,t){return d(e)||h(e,t)||_(e,t)||f()}function f(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],u=!0,o=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);u=!0);}catch(s){o=!0,i=s}finally{try{u||null==n.return||n.return()}finally{if(o)throw i}}return a}}function d(e){if(Array.isArray(e))return e}function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){o=!0,a=e},f:function(){try{u||null==n.return||n.return()}finally{if(o)throw a}}}}function p(){"use strict";p=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",u=r.toStringTag||"@@toStringTag";function o(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(_){o=function(e,t,n){return e[t]=n}}function s(e,t,n,r){var i=t&&t.prototype instanceof f?t:f,a=Object.create(i.prototype),u=new T(r||[]);return a._invoke=function(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return D()}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var o=b(u,n);if(o){if(o===l)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=c(e,t,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(e,n,u),a}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(_){return{type:"throw",arg:_}}}e.wrap=s;var l={};function f(){}function h(){}function d(){}var y={};o(y,i,function(){return this});var m=Object.getPrototypeOf,g=m&&m(m(S([])));g&&g!==t&&n.call(g,i)&&(y=g);var k=d.prototype=f.prototype=Object.create(y);function w(e){["next","throw","return"].forEach(function(t){o(e,t,function(e){return this._invoke(t,e)})})}function x(e,t){var r;this._invoke=function(i,a){function u(){return new t(function(r,u){!function r(i,a,u,o){var s=c(e[i],e,a);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==v(f)&&n.call(f,"__await")?t.resolve(f.__await).then(function(e){r("next",e,u,o)},function(e){r("throw",e,u,o)}):t.resolve(f).then(function(e){l.value=e,u(l)},function(e){return r("throw",e,u,o)})}o(s.arg)}(i,a,r,u)})}return r=r?r.then(u,u):u()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function S(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:D}}function D(){return{value:void 0,done:!0}}return h.prototype=d,o(k,"constructor",d),o(d,"constructor",h),h.displayName=o(d,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,o(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},w(x.prototype),o(x.prototype,a,function(){return this}),e.AsyncIterator=x,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var u=new x(s(t,n,r,i),a);return e.isGeneratorFunction(n)?u:u.next().then(function(e){return e.done?e.value:u.next()})},w(k),o(k,u,"Generator"),o(k,i,function(){return this}),o(k,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=S,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return u.type="throw",u.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var o=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(o&&s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var u=a?a.completion:{};return u.type=e,u.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}function m(e,t,n,r,i,a,u){try{var o=e[a](u),s=o.value}catch(c){return void n(c)}o.done?t(s):Promise.resolve(s).then(r,i)}function g(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function u(e){m(a,r,i,u,o,"next",e)}function o(e){m(a,r,i,u,o,"throw",e)}u(void 0)})}}function k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&w(e,t)}function w(e,t){return(w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function x(e){var t=E();return function(){var n,r=T(e);if(t){var i=T(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}function b(e,t){if(t&&("object"===v(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return I(e)}function I(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e){return N(e)||A(e)||_(e)||D()}function D(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _(e,t){if(e){if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}function A(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function N(e){if(Array.isArray(e))return C(e)}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e,t,n){return t&&V(e.prototype,t),n&&V(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var R="@firebase/firestore",O=function(){function e(t){L(this,e),this.uid=t}return M(e,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(e){return e.uid===this.uid}}]),e}();O.UNAUTHENTICATED=new O(null),O.GOOGLE_CREDENTIALS=new O("google-credentials-uid"),O.FIRST_PARTY=new O("first-party-uid"),O.MOCK_USER=new O("mock-user");var F="9.8.3",P=new i.Logger("@firebase/firestore");function q(){return P.logLevel}function U(e){P.setLogLevel(e)}function B(e){if(P.logLevel<=i.LogLevel.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map(j);P.debug.apply(P,["Firestore (".concat(F,"): ").concat(e)].concat(S(a)))}}function K(e){if(P.logLevel<=i.LogLevel.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map(j);P.error.apply(P,["Firestore (".concat(F,"): ").concat(e)].concat(S(a)))}}function G(e){if(P.logLevel<=i.LogLevel.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map(j);P.warn.apply(P,["Firestore (".concat(F,"): ").concat(e)].concat(S(a)))}}function j(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function z(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",t="FIRESTORE (".concat(F,") INTERNAL ASSERTION FAILED: ")+e;throw K(t),new Error(t)}function Q(e,t){e||z()}function W(e,t){e||z()}function H(e,t){return e}var Y={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},J=function(e){k(n,a.FirebaseError);var t=x(n);function n(e,r){var i;return L(this,n),(i=t.call(this,e,r)).code=e,i.message=r,i.toString=function(){return"".concat(i.name,": [code=").concat(i.code,"]: ").concat(i.message)},i}return M(n)}();exports.FirestoreError=J;var X=M(function e(){var t=this;L(this,e),this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}),$=M(function e(t,n){L(this,e),this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))}),Z=function(){function e(){L(this,e)}return M(e,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){e.enqueueRetryable(function(){return t(O.UNAUTHENTICATED)})}},{key:"shutdown",value:function(){}}]),e}();exports._EmptyAuthCredentialsProvider=Z;var ee=function(){function e(t){L(this,e),this.token=t,this.changeListener=null}return M(e,[{key:"getToken",value:function(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable(function(){return t(n.token.user)})}},{key:"shutdown",value:function(){this.changeListener=null}}]),e}(),te=function(){function e(t){L(this,e),this.t=t,this.currentUser=O.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return M(e,[{key:"start",value:function(e,t){var n=this,r=this.i,i=function(e){return n.i!==r?(r=n.i,t(e)):Promise.resolve()},a=new X;this.o=function(){n.i++,n.currentUser=n.u(),a.resolve(),a=new X,e.enqueueRetryable(function(){return i(n.currentUser)})};var u=function(){var t=a;e.enqueueRetryable(g(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.promise;case 2:return e.next=4,i(n.currentUser);case 4:case"end":return e.stop()}},e)})))},o=function(e){B("FirebaseAuthCredentialsProvider","Auth detected"),n.auth=e,n.auth.addAuthTokenListener(n.o),u()};this.t.onInit(function(e){return o(e)}),setTimeout(function(){if(!n.auth){var e=n.t.getImmediate({optional:!0});e?o(e):(B("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new X)}},0),u()}},{key:"getToken",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return e.i!==t?(B("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?(Q("string"==typeof n.accessToken),new $(n.accessToken,e.currentUser)):null}):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function(){var e=this.auth&&this.auth.getUid();return Q(null===e||"string"==typeof e),new O(e)}}]),e}(),ne=M(function e(t,n,r){L(this,e),this.type="FirstParty",this.user=O.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",n);var i=t.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set("Authorization",i),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)}),re=function(){function e(t,n,r){L(this,e),this.h=t,this.l=n,this.m=r}return M(e,[{key:"getToken",value:function(){return Promise.resolve(new ne(this.h,this.l,this.m))}},{key:"start",value:function(e,t){e.enqueueRetryable(function(){return t(O.FIRST_PARTY)})}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),e}(),ie=M(function e(t){L(this,e),this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}),ae=function(){function e(t){L(this,e),this.g=t,this.forceRefresh=!1,this.appCheck=null,this.p=null}return M(e,[{key:"start",value:function(e,t){var n=this,r=function(e){null!=e.error&&B("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));var r=e.token!==n.p;return n.p=e.token,B("FirebaseAppCheckTokenProvider","Received ".concat(r?"new":"existing"," token.")),r?t(e.token):Promise.resolve()};this.o=function(t){e.enqueueRetryable(function(){return r(t)})};var i=function(e){B("FirebaseAppCheckTokenProvider","AppCheck detected"),n.appCheck=e,n.appCheck.addTokenListener(n.o)};this.g.onInit(function(e){return i(e)}),setTimeout(function(){if(!n.appCheck){var e=n.g.getImmediate({optional:!0});e?i(e):B("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}},{key:"getToken",value:function(){var e=this,t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(function(t){return t?(Q("string"==typeof t.token),e.p=t.token,new ie(t.token)):null}):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}]),e}(),ue=function(){function e(){L(this,e)}return M(e,[{key:"getToken",value:function(){return Promise.resolve(new ie(""))}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){}},{key:"shutdown",value:function(){}}]),e}();function oe(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}exports._EmptyAppCheckTokenProvider=ue;var se=function(){function e(){L(this,e)}return M(e,null,[{key:"I",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";n.length<20;)for(var r=oe(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return n}}]),e}();function ce(e,t){return e<t?-1:e>t?1:0}function le(e,t,n){return e.length===t.length&&e.every(function(e,r){return n(e,t[r])})}function fe(e){return e+"\0"}var he=function(){function e(t,n){if(L(this,e),this.seconds=t,this.nanoseconds=n,n<0)throw new J(Y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new J(Y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new J(Y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new J(Y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return M(e,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?ce(this.nanoseconds,e.nanoseconds):ce(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return e.fromMillis(Date.now())}},{key:"fromDate",value:function(t){return e.fromMillis(t.getTime())}},{key:"fromMillis",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}();exports.Timestamp=he;var de=function(){function e(t){L(this,e),this.timestamp=t}return M(e,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(t){return new e(t)}},{key:"min",value:function(){return new e(new he(0,0))}},{key:"max",value:function(){return new e(new he(253402300799,999999999))}}]),e}(),ve=function(){function e(t,n,r){L(this,e),void 0===n?n=0:n>t.length&&z(),void 0===r?r=t.length-n:r>t.length-n&&z(),this.segments=t,this.offset=n,this.len=r}return M(e,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(t){return 0===e.comparator(this,t)}},{key:"child",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(function(e){n.push(e)}):n.push(t),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),a=t.get(r);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),ye=function(e){k(n,ve);var t=x(n);function n(){return L(this,n),t.apply(this,arguments)}return M(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}}],[{key:"fromString",value:function(){for(var e=[],t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0,u=r;a<u.length;a++){var o=u[a];if(o.indexOf("//")>=0)throw new J(Y.INVALID_ARGUMENT,"Invalid segment (".concat(o,"). Paths must not contain // in them."));e.push.apply(e,S(o.split("/").filter(function(e){return e.length>0})))}return new n(e)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(),pe=/^[_a-zA-Z][_a-zA-Z0-9]*$/,me=function(e){k(n,ve);var t=x(n);function n(){return L(this,n),t.apply(this,arguments)}return M(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().map(function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e}).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(e){return pe.test(e)}},{key:"keyField",value:function(){return new n(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var t=[],r="",i=0,a=function(){if(0===r.length)throw new J(Y.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(r),r=""},u=!1;i<e.length;){var o=e[i];if("\\"===o){if(i+1===e.length)throw new J(Y.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var s=e[i+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new J(Y.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=s,i+=2}else"`"===o?(u=!u,i++):"."!==o||u?(r+=o,i++):(a(),i++)}if(a(),u)throw new J(Y.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}},{key:"emptyPath",value:function(){return new n([])}}]),n}();exports._FieldPath=me;var ge=function(){function e(t){L(this,e),this.path=t}return M(e,[{key:"collectionGroup",get:function(){return this.path.popLast().lastSegment()}},{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"getCollectionGroup",value:function(){return this.path.get(this.path.length-2)}},{key:"getCollectionPath",value:function(){return this.path.popLast()}},{key:"isEqual",value:function(e){return null!==e&&0===ye.comparator(this.path,e.path)}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(t){return new e(ye.fromString(t))}},{key:"fromName",value:function(t){return new e(ye.fromString(t).popFirst(5))}},{key:"empty",value:function(){return new e(ye.emptyPath())}},{key:"comparator",value:function(e,t){return ye.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(t){return new e(new ye(t.slice()))}}]),e}();exports._DocumentKey=ge;var ke=M(function e(t,n,r,i){L(this,e),this.indexId=t,this.collectionGroup=n,this.fields=r,this.indexState=i});function we(e){return e.fields.find(function(e){return 2===e.kind})}function xe(e){return e.fields.filter(function(e){return 2!==e.kind})}ke.UNKNOWN_ID=-1;var be=M(function e(t,n){L(this,e),this.fieldPath=t,this.kind=n}),Ie=function(){function e(t,n){L(this,e),this.sequenceNumber=t,this.offset=n}return M(e,null,[{key:"empty",value:function(){return new e(0,Se.min())}}]),e}();function Ee(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=de.fromTimestamp(1e9===r?new he(n+1,0):new he(n,r));return new Se(i,ge.empty(),t)}function Te(e){return new Se(e.readTime,e.key,-1)}var Se=function(){function e(t,n,r){L(this,e),this.readTime=t,this.documentKey=n,this.largestBatchId=r}return M(e,null,[{key:"min",value:function(){return new e(de.min(),ge.empty(),-1)}},{key:"max",value:function(){return new e(de.max(),ge.empty(),-1)}}]),e}();function De(e,t){var n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=ge.comparator(e.documentKey,t.documentKey))?n:ce(e.largestBatchId,t.largestBatchId)}var _e="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ae=function(){function e(){L(this,e),this.onCommittedListeners=[]}return M(e,[{key:"addOnCommittedListener",value:function(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach(function(e){return e()})}}]),e}();function Ne(e){return Ce.apply(this,arguments)}function Ce(){return(Ce=g(p().mark(function e(t){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.code===Y.FAILED_PRECONDITION&&t.message===_e){e.next=2;break}throw t;case 2:B("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Le=function(){function e(t){var n=this;L(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(e){n.isDone=!0,n.result=e,n.nextCallback&&n.nextCallback(e)},function(e){n.isDone=!0,n.error=e,n.catchCallback&&n.catchCallback(e)})}return M(e,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(t,n){var r=this;return this.callbackAttached&&z(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e(function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}})}},{key:"toPromise",value:function(){var e=this;return new Promise(function(t,n){e.next(t,n)})}},{key:"wrapUserFunction",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}},{key:"wrapSuccess",value:function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.resolve(n)}},{key:"wrapFailure",value:function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.reject(n)}}],[{key:"resolve",value:function(t){return new e(function(e,n){e(t)})}},{key:"reject",value:function(t){return new e(function(e,n){n(t)})}},{key:"waitFor",value:function(t){return new e(function(e,n){var r=0,i=0,a=!1;t.forEach(function(t){++r,t.next(function(){++i,a&&i===r&&e()},function(e){return n(e)})}),a=!0,i===r&&e()})}},{key:"or",value:function(t){var n,r=e.resolve(!1),i=y(t);try{var a=function(){var t=n.value;r=r.next(function(n){return n?e.resolve(n):t()})};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return r}},{key:"forEach",value:function(e,t){var n=this,r=[];return e.forEach(function(e,i){r.push(t.call(n,e,i))}),this.waitFor(r)}},{key:"mapArray",value:function(t,n){return new e(function(e,r){for(var i=t.length,a=new Array(i),u=0,o=function(o){var s=o;n(t[s]).next(function(t){a[s]=t,++u===i&&e(a)},function(e){return r(e)})},s=0;s<i;s++)o(s)})}},{key:"doWhile",value:function(t,n){return new e(function(e,r){!function i(){!0===t()?n().next(function(){i()},r):e()}()})}}]),e}(),Ve=function(){function e(t,n){var r=this;L(this,e),this.action=t,this.transaction=n,this.aborted=!1,this.T=new X,this.transaction.oncomplete=function(){r.T.resolve()},this.transaction.onabort=function(){n.error?r.T.reject(new Oe(t,n.error)):r.T.resolve()},this.transaction.onerror=function(e){var n=Be(e.target.error);r.T.reject(new Oe(t,n))}}return M(e,[{key:"A",get:function(){return this.T.promise}},{key:"abort",value:function(e){e&&this.T.reject(e),this.aborted||(B("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}},{key:"R",value:function(){var e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}},{key:"store",value:function(e){var t=this.transaction.objectStore(e);return new Pe(t)}}],[{key:"open",value:function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(t){throw new Oe(n,t)}}}]),e}(),Me=function(){function e(t,n,r){L(this,e),this.name=t,this.version=n,this.P=r,12.2===e.v((0,a.getUA)())&&K("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return M(e,[{key:"k",value:function(){var e=g(p().mark(function e(t){var n=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.db,e.t0){e.next=6;break}return B("SimpleDb","Opening database:",this.name),e.next=5,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new Oe(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new J(Y.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new J(Y.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new Oe(t,n))},i.onupgradeneeded=function(e){B("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;n.P.O(t,i.transaction,e.oldVersion,n.version).next(function(){B("SimpleDb","Database upgrade to version "+n.version+" complete")})}});case 5:this.db=e.sent;case 6:return this.M&&(this.db.onversionchange=function(e){return n.M(e)}),e.abrupt("return",this.db);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"F",value:function(e){this.M=e,this.db&&(this.db.onversionchange=function(t){return e(t)})}},{key:"runTransaction",value:function(){var e=g(p().mark(function e(t,n,r,i){var a,u,o,s,c=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a="readonly"===n,u=0;case 2:return++u,e.prev=3,e.delegateYield(p().mark(function e(){var n,u;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.k(t);case 2:return c.db=e.sent,n=Ve.open(c.db,t,a?"readonly":"readwrite",r),(u=i(n).next(function(e){return n.R(),e}).catch(function(e){return n.abort(e),Le.reject(e)}).toPromise()).catch(function(){}),e.next=7,n.A;case 7:return e.t0=u,e.abrupt("return",{v:e.t0});case 9:case"end":return e.stop()}},e)})(),"t0",5);case 5:if("object"!==v(o=e.t0)){e.next=8;break}return e.abrupt("return",o.v);case 8:e.next=15;break;case 10:if(e.prev=10,e.t1=e.catch(3),s="FirebaseError"!==e.t1.name&&u<3,B("SimpleDb","Transaction failed with error:",e.t1.message,"Retrying:",s),this.close(),s){e.next=15;break}return e.abrupt("return",Promise.reject(e.t1));case 15:e.next=2;break;case 17:case"end":return e.stop()}},e,this,[[3,10]])}));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"close",value:function(){this.db&&this.db.close(),this.db=void 0}}],[{key:"delete",value:function(e){return B("SimpleDb","Removing database:",e),qe(window.indexedDB.deleteDatabase(e)).toPromise()}},{key:"V",value:function(){if(!(0,a.isIndexedDBAvailable)())return!1;if(e.S())return!0;var t=(0,a.getUA)(),n=e.v(t),r=0<n&&n<10,i=e.D(t),u=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||u)}},{key:"S",value:function(){var e;return void 0!==t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.C)}},{key:"N",value:function(e,t){return e.store(t)}},{key:"v",value:function(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}},{key:"D",value:function(e){var t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}}]),e}(),Re=function(){function e(t){L(this,e),this.$=t,this.B=!1,this.L=null}return M(e,[{key:"isDone",get:function(){return this.B}},{key:"U",get:function(){return this.L}},{key:"cursor",set:function(e){this.$=e}},{key:"done",value:function(){this.B=!0}},{key:"q",value:function(e){this.L=e}},{key:"delete",value:function(){return qe(this.$.delete())}}]),e}(),Oe=function(e){k(n,J);var t=x(n);function n(e,r){var i;return L(this,n),(i=t.call(this,Y.UNAVAILABLE,"IndexedDB transaction '".concat(e,"' failed: ").concat(r))).name="IndexedDbTransactionError",i}return M(n)}();function Fe(e){return"IndexedDbTransactionError"===e.name}var Pe=function(){function e(t){L(this,e),this.store=t}return M(e,[{key:"put",value:function(e,t){var n;return void 0!==t?(B("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(B("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),qe(n)}},{key:"add",value:function(e){return B("SimpleDb","ADD",this.store.name,e,e),qe(this.store.add(e))}},{key:"get",value:function(e){var t=this;return qe(this.store.get(e)).next(function(n){return void 0===n&&(n=null),B("SimpleDb","GET",t.store.name,e,n),n})}},{key:"delete",value:function(e){return B("SimpleDb","DELETE",this.store.name,e),qe(this.store.delete(e))}},{key:"count",value:function(){return B("SimpleDb","COUNT",this.store.name),qe(this.store.count())}},{key:"K",value:function(e,t){var n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){var r=this.cursor(n),i=[];return this.G(r,function(e,t){i.push(t)}).next(function(){return i})}var a=this.store.getAll(n.range);return new Le(function(e,t){a.onerror=function(e){t(e.target.error)},a.onsuccess=function(t){e(t.target.result)}})}},{key:"j",value:function(e,t){var n=this.store.getAll(e,null===t?void 0:t);return new Le(function(e,t){n.onerror=function(e){t(e.target.error)},n.onsuccess=function(t){e(t.target.result)}})}},{key:"W",value:function(e,t){B("SimpleDb","DELETE ALL",this.store.name);var n=this.options(e,t);n.H=!1;var r=this.cursor(n);return this.G(r,function(e,t,n){return n.delete()})}},{key:"J",value:function(e,t){var n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.G(r,t)}},{key:"Y",value:function(e){var t=this.cursor({});return new Le(function(n,r){t.onerror=function(e){var t=Be(e.target.error);r(t)},t.onsuccess=function(t){var r=t.target.result;r?e(r.primaryKey,r.value).next(function(e){e?r.continue():n()}):n()}})}},{key:"G",value:function(e,t){var n=[];return new Le(function(r,i){e.onerror=function(e){i(e.target.error)},e.onsuccess=function(e){var i=e.target.result;if(i){var a=new Re(i),u=t(i.primaryKey,i.value,a);if(u instanceof Le){var o=u.catch(function(e){return a.done(),Le.reject(e)});n.push(o)}a.isDone?r():null===a.U?i.continue():i.continue(a.U)}else r()}}).next(function(){return Le.waitFor(n)})}},{key:"options",value:function(e,t){var n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}},{key:"cursor",value:function(e){var t="next";if(e.reverse&&(t="prev"),e.index){var n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}]),e}();function qe(e){return new Le(function(t,n){e.onsuccess=function(e){var n=e.target.result;t(n)},e.onerror=function(e){var t=Be(e.target.error);n(t)}})}var Ue=!1;function Be(e){var t=Me.v((0,a.getUA)());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new J("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(n,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return Ue||(Ue=!0,setTimeout(function(){throw r},0)),r}}return e}var Ke=function(){function e(t,n){L(this,e),this.asyncQueue=t,this.X=n,this.task=null}return M(e,[{key:"start",value:function(){}},{key:"stop",value:function(){this.task&&(this.task.cancel(),this.task=null)}},{key:"started",get:function(){return null!==this.task}},{key:"Z",value:function(e){var t=this;B("IndexBackiller","Scheduled in ".concat(e,"ms")),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,g(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.task=null,e.prev=1,e.t0=B,e.t1="Documents written: ",e.next=6,t.X.tt();case 6:e.t2=e.sent,e.t3=e.t1.concat.call(e.t1,e.t2),(0,e.t0)("IndexBackiller",e.t3),e.next=19;break;case 11:if(e.prev=11,e.t4=e.catch(1),!Fe(e.t4)){e.next=17;break}B("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e.t4),e.next=19;break;case 17:return e.next=19,Ne(e.t4);case 19:return e.next=21,t.Z(1);case 21:case"end":return e.stop()}},e,null,[[1,11]])})))}}]),e}(),Ge=function(){function e(t,n){L(this,e),this.localStore=t,this.persistence=n}return M(e,[{key:"tt",value:function(){var e=g(p().mark(function e(){var t,n=this,r=arguments;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:50,e.abrupt("return",this.persistence.runTransaction("Backfill Indexes","readwrite-primary",function(e){return n.et(e,t)}));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"et",value:function(e,t){var n=this,r=new Set,i=t,a=!0;return Le.doWhile(function(){return!0===a&&i>0},function(){return n.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(function(t){if(null!==t&&!r.has(t))return B("IndexBackiller","Processing collection: ".concat(t)),n.nt(e,t,i).next(function(e){i-=e,r.add(t)});a=!1})}).next(function(){return t-i})}},{key:"nt",value:function(e,t,n){var r=this;return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(function(i){return r.localStore.localDocuments.getNextDocuments(e,t,i,n).next(function(n){var a=n.changes;return r.localStore.indexManager.updateIndexEntries(e,a).next(function(){return r.st(i,n)}).next(function(n){return B("IndexBackiller","Updating offset: ".concat(n)),r.localStore.indexManager.updateCollectionGroup(e,t,n)}).next(function(){return a.size})})})}},{key:"st",value:function(e,t){var n=e;return t.changes.forEach(function(e,t){var r=Te(t);De(r,n)>0&&(n=r)}),new Se(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}]),e}(),je=function(){function e(t,n){var r=this;L(this,e),this.previousValue=t,n&&(n.sequenceNumberHandler=function(e){return r.it(e)},this.rt=function(e){return n.writeSequenceNumber(e)})}return M(e,[{key:"it",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function(){var e=++this.previousValue;return this.rt&&this.rt(e),e}}]),e}();function ze(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Qe(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function We(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}je.ot=-1;var He=function(){function e(t,n){L(this,e),this.comparator=t,this.root=n||Je.EMPTY}return M(e,[{key:"insert",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,Je.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Je.BLACK,null,null))}},{key:"get",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal(function(t,n){return e(t,n),!1})}},{key:"toString",value:function(){var e=[];return this.inorderTraversal(function(t,n){return e.push("".concat(t,":").concat(n)),!1}),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new Ye(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new Ye(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new Ye(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new Ye(this.root,e,this.comparator,!0)}}]),e}(),Ye=function(){function e(t,n,r,i){L(this,e),this.isReverse=i,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=n?r(t.key,n):1,n&&i&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return M(e,[{key:"getNext",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),Je=function(){function e(t,n,r,i,a){L(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return M(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed())throw z();if(this.right.isRed())throw z();var e=this.left.check();if(e!==this.right.check())throw z();return e+(this.isRed()?0:1)}}]),e}();Je.EMPTY=null,Je.RED=!0,Je.BLACK=!1,Je.EMPTY=new(function(){function e(){L(this,e),this.size=0}return M(e,[{key:"key",get:function(){throw z()}},{key:"value",get:function(){throw z()}},{key:"color",get:function(){throw z()}},{key:"left",get:function(){throw z()}},{key:"right",get:function(){throw z()}},{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new Je(e,t)}},{key:"remove",value:function(e,t){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}]),e}());var Xe=function(){function e(t){L(this,e),this.comparator=t,this.data=new He(this.comparator)}return M(e,[{key:"has",value:function(e){return null!==this.data.get(e)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal(function(t,n){return e(t),!1})}},{key:"forEachInRange",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:"forEachWhile",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function(){return new $e(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new $e(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach(function(e){t=t.add(e)}),t}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(0!==this.comparator(i,a))return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach(function(t){e.push(t)}),e}},{key:"toString",value:function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),$e=function(){function e(t){L(this,e),this.iter=t}return M(e,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),e}();function Ze(e){return e.hasNext()?e.getNext():void 0}var et=function(){function e(t){L(this,e),this.fields=t,t.sort(me.comparator)}return M(e,[{key:"unionWith",value:function(t){var n,r=new Xe(me.comparator),i=y(this.fields);try{for(i.s();!(n=i.n()).done;){var a=n.value;r=r.add(a)}}catch(c){i.e(c)}finally{i.f()}var u,o=y(t);try{for(o.s();!(u=o.n()).done;){var s=u.value;r=r.add(s)}}catch(c){o.e(c)}finally{o.f()}return new e(r.toArray())}},{key:"covers",value:function(e){var t,n=y(this.fields);try{for(n.s();!(t=n.n()).done;){if(t.value.isPrefixOf(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"isEqual",value:function(e){return le(this.fields,e.fields,function(e,t){return e.isEqual(t)})}}],[{key:"empty",value:function(){return new e([])}}]),e}();function tt(){return"undefined"!=typeof atob}var nt=function(e){function t(e){L(this,t),this.binaryString=e}return M(t,[{key:Symbol.iterator,value:function(){var e=this,t=0;return{next:function(){return t<e.binaryString.length?{value:e.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}}},{key:"toBase64",value:function(){return e=this.binaryString,btoa(e);var e}},{key:"toUint8Array",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return ce(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(e){return new t(atob(e))}},{key:"fromUint8Array",value:function(e){return new t(function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}}]),t}();nt.EMPTY_BYTE_STRING=new nt("");var rt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function it(e){if(Q(!!e),"string"==typeof e){var t=0,n=rt.exec(e);if(Q(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:at(e.seconds),nanos:at(e.nanos)}}function at(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ut(e){return"string"==typeof e?nt.fromBase64String(e):nt.fromUint8Array(e)}function ot(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function st(e){var t=e.mapValue.fields.__previous_value__;return ot(t)?st(t):t}function ct(e){var t=it(e.mapValue.fields.__local_write_time__.timestampValue);return new he(t.seconds,t.nanos)}var lt=M(function e(t,n,r,i,a,u,o,s){L(this,e),this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=u,this.autoDetectLongPolling=o,this.useFetchStreams=s}),ft=function(){function e(t,n){L(this,e),this.projectId=t,this.database=n||"(default)"}return M(e,[{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}},{key:"isEqual",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}],[{key:"empty",value:function(){return new e("","")}}]),e}();function ht(e){return null==e}function dt(e){return 0===e&&1/e==-1/0}function vt(e){return"number"==typeof e&&Number.isInteger(e)&&!dt(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}exports._DatabaseId=ft;var yt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},pt={nullValue:"NULL_VALUE"};function mt(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ot(e)?4:Ct(e)?9007199254740991:10:z()}function gt(e,t){if(e===t)return!0;var n=mt(e);if(n!==mt(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ct(e).isEqual(ct(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=it(e.timestampValue),r=it(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return ut(e.bytesValue).isEqual(ut(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return at(e.geoPointValue.latitude)===at(t.geoPointValue.latitude)&&at(e.geoPointValue.longitude)===at(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return at(e.integerValue)===at(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=at(e.doubleValue),r=at(t.doubleValue);return n===r?dt(n)===dt(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return le(e.arrayValue.values||[],t.arrayValue.values||[],gt);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(ze(n)!==ze(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!gt(n[i],r[i])))return!1;return!0}(e,t);default:return z()}}function kt(e,t){return void 0!==(e.values||[]).find(function(e){return gt(e,t)})}function wt(e,t){if(e===t)return 0;var n=mt(e),r=mt(t);if(n!==r)return ce(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ce(e.booleanValue,t.booleanValue);case 2:return function(e,t){var n=at(e.integerValue||e.doubleValue),r=at(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return xt(e.timestampValue,t.timestampValue);case 4:return xt(ct(e),ct(t));case 5:return ce(e.stringValue,t.stringValue);case 6:return function(e,t){var n=ut(e),r=ut(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var a=ce(n[i],r[i]);if(0!==a)return a}return ce(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=ce(at(e.latitude),at(t.latitude));return 0!==n?n:ce(at(e.longitude),at(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var a=wt(n[i],r[i]);if(a)return a}return ce(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===yt.mapValue&&t===yt.mapValue)return 0;if(e===yt.mapValue)return 1;if(t===yt.mapValue)return-1;var n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(var u=0;u<r.length&&u<a.length;++u){var o=ce(r[u],a[u]);if(0!==o)return o;var s=wt(n[r[u]],i[a[u]]);if(0!==s)return s}return ce(r.length,a.length)}(e.mapValue,t.mapValue);default:throw z()}}function xt(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return ce(e,t);var n=it(e),r=it(t),i=ce(n.seconds,r.seconds);return 0!==i?i:ce(n.nanos,r.nanos)}function bt(e){return It(e)}function It(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){var t=it(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?ut(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,ge.fromName(n).toString()):"geoPointValue"in e?"geo(".concat((t=e.geoPointValue).latitude,",").concat(t.longitude,")"):"arrayValue"in e?function(e){var t,n="[",r=!0,i=y(e.values||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+=It(a)}}catch(u){i.e(u)}finally{i.f()}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){var t,n="{",r=!0,i=y(Object.keys(e.fields||{}).sort());try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+="".concat(a,":").concat(It(e.fields[a]))}}catch(u){i.e(u)}finally{i.f()}return n+"}"}(e.mapValue):z();var t,n}function Et(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function Tt(e){return!!e&&"integerValue"in e}function St(e){return!!e&&"arrayValue"in e}function Dt(e){return!!e&&"nullValue"in e}function _t(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function At(e){return!!e&&"mapValue"in e}function Nt(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==v(e.timestampValue))return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return Qe(e.mapValue.fields,function(e,n){return t.mapValue.fields[e]=Nt(n)}),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Nt(e.arrayValue.values[r]);return n}return Object.assign({},e)}function Ct(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Lt(e){return"nullValue"in e?pt:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Et(ft.empty(),ge.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:z()}function Vt(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Et(ft.empty(),ge.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?yt:z()}function Mt(e,t){var n=wt(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Rt(e,t){var n=wt(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}var Ot=function(){function e(t){L(this,e),this.value=t}return M(e,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!At(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Nt(t)}},{key:"setAll",value:function(e){var t=this,n=me.emptyPath(),r={},i=[];e.forEach(function(e,a){if(!n.isImmediateParentOf(a)){var u=t.getFieldsMap(n);t.applyChanges(u,r,i),r={},i=[],n=a.popLast()}e?r[a.lastSegment()]=Nt(e):i.push(a.lastSegment())});var a=this.getFieldsMap(n);this.applyChanges(a,r,i)}},{key:"delete",value:function(e){var t=this.field(e.popLast());At(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return gt(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];At(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:"applyChanges",value:function(e,t,n){Qe(t,function(t,n){return e[t]=n});var r,i=y(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete e[a]}}catch(u){i.e(u)}finally{i.f()}}},{key:"clone",value:function(){return new e(Nt(this.value))}}],[{key:"empty",value:function(){return new e({mapValue:{}})}}]),e}();function Ft(e){var t=[];return Qe(e.fields,function(e,n){var r=new me([e]);if(At(n)){var i=Ft(n.mapValue).fields;if(0===i.length)t.push(r);else{var a,u=y(i);try{for(u.s();!(a=u.n()).done;){var o=a.value;t.push(r.child(o))}}catch(s){u.e(s)}finally{u.f()}}}else t.push(r)}),new et(t)}var Pt=function(){function e(t,n,r,i,a,u){L(this,e),this.key=t,this.documentType=n,this.version=r,this.readTime=i,this.data=a,this.documentState=u}return M(e,[{key:"convertToFoundDocument",value:function(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=Ot.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=Ot.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this.version=de.min(),this}},{key:"setReadTime",value:function(e){return this.readTime=e,this}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:"mutableCopy",value:function(){return new e(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(t){return new e(t,0,de.min(),de.min(),Ot.empty(),0)}},{key:"newFoundDocument",value:function(t,n,r){return new e(t,1,n,de.min(),r,0)}},{key:"newNoDocument",value:function(t,n){return new e(t,2,n,de.min(),Ot.empty(),0)}},{key:"newUnknownDocument",value:function(t,n){return new e(t,3,n,de.min(),Ot.empty(),2)}}]),e}(),qt=M(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;L(this,e),this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=u,this.endAt=o,this.ut=null});function Ut(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new qt(e,t,n,r,i,a,u)}function Bt(e){var t=H(e);if(null===t.ut){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map(function(e){return(t=e).field.canonicalString()+t.op.toString()+bt(t.value);var t}).join(","),n+="|ob:",n+=t.orderBy.map(function(e){return function(e){return e.field.canonicalString()+e.dir}(e)}).join(","),ht(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(function(e){return bt(e)}).join(",")),t.endAt&&(n+="|ub:",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(function(e){return bt(e)}).join(",")),t.ut=n}return t.ut}function Kt(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(function(e){return"".concat((t=e).field.canonicalString()," ").concat(t.op," ").concat(bt(t.value));var t}).join(", "),"]")),ht(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(function(e){return function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)}).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(function(e){return bt(e)}).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(function(e){return bt(e)}).join(",")),"Target(".concat(t,")")}function Gt(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!un(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(i=e.filters[r],a=t.filters[r],i.op!==a.op||!i.field.isEqual(a.field)||!gt(i.value,a.value))return!1;var i,a;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!sn(e.startAt,t.startAt)&&sn(e.endAt,t.endAt)}function jt(e){return ge.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function zt(e,t){return e.filters.filter(function(e){return e instanceof Ht&&e.field.isEqual(t)})}function Qt(e,t,n){var r,i=pt,a=!0,u=y(zt(e,t));try{for(u.s();!(r=u.n()).done;){var o=r.value,s=pt,c=!0;switch(o.op){case"<":case"<=":s=Lt(o.value);break;case"==":case"in":case">=":s=o.value;break;case">":s=o.value,c=!1;break;case"!=":case"not-in":s=pt}Mt({value:i,inclusive:a},{value:s,inclusive:c})<0&&(i=s,a=c)}}catch(h){u.e(h)}finally{u.f()}if(null!==n)for(var l=0;l<e.orderBy.length;++l)if(e.orderBy[l].field.isEqual(t)){var f=n.position[l];Mt({value:i,inclusive:a},{value:f,inclusive:n.inclusive})<0&&(i=f,a=n.inclusive);break}return{value:i,inclusive:a}}function Wt(e,t,n){var r,i=yt,a=!0,u=y(zt(e,t));try{for(u.s();!(r=u.n()).done;){var o=r.value,s=yt,c=!0;switch(o.op){case">=":case">":s=Vt(o.value),c=!1;break;case"==":case"in":case"<=":s=o.value;break;case"<":s=o.value,c=!1;break;case"!=":case"not-in":s=yt}Rt({value:i,inclusive:a},{value:s,inclusive:c})>0&&(i=s,a=c)}}catch(h){u.e(h)}finally{u.f()}if(null!==n)for(var l=0;l<e.orderBy.length;++l)if(e.orderBy[l].field.isEqual(t)){var f=n.position[l];Rt({value:i,inclusive:a},{value:f,inclusive:n.inclusive})>0&&(i=f,a=n.inclusive);break}return{value:i,inclusive:a}}var Ht=function(e){k(n,function(){function e(){L(this,e)}return M(e)}());var t=x(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this)).field=e,a.op=r,a.value=i,a}return M(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.at(wt(t,this.value)):null!==t&&mt(this.value)===mt(t)&&this.at(wt(t,this.value))}},{key:"at",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return z()}}},{key:"ht",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}],[{key:"create",value:function(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.ct(e,t,r):new Yt(e,t,r):"array-contains"===t?new Zt(e,r):"in"===t?new en(e,r):"not-in"===t?new tn(e,r):"array-contains-any"===t?new nn(e,r):new n(e,t,r)}},{key:"ct",value:function(e,t,n){return"in"===t?new Jt(e,n):new Xt(e,n)}}]),n}(),Yt=function(e){k(n,Ht);var t=x(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this,e,r,i)).key=ge.fromName(i.referenceValue),a}return M(n,[{key:"matches",value:function(e){var t=ge.comparator(e.key,this.key);return this.at(t)}}]),n}(),Jt=function(e){k(n,Ht);var t=x(n);function n(e,r){var i;return L(this,n),(i=t.call(this,e,"in",r)).keys=$t("in",r),i}return M(n,[{key:"matches",value:function(e){return this.keys.some(function(t){return t.isEqual(e.key)})}}]),n}(),Xt=function(e){k(n,Ht);var t=x(n);function n(e,r){var i;return L(this,n),(i=t.call(this,e,"not-in",r)).keys=$t("not-in",r),i}return M(n,[{key:"matches",value:function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})}}]),n}();function $t(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(e){return ge.fromName(e.referenceValue)})}var Zt=function(e){k(n,Ht);var t=x(n);function n(e,r){return L(this,n),t.call(this,e,"array-contains",r)}return M(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return St(t)&&kt(t.arrayValue,this.value)}}]),n}(),en=function(e){k(n,Ht);var t=x(n);function n(e,r){return L(this,n),t.call(this,e,"in",r)}return M(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return null!==t&&kt(this.value.arrayValue,t)}}]),n}(),tn=function(e){k(n,Ht);var t=x(n);function n(e,r){return L(this,n),t.call(this,e,"not-in",r)}return M(n,[{key:"matches",value:function(e){if(kt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!kt(this.value.arrayValue,t)}}]),n}(),nn=function(e){k(n,Ht);var t=x(n);function n(e,r){return L(this,n),t.call(this,e,"array-contains-any",r)}return M(n,[{key:"matches",value:function(e){var t=this,n=e.data.field(this.field);return!(!St(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(e){return kt(t.value.arrayValue,e)})}}]),n}(),rn=M(function e(t,n){L(this,e),this.position=t,this.inclusive=n}),an=M(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";L(this,e),this.field=t,this.dir=n});function un(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function on(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var a=t[i],u=e.position[i];if(r=a.field.isKeyField()?ge.comparator(ge.fromName(u.referenceValue),n.key):wt(u,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return r}function sn(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!gt(e.position[n],t.position[n]))return!1;return!0}var cn=M(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;L(this,e),this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=u,this.startAt=o,this.endAt=s,this.lt=null,this.ft=null,this.startAt,this.endAt});function ln(e,t,n,r,i,a,u,o){return new cn(e,t,n,r,i,a,u,o)}function fn(e){return new cn(e)}function hn(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function dn(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function vn(e){var t,n=y(e.filters);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.ht())return r.field}}catch(i){n.e(i)}finally{n.f()}return null}function yn(e){return null!==e.collectionGroup}function pn(e){var t=H(e);if(null===t.lt){t.lt=[];var n=vn(t),r=dn(t);if(null!==n&&null===r)n.isKeyField()||t.lt.push(new an(n)),t.lt.push(new an(me.keyField(),"asc"));else{var i,a=!1,u=y(t.explicitOrderBy);try{for(u.s();!(i=u.n()).done;){var o=i.value;t.lt.push(o),o.field.isKeyField()&&(a=!0)}}catch(c){u.e(c)}finally{u.f()}if(!a){var s=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.lt.push(new an(me.keyField(),s))}}}return t.lt}function mn(e){var t=H(e);if(!t.ft)if("F"===t.limitType)t.ft=Ut(t.path,t.collectionGroup,pn(t),t.filters,t.limit,t.startAt,t.endAt);else{var n,r=[],i=y(pn(t));try{for(i.s();!(n=i.n()).done;){var a=n.value,u="desc"===a.dir?"asc":"desc";r.push(new an(a.field,u))}}catch(c){i.e(c)}finally{i.f()}var o=t.endAt?new rn(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new rn(t.startAt.position,t.startAt.inclusive):null;t.ft=Ut(t.path,t.collectionGroup,r,t.filters,t.limit,o,s)}return t.ft}function gn(e,t,n){return new cn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function kn(e,t){return Gt(mn(e),mn(t))&&e.limitType===t.limitType}function wn(e){return"".concat(Bt(mn(e)),"|lt:").concat(e.limitType)}function xn(e){return"Query(target=".concat(Kt(mn(e)),"; limitType=").concat(e.limitType,")")}function bn(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ge.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){var n,r=y(e.explicitOrderBy);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=y(e.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(t))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){var r=on(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,pn(e),t))&&!(e.endAt&&!function(e,t,n){var r=on(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,pn(e),t))}(e,t)}function In(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function En(e){return function(t,n){var r,i=!1,a=y(pn(e));try{for(a.s();!(r=a.n()).done;){var u=r.value,o=Tn(u,t,n);if(0!==o)return o;i=i||u.field.isKeyField()}}catch(s){a.e(s)}finally{a.f()}return 0}}function Tn(e,t,n){var r=e.field.isKeyField()?ge.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?wt(r,i):z()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return z()}}function Sn(e,t){if(e.dt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:dt(t)?"-0":t}}function Dn(e){return{integerValue:""+e}}function _n(e,t){return vt(t)?Dn(t):Sn(e,t)}var An=M(function e(){L(this,e),this._=void 0});function Nn(e,t,n){return e instanceof Vn?function(e,t){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Mn?Rn(e,t):e instanceof On?Fn(e,t):function(e,t){var n=Ln(e,t),r=qn(n)+qn(e._t);return Tt(n)&&Tt(e._t)?Dn(r):Sn(e.wt,r)}(e,t)}function Cn(e,t,n){return e instanceof Mn?Rn(e,t):e instanceof On?Fn(e,t):n}function Ln(e,t){return e instanceof Pn?Tt(n=t)||n&&"doubleValue"in n?t:{integerValue:0}:null;var n}var Vn=function(e){k(n,An);var t=x(n);function n(){return L(this,n),t.apply(this,arguments)}return M(n)}(),Mn=function(e){k(n,An);var t=x(n);function n(e){var r;return L(this,n),(r=t.call(this)).elements=e,r}return M(n)}();function Rn(e,t){var n,r=Un(t),i=y(e.elements);try{var a=function(){var e=n.value;r.some(function(t){return gt(t,e)})||r.push(e)};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return{arrayValue:{values:r}}}var On=function(e){k(n,An);var t=x(n);function n(e){var r;return L(this,n),(r=t.call(this)).elements=e,r}return M(n)}();function Fn(e,t){var n,r=Un(t),i=y(e.elements);try{var a=function(){var e=n.value;r=r.filter(function(t){return!gt(t,e)})};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return{arrayValue:{values:r}}}var Pn=function(e){k(n,An);var t=x(n);function n(e,r){var i;return L(this,n),(i=t.call(this)).wt=e,i._t=r,i}return M(n)}();function qn(e){return at(e.integerValue||e.doubleValue)}function Un(e){return St(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var Bn=M(function e(t,n){L(this,e),this.field=t,this.transform=n});function Kn(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Mn&&t instanceof Mn||e instanceof On&&t instanceof On?le(e.elements,t.elements,gt):e instanceof Pn&&t instanceof Pn?gt(e._t,t._t):e instanceof Vn&&t instanceof Vn}(e.transform,t.transform)}var Gn=M(function e(t,n){L(this,e),this.version=t,this.transformResults=n}),jn=function(){function e(t,n){L(this,e),this.updateTime=t,this.exists=n}return M(e,[{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new e}},{key:"exists",value:function(t){return new e(void 0,t)}},{key:"updateTime",value:function(t){return new e(t)}}]),e}();function zn(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var Qn=M(function e(){L(this,e)});function Wn(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new ar(e.key,jn.none()):new $n(e.key,e.data,jn.none());var n,r=e.data,i=Ot.empty(),a=new Xe(me.comparator),u=y(t.fields);try{for(u.s();!(n=u.n()).done;){var o=n.value;if(!a.has(o)){var s=r.field(o);null===s&&o.length>1&&(o=o.popLast(),s=r.field(o)),null===s?i.delete(o):i.set(o,s),a=a.add(o)}}}catch(c){u.e(c)}finally{u.f()}return new Zn(e.key,i,new et(a.toArray()),jn.none())}function Hn(e,t,n){e instanceof $n?function(e,t,n){var r=e.value.clone(),i=tr(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Zn?function(e,t,n){if(zn(e.precondition,t)){var r=tr(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(er(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Yn(e,t,n,r){return e instanceof $n?function(e,t,n,r){if(!zn(e.precondition,t))return n;var i=e.value.clone(),a=nr(e.fieldTransforms,r,t);return i.setAll(a),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Zn?function(e,t,n,r){if(!zn(e.precondition,t))return n;var i=nr(e.fieldTransforms,r,t),a=t.data;return a.setAll(er(e)),a.setAll(i),t.convertToFoundDocument(t.version,a).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(function(e){return e.field}))}(e,t,n,r):function(e,t,n){return zn(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Jn(e,t){var n,r=null,i=y(e.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var a=n.value,u=t.data.field(a.field),o=Ln(a.transform,u||null);null!=o&&(null===r&&(r=Ot.empty()),r.set(a.field,o))}}catch(s){i.e(s)}finally{i.f()}return r||null}function Xn(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&le(e,t,function(e,t){return Kn(e,t)})}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}var $n=function(e){k(n,Qn);var t=x(n);function n(e,r,i){var a,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return L(this,n),(a=t.call(this)).key=e,a.value=r,a.precondition=i,a.fieldTransforms=u,a.type=0,a}return M(n,[{key:"getFieldMask",value:function(){return null}}]),n}(),Zn=function(e){k(n,Qn);var t=x(n);function n(e,r,i,a){var u,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return L(this,n),(u=t.call(this)).key=e,u.data=r,u.fieldMask=i,u.precondition=a,u.fieldTransforms=o,u.type=1,u}return M(n,[{key:"getFieldMask",value:function(){return this.fieldMask}}]),n}();function er(e){var t=new Map;return e.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}}),t}function tr(e,t,n){var r=new Map;Q(e.length===n.length);for(var i=0;i<n.length;i++){var a=e[i],u=a.transform,o=t.data.field(a.field);r.set(a.field,Cn(u,o,n[i]))}return r}function nr(e,t,n){var r,i=new Map,a=y(e);try{for(a.s();!(r=a.n()).done;){var u=r.value,o=u.transform,s=n.data.field(u.field);i.set(u.field,Nn(o,s,t))}}catch(c){a.e(c)}finally{a.f()}return i}var rr,ir,ar=function(e){k(n,Qn);var t=x(n);function n(e,r){var i;return L(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return M(n,[{key:"getFieldMask",value:function(){return null}}]),n}(),ur=function(e){k(n,Qn);var t=x(n);function n(e,r){var i;return L(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return M(n,[{key:"getFieldMask",value:function(){return null}}]),n}(),or=M(function e(t){L(this,e),this.count=t});function sr(e){switch(e){default:return z();case Y.CANCELLED:case Y.UNKNOWN:case Y.DEADLINE_EXCEEDED:case Y.RESOURCE_EXHAUSTED:case Y.INTERNAL:case Y.UNAVAILABLE:case Y.UNAUTHENTICATED:return!1;case Y.INVALID_ARGUMENT:case Y.NOT_FOUND:case Y.ALREADY_EXISTS:case Y.PERMISSION_DENIED:case Y.FAILED_PRECONDITION:case Y.ABORTED:case Y.OUT_OF_RANGE:case Y.UNIMPLEMENTED:case Y.DATA_LOSS:return!0}}function cr(e){if(void 0===e)return K("GRPC error has no .code"),Y.UNKNOWN;switch(e){case rr.OK:return Y.OK;case rr.CANCELLED:return Y.CANCELLED;case rr.UNKNOWN:return Y.UNKNOWN;case rr.DEADLINE_EXCEEDED:return Y.DEADLINE_EXCEEDED;case rr.RESOURCE_EXHAUSTED:return Y.RESOURCE_EXHAUSTED;case rr.INTERNAL:return Y.INTERNAL;case rr.UNAVAILABLE:return Y.UNAVAILABLE;case rr.UNAUTHENTICATED:return Y.UNAUTHENTICATED;case rr.INVALID_ARGUMENT:return Y.INVALID_ARGUMENT;case rr.NOT_FOUND:return Y.NOT_FOUND;case rr.ALREADY_EXISTS:return Y.ALREADY_EXISTS;case rr.PERMISSION_DENIED:return Y.PERMISSION_DENIED;case rr.FAILED_PRECONDITION:return Y.FAILED_PRECONDITION;case rr.ABORTED:return Y.ABORTED;case rr.OUT_OF_RANGE:return Y.OUT_OF_RANGE;case rr.UNIMPLEMENTED:return Y.UNIMPLEMENTED;case rr.DATA_LOSS:return Y.DATA_LOSS;default:return z()}}(ir=rr||(rr={}))[ir.OK=0]="OK",ir[ir.CANCELLED=1]="CANCELLED",ir[ir.UNKNOWN=2]="UNKNOWN",ir[ir.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ir[ir.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ir[ir.NOT_FOUND=5]="NOT_FOUND",ir[ir.ALREADY_EXISTS=6]="ALREADY_EXISTS",ir[ir.PERMISSION_DENIED=7]="PERMISSION_DENIED",ir[ir.UNAUTHENTICATED=16]="UNAUTHENTICATED",ir[ir.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ir[ir.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ir[ir.ABORTED=10]="ABORTED",ir[ir.OUT_OF_RANGE=11]="OUT_OF_RANGE",ir[ir.UNIMPLEMENTED=12]="UNIMPLEMENTED",ir[ir.INTERNAL=13]="INTERNAL",ir[ir.UNAVAILABLE=14]="UNAVAILABLE",ir[ir.DATA_LOSS=15]="DATA_LOSS";var lr=function(){function e(t,n){L(this,e),this.mapKeyFn=t,this.equalsFn=n,this.inner={},this.innerSize=0}return M(e,[{key:"get",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,i=y(n);try{for(i.s();!(r=i.n()).done;){var a=l(r.value,2),u=a[0],o=a[1];if(this.equalsFn(u,e))return o}}catch(s){i.e(s)}finally{i.f()}}}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"set",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}},{key:"delete",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}},{key:"forEach",value:function(e){Qe(this.inner,function(t,n){var r,i=y(n);try{for(i.s();!(r=i.n()).done;){var a=l(r.value,2),u=a[0],o=a[1];e(u,o)}}catch(s){i.e(s)}finally{i.f()}})}},{key:"isEmpty",value:function(){return We(this.inner)}},{key:"size",value:function(){return this.innerSize}}]),e}(),fr=new He(ge.comparator);function hr(){return fr}var dr=new He(ge.comparator);function vr(){for(var e=dr,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var u=a[i];e=e.insert(u.key,u)}return e}function yr(e){var t=dr;return e.forEach(function(e,n){return t=t.insert(e,n.overlayedDocument)}),t}function pr(){return gr()}function mr(){return gr()}function gr(){return new lr(function(e){return e.toString()},function(e,t){return e.isEqual(t)})}var kr=new He(ge.comparator),wr=new Xe(ge.comparator);function xr(){for(var e=wr,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var u=a[i];e=e.add(u)}return e}var br=new Xe(ce);function Ir(){return br}var Er=function(){function e(t,n,r,i,a){L(this,e),this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}return M(e,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(t,n){var r=new Map;return r.set(t,Tr.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(de.min(),r,Ir(),hr(),xr())}}]),e}(),Tr=function(){function e(t,n,r,i,a){L(this,e),this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}return M(e,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(t,n){return new e(nt.EMPTY_BYTE_STRING,n,xr(),xr(),xr())}}]),e}(),Sr=M(function e(t,n,r,i){L(this,e),this.gt=t,this.removedTargetIds=n,this.key=r,this.yt=i}),Dr=M(function e(t,n){L(this,e),this.targetId=t,this.It=n}),_r=M(function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:nt.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;L(this,e),this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=i}),Ar=function(){function e(){L(this,e),this.Tt=0,this.Et=Lr(),this.At=nt.EMPTY_BYTE_STRING,this.Rt=!1,this.bt=!0}return M(e,[{key:"current",get:function(){return this.Rt}},{key:"resumeToken",get:function(){return this.At}},{key:"Pt",get:function(){return 0!==this.Tt}},{key:"vt",get:function(){return this.bt}},{key:"Vt",value:function(e){e.approximateByteSize()>0&&(this.bt=!0,this.At=e)}},{key:"St",value:function(){var e=xr(),t=xr(),n=xr();return this.Et.forEach(function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:z()}}),new Tr(this.At,this.Rt,e,t,n)}},{key:"Dt",value:function(){this.bt=!1,this.Et=Lr()}},{key:"Ct",value:function(e,t){this.bt=!0,this.Et=this.Et.insert(e,t)}},{key:"xt",value:function(e){this.bt=!0,this.Et=this.Et.remove(e)}},{key:"Nt",value:function(){this.Tt+=1}},{key:"kt",value:function(){this.Tt-=1}},{key:"Ot",value:function(){this.bt=!0,this.Rt=!0}}]),e}(),Nr=function(){function e(t){L(this,e),this.Mt=t,this.Ft=new Map,this.$t=hr(),this.Bt=Cr(),this.Lt=new Xe(ce)}return M(e,[{key:"Ut",value:function(e){var t,n=y(e.gt);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.yt&&e.yt.isFoundDocument()?this.qt(r,e.yt):this.Kt(r,e.key,e.yt)}}catch(o){n.e(o)}finally{n.f()}var i,a=y(e.removedTargetIds);try{for(a.s();!(i=a.n()).done;){var u=i.value;this.Kt(u,e.key,e.yt)}}catch(o){a.e(o)}finally{a.f()}}},{key:"Gt",value:function(e){var t=this;this.forEachTarget(e,function(n){var r=t.Qt(n);switch(e.state){case 0:t.jt(n)&&r.Vt(e.resumeToken);break;case 1:r.kt(),r.Pt||r.Dt(),r.Vt(e.resumeToken);break;case 2:r.kt(),r.Pt||t.removeTarget(n);break;case 3:t.jt(n)&&(r.Ot(),r.Vt(e.resumeToken));break;case 4:t.jt(n)&&(t.Wt(n),r.Vt(e.resumeToken));break;default:z()}})}},{key:"forEachTarget",value:function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.Ft.forEach(function(e,r){n.jt(r)&&t(r)})}},{key:"zt",value:function(e){var t=e.targetId,n=e.It.count,r=this.Ht(t);if(r){var i=r.target;if(jt(i))if(0===n){var a=new ge(i.path);this.Kt(t,a,Pt.newNoDocument(a,de.min()))}else Q(1===n);else this.Jt(t)!==n&&(this.Wt(t),this.Lt=this.Lt.add(t))}}},{key:"Yt",value:function(e){var t=this,n=new Map;this.Ft.forEach(function(r,i){var a=t.Ht(i);if(a){if(r.current&&jt(a.target)){var u=new ge(a.target.path);null!==t.$t.get(u)||t.Xt(i,u)||t.Kt(i,u,Pt.newNoDocument(u,e))}r.vt&&(n.set(i,r.St()),r.Dt())}});var r=xr();this.Bt.forEach(function(e,n){var i=!0;n.forEachWhile(function(e){var n=t.Ht(e);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(e))}),this.$t.forEach(function(t,n){return n.setReadTime(e)});var i=new Er(e,n,this.Lt,this.$t,r);return this.$t=hr(),this.Bt=Cr(),this.Lt=new Xe(ce),i}},{key:"qt",value:function(e,t){if(this.jt(e)){var n=this.Xt(e,t.key)?2:0;this.Qt(e).Ct(t.key,n),this.$t=this.$t.insert(t.key,t),this.Bt=this.Bt.insert(t.key,this.Zt(t.key).add(e))}}},{key:"Kt",value:function(e,t,n){if(this.jt(e)){var r=this.Qt(e);this.Xt(e,t)?r.Ct(t,1):r.xt(t),this.Bt=this.Bt.insert(t,this.Zt(t).delete(e)),n&&(this.$t=this.$t.insert(t,n))}}},{key:"removeTarget",value:function(e){this.Ft.delete(e)}},{key:"Jt",value:function(e){var t=this.Qt(e).St();return this.Mt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:"Nt",value:function(e){this.Qt(e).Nt()}},{key:"Qt",value:function(e){var t=this.Ft.get(e);return t||(t=new Ar,this.Ft.set(e,t)),t}},{key:"Zt",value:function(e){var t=this.Bt.get(e);return t||(t=new Xe(ce),this.Bt=this.Bt.insert(e,t)),t}},{key:"jt",value:function(e){var t=null!==this.Ht(e);return t||B("WatchChangeAggregator","Detected inactive target",e),t}},{key:"Ht",value:function(e){var t=this.Ft.get(e);return t&&t.Pt?null:this.Mt.te(e)}},{key:"Wt",value:function(e){var t=this;this.Ft.set(e,new Ar),this.Mt.getRemoteKeysForTarget(e).forEach(function(n){t.Kt(e,n,null)})}},{key:"Xt",value:function(e,t){return this.Mt.getRemoteKeysForTarget(e).has(t)}}]),e}();function Cr(){return new He(ge.comparator)}function Lr(){return new He(ge.comparator)}var Vr={asc:"ASCENDING",desc:"DESCENDING"},Mr={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Rr=M(function e(t,n){L(this,e),this.databaseId=t,this.dt=n});function Or(e,t){return e.dt?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Fr(e,t){return e.dt?t.toBase64():t.toUint8Array()}function Pr(e,t){return Or(e,t.toTimestamp())}function qr(e){return Q(!!e),de.fromTimestamp(function(e){var t=it(e);return new he(t.seconds,t.nanos)}(e))}function Ur(e,t){return function(e){return new ye(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Br(e){var t=ye.fromString(e);return Q(di(t)),t}function Kr(e,t){return Ur(e.databaseId,t.path)}function Gr(e,t){var n=Br(t);if(n.get(1)!==e.databaseId.projectId)throw new J(Y.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new J(Y.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ge(Wr(n))}function jr(e,t){return Ur(e.databaseId,t)}function zr(e){var t=Br(e);return 4===t.length?ye.emptyPath():Wr(t)}function Qr(e){return new ye(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Wr(e){return Q(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Hr(e,t,n){return{name:Kr(e,t),fields:n.value.mapValue.fields}}function Yr(e,t,n){var r=Gr(e,t.name),i=qr(t.updateTime),a=new Ot({mapValue:{fields:t.fields}}),u=Pt.newFoundDocument(r,i,a);return n&&u.setHasCommittedMutations(),n?u.setHasCommittedMutations():u}function Jr(e,t){return"found"in t?function(e,t){Q(!!t.found),t.found.name,t.found.updateTime;var n=Gr(e,t.found.name),r=qr(t.found.updateTime),i=new Ot({mapValue:{fields:t.found.fields}});return Pt.newFoundDocument(n,r,i)}(e,t):"missing"in t?function(e,t){Q(!!t.missing),Q(!!t.readTime);var n=Gr(e,t.missing),r=qr(t.readTime);return Pt.newNoDocument(n,r)}(e,t):z()}function Xr(e,t){var n;if("targetChange"in t){t.targetChange;var r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:z()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],a=function(e,t){return e.dt?(Q(void 0===t||"string"==typeof t),nt.fromBase64String(t||"")):(Q(void 0===t||t instanceof Uint8Array),nt.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),u=t.targetChange.cause,o=u&&function(e){var t=void 0===e.code?Y.UNKNOWN:cr(e.code);return new J(t,e.message||"")}(u);n=new _r(r,i,a,o||null)}else if("documentChange"in t){t.documentChange;var s=t.documentChange;s.document,s.document.name,s.document.updateTime;var c=Gr(e,s.document.name),l=qr(s.document.updateTime),f=new Ot({mapValue:{fields:s.document.fields}}),h=Pt.newFoundDocument(c,l,f),d=s.targetIds||[],v=s.removedTargetIds||[];n=new Sr(d,v,h.key,h)}else if("documentDelete"in t){t.documentDelete;var y=t.documentDelete;y.document;var p=Gr(e,y.document),m=y.readTime?qr(y.readTime):de.min(),g=Pt.newNoDocument(p,m),k=y.removedTargetIds||[];n=new Sr([],k,g.key,g)}else if("documentRemove"in t){t.documentRemove;var w=t.documentRemove;w.document;var x=Gr(e,w.document),b=w.removedTargetIds||[];n=new Sr([],b,x,null)}else{if(!("filter"in t))return z();t.filter;var I=t.filter;I.targetId;var E=I.count||0,T=new or(E),S=I.targetId;n=new Dr(S,T)}return n}function $r(e,t){var n;if(t instanceof $n)n={update:Hr(e,t.key,t.value)};else if(t instanceof ar)n={delete:Kr(e,t.key)};else if(t instanceof Zn)n={update:Hr(e,t.key,t.data),updateMask:hi(t.fieldMask)};else{if(!(t instanceof ur))return z();n={verify:Kr(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(function(e){return function(e,t){var n=t.transform;if(n instanceof Vn)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Mn)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof On)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Pn)return{fieldPath:t.field.canonicalString(),increment:n._t};throw z()}(0,e)})),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Pr(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:z()}(e,t.precondition)),n}function Zr(e,t){var n=t.currentDocument?function(e){return void 0!==e.updateTime?jn.updateTime(qr(e.updateTime)):void 0!==e.exists?jn.exists(e.exists):jn.none()}(t.currentDocument):jn.none(),r=t.updateTransforms?t.updateTransforms.map(function(t){return function(e,t){var n=null;if("setToServerValue"in t)Q("REQUEST_TIME"===t.setToServerValue),n=new Vn;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new Mn(r)}else if("removeAllFromArray"in t){var i=t.removeAllFromArray.values||[];n=new On(i)}else"increment"in t?n=new Pn(e,t.increment):z();var a=me.fromServerFormat(t.fieldPath);return new Bn(a,n)}(e,t)}):[];if(t.update){t.update.name;var i=Gr(e,t.update.name),a=new Ot({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=function(e){var t=e.fieldPaths||[];return new et(t.map(function(e){return me.fromServerFormat(e)}))}(t.updateMask);return new Zn(i,a,u,n,r)}return new $n(i,a,n,r)}if(t.delete){var o=Gr(e,t.delete);return new ar(o,n)}if(t.verify){var s=Gr(e,t.verify);return new ur(s,n)}return z()}function ei(e,t){return e&&e.length>0?(Q(void 0!==t),e.map(function(e){return function(e,t){var n=e.updateTime?qr(e.updateTime):qr(t);return n.isEqual(de.min())&&(n=qr(t)),new Gn(n,e.transformResults||[])}(e,t)})):[]}function ti(e,t){return{documents:[jr(e,t.path)]}}function ni(e,t){var n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=jr(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=jr(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){var t=e.map(function(e){return function(e){if("=="===e.op){if(_t(e.value))return{unaryFilter:{field:si(e.field),op:"IS_NAN"}};if(Dt(e.value))return{unaryFilter:{field:si(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(_t(e.value))return{unaryFilter:{field:si(e.field),op:"IS_NOT_NAN"}};if(Dt(e.value))return{unaryFilter:{field:si(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:si(e.field),op:oi(e.op),value:e.value}}}(e)});return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(t.filters);i&&(n.structuredQuery.where=i);var a=function(e){if(0!==e.length)return e.map(function(e){return function(e){return{field:si(e.field),direction:ui(e.dir)}}(e)})}(t.orderBy);a&&(n.structuredQuery.orderBy=a);var u,o=function(e,t){return e.dt||ht(t)?t:{value:t}}(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(u=t.startAt).inclusive,values:u.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function ri(e){var t=zr(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Q(1===r);var a=n.from[0];a.allDescendants?i=a.collectionId:t=t.child(a.collectionId)}var u=[];n.where&&(u=ai(n.where));var o=[];n.orderBy&&(o=n.orderBy.map(function(e){return function(e){return new an(ci(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)}));var s=null;n.limit&&(s=function(e){var t;return ht(t="object"==v(e)?e.value:e)?null:t}(n.limit));var c=null;n.startAt&&(c=function(e){var t=!!e.before,n=e.values||[];return new rn(n,t)}(n.startAt));var l=null;return n.endAt&&(l=function(e){var t=!e.before,n=e.values||[];return new rn(n,t)}(n.endAt)),ln(t,i,o,u,s,"F",c,l)}function ii(e,t){var n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return z()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}function ai(e){return e?void 0!==e.unaryFilter?[fi(e)]:void 0!==e.fieldFilter?[li(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(function(e){return ai(e)}).reduce(function(e,t){return e.concat(t)}):z():[]}function ui(e){return Vr[e]}function oi(e){return Mr[e]}function si(e){return{fieldPath:e.canonicalString()}}function ci(e){return me.fromServerFormat(e.fieldPath)}function li(e){return Ht.create(ci(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return z()}}(e.fieldFilter.op),e.fieldFilter.value)}function fi(e){switch(e.unaryFilter.op){case"IS_NAN":var t=ci(e.unaryFilter.field);return Ht.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=ci(e.unaryFilter.field);return Ht.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ci(e.unaryFilter.field);return Ht.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ci(e.unaryFilter.field);return Ht.create(i,"!=",{nullValue:"NULL_VALUE"});default:return z()}}function hi(e){var t=[];return e.fields.forEach(function(e){return t.push(e.canonicalString())}),{fieldPaths:t}}function di(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function vi(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=pi(t)),t=yi(e.get(n),t);return pi(t)}function yi(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var a=e.charAt(i);switch(a){case"\0":n+="";break;case"":n+="";break;default:n+=a}}return n}function pi(e){return e+""}function mi(e){var t=e.length;if(Q(t>=2),2===t)return Q(""===e.charAt(0)&&""===e.charAt(1)),ye.emptyPath();for(var n=t-2,r=[],i="",a=0;a<t;){var u=e.indexOf("",a);switch((u<0||u>n)&&z(),e.charAt(u+1)){case"":var o=e.substring(a,u),s=void 0;0===i.length?s=o:(s=i+=o,i=""),r.push(s);break;case"":i+=e.substring(a,u),i+="\0";break;case"":i+=e.substring(a,u+1);break;default:z()}a=u+2}return new ye(r)}var gi=["userId","batchId"];function ki(e,t){return[e,vi(t)]}function wi(e,t,n){return[e,vi(t),n]}var xi={},bi=["prefixPath","collectionGroup","readTime","documentId"],Ii=["prefixPath","collectionGroup","documentId"],Ei=["collectionGroup","readTime","prefixPath","documentId"],Ti=["canonicalId","targetId"],Si=["targetId","path"],Di=["path","targetId"],_i=["collectionId","parent"],Ai=["indexId","uid"],Ni=["uid","sequenceNumber"],Ci=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Li=["indexId","uid","orderedDocumentKey"],Vi=["userId","collectionPath","documentId"],Mi=["userId","collectionPath","largestBatchId"],Ri=["userId","collectionGroup","largestBatchId"],Oi=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments"].concat(["clientMetadata"]).concat(["remoteDocumentGlobal"]).concat(["collectionParents"]).concat(["bundles","namedQueries"]),Fi=[].concat(S(Oi),["documentOverlays"]),Pi=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],qi=Pi,Ui=[].concat(qi,["indexConfiguration","indexState","indexEntries"]),Bi=function(e){k(n,Ae);var t=x(n);function n(e,r){var i;return L(this,n),(i=t.call(this)).ee=e,i.currentSequenceNumber=r,i}return M(n)}();function Ki(e,t){var n=H(e);return Me.N(n.ee,t)}var Gi=function(){function e(t,n,r,i){L(this,e),this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return M(e,[{key:"applyToRemoteDocument",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&Hn(i,e,n[r])}}},{key:"applyToLocalView",value:function(e,t){var n,r=y(this.baseMutations);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.key.isEqual(e.key)&&(t=Yn(i,e,t,this.localWriteTime))}}catch(s){r.e(s)}finally{r.f()}var a,u=y(this.mutations);try{for(u.s();!(a=u.n()).done;){var o=a.value;o.key.isEqual(e.key)&&(t=Yn(o,e,t,this.localWriteTime))}}catch(s){u.e(s)}finally{u.f()}return t}},{key:"applyToLocalDocumentSet",value:function(e,t){var n=this,r=mr();return this.mutations.forEach(function(i){var a=e.get(i.key),u=a.overlayedDocument,o=n.applyToLocalView(u,a.mutatedFields),s=Wn(u,o=t.has(i.key)?null:o);null!==s&&r.set(i.key,s),u.isValidDocument()||u.convertToNoDocument(de.min())}),r}},{key:"keys",value:function(){return this.mutations.reduce(function(e,t){return e.add(t.key)},xr())}},{key:"isEqual",value:function(e){return this.batchId===e.batchId&&le(this.mutations,e.mutations,function(e,t){return Xn(e,t)})&&le(this.baseMutations,e.baseMutations,function(e,t){return Xn(e,t)})}}]),e}(),ji=function(){function e(t,n,r,i){L(this,e),this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return M(e,null,[{key:"from",value:function(t,n,r){Q(t.mutations.length===r.length);for(var i=kr,a=t.mutations,u=0;u<a.length;u++)i=i.insert(a[u].key,r[u].version);return new e(t,n,r,i)}}]),e}(),zi=function(){function e(t,n){L(this,e),this.largestBatchId=t,this.mutation=n}return M(e,[{key:"getKey",value:function(){return this.mutation.key}},{key:"isEqual",value:function(e){return null!==e&&this.mutation===e.mutation}},{key:"toString",value:function(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}]),e}(),Qi=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:de.min(),u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:de.min(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:nt.EMPTY_BYTE_STRING;L(this,e),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=o}return M(e,[{key:"withSequenceNumber",value:function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}},{key:"withResumeToken",value:function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)}},{key:"withLastLimboFreeSnapshotVersion",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}]),e}(),Wi=M(function e(t){L(this,e),this.ne=t});function Hi(e,t){var n;if(t.document)n=Yr(e.ne,t.document,!!t.hasCommittedMutations);else if(t.noDocument){var r=ge.fromSegments(t.noDocument.path),i=$i(t.noDocument.readTime);n=Pt.newNoDocument(r,i),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return z();var a=ge.fromSegments(t.unknownDocument.path),u=$i(t.unknownDocument.version);n=Pt.newUnknownDocument(a,u)}return t.readTime&&n.setReadTime(function(e){var t=new he(e[0],e[1]);return de.fromTimestamp(t)}(t.readTime)),n}function Yi(e,t){var n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Ji(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Kr(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Or(e,t.version.toTimestamp())}}(e.ne,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Xi(t.version)};else{if(!t.isUnknownDocument())return z();r.unknownDocument={path:n.path.toArray(),version:Xi(t.version)}}return r}function Ji(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Xi(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function $i(e){var t=new he(e.seconds,e.nanoseconds);return de.fromTimestamp(t)}function Zi(e,t){for(var n=(t.baseMutations||[]).map(function(t){return Zr(e.ne,t)}),r=0;r<t.mutations.length-1;++r){var i=t.mutations[r];if(r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform){var a=t.mutations[r+1];i.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var u=t.mutations.map(function(t){return Zr(e.ne,t)}),o=he.fromMillis(t.localWriteTimeMs);return new Gi(t.batchId,o,n,u)}function ea(e){var t,n,r=$i(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?$i(e.lastLimboFreeSnapshotVersion):de.min();return void 0!==e.query.documents?(Q(1===(n=e.query).documents.length),t=mn(fn(zr(n.documents[0])))):t=function(e){return mn(ri(e))}(e.query),new Qi(t,e.targetId,0,e.lastListenSequenceNumber,r,i,nt.fromBase64String(e.resumeToken))}function ta(e,t){var n,r=Xi(t.snapshotVersion),i=Xi(t.lastLimboFreeSnapshotVersion);n=jt(t.target)?ti(e.ne,t.target):ni(e.ne,t.target);var a=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Bt(t.target),readTime:r,resumeToken:a,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function na(e){var t=ri({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?gn(t,t.limit,"L"):t}function ra(e,t){return new zi(t.largestBatchId,Zr(e.ne,t.overlayMutation))}function ia(e,t){var n=t.path.lastSegment();return[e,vi(t.path.popLast()),n]}function aa(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Xi(r.readTime),documentKey:vi(r.documentKey.path),largestBatchId:r.largestBatchId}}var ua=function(){function e(){L(this,e)}return M(e,[{key:"getBundleMetadata",value:function(e,t){return oa(e).get(t).next(function(e){if(e)return{id:(t=e).bundleId,createTime:$i(t.createTime),version:t.version};var t})}},{key:"saveBundleMetadata",value:function(e,t){return oa(e).put({bundleId:(n=t).id,createTime:Xi(qr(n.createTime)),version:n.version});var n}},{key:"getNamedQuery",value:function(e,t){return sa(e).get(t).next(function(e){if(e)return{name:(t=e).name,query:na(t.bundledQuery),readTime:$i(t.readTime)};var t})}},{key:"saveNamedQuery",value:function(e,t){return sa(e).put(function(e){return{name:e.name,readTime:Xi(qr(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}]),e}();function oa(e){return Ki(e,"bundles")}function sa(e){return Ki(e,"namedQueries")}var ca=function(){function e(t,n){L(this,e),this.wt=t,this.userId=n}return M(e,[{key:"getOverlay",value:function(e,t){var n=this;return la(e).get(ia(this.userId,t)).next(function(e){return e?ra(n.wt,e):null})}},{key:"getOverlays",value:function(e,t){var n=this,r=pr();return Le.forEach(t,function(t){return n.getOverlay(e,t).next(function(e){null!==e&&r.set(t,e)})}).next(function(){return r})}},{key:"saveOverlays",value:function(e,t,n){var r=this,i=[];return n.forEach(function(n,a){var u=new zi(t,a);i.push(r.ie(e,u))}),Le.waitFor(i)}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,i=new Set;t.forEach(function(e){return i.add(vi(e.getCollectionPath()))});var a=[];return i.forEach(function(t){var i=IDBKeyRange.bound([r.userId,t,n],[r.userId,t,n+1],!1,!0);a.push(la(e).W("collectionPathOverlayIndex",i))}),Le.waitFor(a)}},{key:"getOverlaysForCollection",value:function(e,t,n){var r=this,i=pr(),a=vi(t),u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,Number.POSITIVE_INFINITY],!0);return la(e).K("collectionPathOverlayIndex",u).next(function(e){var t,n=y(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,u=ra(r.wt,a);i.set(u.getKey(),u)}}catch(o){n.e(o)}finally{n.f()}return i})}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){var i,a=this,u=pr(),o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return la(e).J({index:"collectionGroupOverlayIndex",range:o},function(e,t,n){var o=ra(a.wt,t);u.size()<r||o.largestBatchId===i?(u.set(o.getKey(),o),i=o.largestBatchId):n.done()}).next(function(){return u})}},{key:"ie",value:function(e,t){return la(e).put(function(e,t,n){var r=l(ia(t,n.mutation.key),3);r[0];return{userId:t,collectionPath:r[1],documentId:r[2],collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:$r(e.ne,n.mutation)}}(this.wt,this.userId,t))}}],[{key:"se",value:function(t,n){return new e(t,n.uid||"")}}]),e}();function la(e){return Ki(e,"documentOverlays")}var fa=function(){function e(){L(this,e)}return M(e,[{key:"re",value:function(e,t){this.oe(e,t),t.ue()}},{key:"oe",value:function(e,t){if("nullValue"in e)this.ce(t,5);else if("booleanValue"in e)this.ce(t,10),t.ae(e.booleanValue?1:0);else if("integerValue"in e)this.ce(t,15),t.ae(at(e.integerValue));else if("doubleValue"in e){var n=at(e.doubleValue);isNaN(n)?this.ce(t,13):(this.ce(t,15),dt(n)?t.ae(0):t.ae(n))}else if("timestampValue"in e){var r=e.timestampValue;this.ce(t,20),"string"==typeof r?t.he(r):(t.he("".concat(r.seconds||"")),t.ae(r.nanos||0))}else if("stringValue"in e)this.le(e.stringValue,t),this.fe(t);else if("bytesValue"in e)this.ce(t,30),t.de(ut(e.bytesValue)),this.fe(t);else if("referenceValue"in e)this._e(e.referenceValue,t);else if("geoPointValue"in e){var i=e.geoPointValue;this.ce(t,45),t.ae(i.latitude||0),t.ae(i.longitude||0)}else"mapValue"in e?Ct(e)?this.ce(t,Number.MAX_SAFE_INTEGER):(this.we(e.mapValue,t),this.fe(t)):"arrayValue"in e?(this.me(e.arrayValue,t),this.fe(t)):z()}},{key:"le",value:function(e,t){this.ce(t,25),this.ge(e,t)}},{key:"ge",value:function(e,t){t.he(e)}},{key:"we",value:function(e,t){var n=e.fields||{};this.ce(t,55);for(var r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];this.le(a,t),this.oe(n[a],t)}}},{key:"me",value:function(e,t){var n=e.values||[];this.ce(t,50);var r,i=y(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.oe(a,t)}}catch(u){i.e(u)}finally{i.f()}}},{key:"_e",value:function(e,t){var n=this;this.ce(t,37),ge.fromName(e).path.forEach(function(e){n.ce(t,60),n.ge(e,t)})}},{key:"ce",value:function(e,t){e.ae(t)}},{key:"fe",value:function(e){e.ae(2)}}]),e}();function ha(e){if(0===e)return 8;var t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function da(e){var t=64-function(e){for(var t=0,n=0;n<8;++n){var r=ha(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}fa.ye=new fa;var va=function(){function e(){L(this,e),this.buffer=new Uint8Array(1024),this.position=0}return M(e,[{key:"pe",value:function(e){for(var t=e[Symbol.iterator](),n=t.next();!n.done;)this.Ie(n.value),n=t.next();this.Te()}},{key:"Ee",value:function(e){for(var t=e[Symbol.iterator](),n=t.next();!n.done;)this.Ae(n.value),n=t.next();this.Re()}},{key:"be",value:function(e){var t,n=y(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.charCodeAt(0);if(i<128)this.Ie(i);else if(i<2048)this.Ie(960|i>>>6),this.Ie(128|63&i);else if(r<"\ud800"||"\udbff"<r)this.Ie(480|i>>>12),this.Ie(128|63&i>>>6),this.Ie(128|63&i);else{var a=r.codePointAt(0);this.Ie(240|a>>>18),this.Ie(128|63&a>>>12),this.Ie(128|63&a>>>6),this.Ie(128|63&a)}}}catch(u){n.e(u)}finally{n.f()}this.Te()}},{key:"Pe",value:function(e){var t,n=y(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.charCodeAt(0);if(i<128)this.Ae(i);else if(i<2048)this.Ae(960|i>>>6),this.Ae(128|63&i);else if(r<"\ud800"||"\udbff"<r)this.Ae(480|i>>>12),this.Ae(128|63&i>>>6),this.Ae(128|63&i);else{var a=r.codePointAt(0);this.Ae(240|a>>>18),this.Ae(128|63&a>>>12),this.Ae(128|63&a>>>6),this.Ae(128|63&a)}}}catch(u){n.e(u)}finally{n.f()}this.Re()}},{key:"ve",value:function(e){var t=this.Ve(e),n=da(t);this.Se(1+n),this.buffer[this.position++]=255&n;for(var r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}},{key:"De",value:function(e){var t=this.Ve(e),n=da(t);this.Se(1+n),this.buffer[this.position++]=~(255&n);for(var r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}},{key:"Ce",value:function(){this.xe(255),this.xe(255)}},{key:"Ne",value:function(){this.ke(255),this.ke(255)}},{key:"reset",value:function(){this.position=0}},{key:"seed",value:function(e){this.Se(e.length),this.buffer.set(e,this.position),this.position+=e.length}},{key:"Oe",value:function(){return this.buffer.slice(0,this.position)}},{key:"Ve",value:function(e){var t=function(e){var t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(var r=1;r<t.length;++r)t[r]^=n?255:0;return t}},{key:"Ie",value:function(e){var t=255&e;0===t?(this.xe(0),this.xe(255)):255===t?(this.xe(255),this.xe(0)):this.xe(t)}},{key:"Ae",value:function(e){var t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(e)}},{key:"Te",value:function(){this.xe(0),this.xe(1)}},{key:"Re",value:function(){this.ke(0),this.ke(1)}},{key:"xe",value:function(e){this.Se(1),this.buffer[this.position++]=e}},{key:"ke",value:function(e){this.Se(1),this.buffer[this.position++]=~e}},{key:"Se",value:function(e){var t=e+this.position;if(!(t<=this.buffer.length)){var n=2*this.buffer.length;n<t&&(n=t);var r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}}]),e}(),ya=function(){function e(t){L(this,e),this.Me=t}return M(e,[{key:"de",value:function(e){this.Me.pe(e)}},{key:"he",value:function(e){this.Me.be(e)}},{key:"ae",value:function(e){this.Me.ve(e)}},{key:"ue",value:function(){this.Me.Ce()}}]),e}(),pa=function(){function e(t){L(this,e),this.Me=t}return M(e,[{key:"de",value:function(e){this.Me.Ee(e)}},{key:"he",value:function(e){this.Me.Pe(e)}},{key:"ae",value:function(e){this.Me.De(e)}},{key:"ue",value:function(){this.Me.Ne()}}]),e}(),ma=function(){function e(){L(this,e),this.Me=new va,this.Fe=new ya(this.Me),this.$e=new pa(this.Me)}return M(e,[{key:"seed",value:function(e){this.Me.seed(e)}},{key:"Be",value:function(e){return 0===e?this.Fe:this.$e}},{key:"Oe",value:function(){return this.Me.Oe()}},{key:"reset",value:function(){this.Me.reset()}}]),e}(),ga=function(){function e(t,n,r,i){L(this,e),this.indexId=t,this.documentKey=n,this.arrayValue=r,this.directionalValue=i}return M(e,[{key:"Le",value:function(){var t=this.directionalValue.length,n=0===t||255===this.directionalValue[t-1]?t+1:t,r=new Uint8Array(n);return r.set(this.directionalValue,0),n!==t?r.set([0],this.directionalValue.length):++r[r.length-1],new e(this.indexId,this.documentKey,this.arrayValue,r)}}]),e}();function ka(e,t){var n=e.indexId-t.indexId;return 0!==n?n:0!==(n=wa(e.arrayValue,t.arrayValue))?n:0!==(n=wa(e.directionalValue,t.directionalValue))?n:ge.comparator(e.documentKey,t.documentKey)}function wa(e,t){for(var n=0;n<e.length&&n<t.length;++n){var r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}var xa=function(){function e(t){L(this,e),this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.Ue=t.orderBy,this.qe=[];var n,r=y(t.filters);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.ht()?this.Ke=i:this.qe.push(i)}}catch(a){r.e(a)}finally{r.f()}}return M(e,[{key:"Ge",value:function(e){var t=we(e);if(void 0!==t&&!this.Qe(t))return!1;for(var n=xe(e),r=0,i=0;r<n.length&&this.Qe(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Ke){var a=n[r];if(!this.je(this.Ke,a)||!this.We(this.Ue[i++],a))return!1;++r}for(;r<n.length;++r){var u=n[r];if(i>=this.Ue.length||!this.We(this.Ue[i++],u))return!1}return!0}},{key:"Qe",value:function(e){var t,n=y(this.qe);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(this.je(r,e))return!0}}catch(i){n.e(i)}finally{n.f()}return!1}},{key:"je",value:function(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}},{key:"We",value:function(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}]),e}(),ba=function(){function e(){L(this,e),this.ze=new Ia}return M(e,[{key:"addToCollectionParentIndex",value:function(e,t){return this.ze.add(t),Le.resolve()}},{key:"getCollectionParents",value:function(e,t){return Le.resolve(this.ze.getEntries(t))}},{key:"addFieldIndex",value:function(e,t){return Le.resolve()}},{key:"deleteFieldIndex",value:function(e,t){return Le.resolve()}},{key:"getDocumentsMatchingTarget",value:function(e,t){return Le.resolve(null)}},{key:"getIndexType",value:function(e,t){return Le.resolve(0)}},{key:"getFieldIndexes",value:function(e,t){return Le.resolve([])}},{key:"getNextCollectionGroupToUpdate",value:function(e){return Le.resolve(null)}},{key:"getMinOffset",value:function(e,t){return Le.resolve(Se.min())}},{key:"getMinOffsetFromCollectionGroup",value:function(e,t){return Le.resolve(Se.min())}},{key:"updateCollectionGroup",value:function(e,t,n){return Le.resolve()}},{key:"updateIndexEntries",value:function(e,t){return Le.resolve()}}]),e}(),Ia=function(){function e(){L(this,e),this.index={}}return M(e,[{key:"add",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Xe(ye.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}},{key:"has",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:"getEntries",value:function(e){return(this.index[e]||new Xe(ye.comparator)).toArray()}}]),e}(),Ea=new Uint8Array(0),Ta=function(){function e(t,n){L(this,e),this.user=t,this.databaseId=n,this.He=new Ia,this.Je=new lr(function(e){return Bt(e)},function(e,t){return Gt(e,t)}),this.uid=t.uid||""}return M(e,[{key:"addToCollectionParentIndex",value:function(e,t){var n=this;if(!this.He.has(t)){var r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(function(){n.He.add(t)});var a={collectionId:r,parent:vi(i)};return Sa(e).put(a)}return Le.resolve()}},{key:"getCollectionParents",value:function(e,t){var n=[],r=IDBKeyRange.bound([t,""],[fe(t),""],!1,!0);return Sa(e).K(r).next(function(e){var r,i=y(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.collectionId!==t)break;n.push(mi(a.parent))}}catch(u){i.e(u)}finally{i.f()}return n})}},{key:"addFieldIndex",value:function(e,t){var n=this,r=_a(e),i=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(function(e){return[e.fieldPath.canonicalString(),e.kind]})}}(t);delete i.indexId;var a=r.add(i);if(t.indexState){var u=Aa(e);return a.next(function(e){u.put(aa(e,n.user,t.indexState.sequenceNumber,t.indexState.offset))})}return a.next()}},{key:"deleteFieldIndex",value:function(e,t){var n=_a(e),r=Aa(e),i=Da(e);return n.delete(t.indexId).next(function(){return r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))}).next(function(){return i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))})}},{key:"getDocumentsMatchingTarget",value:function(e,t){var n=this,r=Da(e),i=!0,a=new Map;return Le.forEach(this.Ye(t),function(t){return n.Xe(e,t).next(function(e){i&&(i=!!e),a.set(t,e)})}).next(function(){if(i){var e=xr(),u=[];return Le.forEach(a,function(i,a){var o;B("IndexedDbIndexManager","Using index ".concat((o=i,"id=".concat(o.indexId,"|cg=").concat(o.collectionGroup,"|f=").concat(o.fields.map(function(e){return"".concat(e.fieldPath,":").concat(e.kind)}).join(",")))," to execute ").concat(Bt(t)));var s=function(e,t){var n=we(i);if(void 0===n)return null;var r,a=y(zt(e,n.fieldPath));try{for(a.s();!(r=a.n()).done;){var u=r.value;switch(u.op){case"array-contains-any":return u.value.arrayValue.values||[];case"array-contains":return[u.value]}}}catch(o){a.e(o)}finally{a.f()}return null}(a),c=function(e,t){var n,r=new Map,i=y(xe(t));try{for(i.s();!(n=i.n()).done;){var a,u=n.value,o=y(zt(e,u.fieldPath));try{for(o.s();!(a=o.n()).done;){var s=a.value;switch(s.op){case"==":case"in":r.set(u.fieldPath.canonicalString(),s.value);break;case"not-in":case"!=":return r.set(u.fieldPath.canonicalString(),s.value),Array.from(r.values())}}}catch(c){o.e(c)}finally{o.f()}}}catch(c){i.e(c)}finally{i.f()}return null}(a,i),l=function(e,t){var n,r=[],a=!0,u=y(xe(i));try{for(u.s();!(n=u.n()).done;){var o=n.value,s=0===o.kind?Qt(e,o.fieldPath,e.startAt):Wt(e,o.fieldPath,e.startAt);r.push(s.value),a&&(a=s.inclusive)}}catch(c){u.e(c)}finally{u.f()}return new rn(r,a)}(a),f=function(e,t){var n,r=[],a=!0,u=y(xe(i));try{for(u.s();!(n=u.n()).done;){var o=n.value,s=0===o.kind?Wt(e,o.fieldPath,e.endAt):Qt(e,o.fieldPath,e.endAt);r.push(s.value),a&&(a=s.inclusive)}}catch(c){u.e(c)}finally{u.f()}return new rn(r,a)}(a),h=n.Ze(i,a,l),d=n.Ze(i,a,f),v=n.tn(i,a,c),p=n.en(i.indexId,s,h,l.inclusive,d,f.inclusive,v);return Le.forEach(p,function(n){return r.j(n,t.limit).next(function(t){t.forEach(function(t){var n=ge.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),u.push(n))})})})}).next(function(){return u})}return Le.resolve(null)})}},{key:"Ye",value:function(e){var t=this.Je.get(e);return t||(t=[e],this.Je.set(e,t),t)}},{key:"en",value:function(e,t,n,r,i,a,u){for(var o=this,s=(null!=t?t.length:1)*Math.max(n.length,i.length),c=s/(null!=t?t.length:1),l=[],f=function(s){var f=t?o.nn(t[s/c]):Ea,h=o.sn(e,f,n[s%c],r),d=o.rn(e,f,i[s%c],a),v=u.map(function(t){return o.sn(e,f,t,!0)});l.push.apply(l,S(o.createRange(h,d,v)))},h=0;h<s;++h)f(h);return l}},{key:"sn",value:function(e,t,n,r){var i=new ga(e,ge.empty(),t,n);return r?i:i.Le()}},{key:"rn",value:function(e,t,n,r){var i=new ga(e,ge.empty(),t,n);return r?i.Le():i}},{key:"Xe",value:function(e,t){var n=new xa(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(function(e){var t,r=null,i=y(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;n.Ge(a)&&(!r||a.fields.length>r.fields.length)&&(r=a)}}catch(u){i.e(u)}finally{i.f()}return r})}},{key:"getIndexType",value:function(e,t){var n=this,r=2;return Le.forEach(this.Ye(t),function(t){return n.Xe(e,t).next(function(e){e?0!==r&&e.fields.length<function(e){var t,n=new Xe(me.comparator),r=!1,i=y(e.filters);try{for(i.s();!(t=i.n()).done;){var a=t.value;a.field.isKeyField()||("array-contains"===a.op||"array-contains-any"===a.op?r=!0:n=n.add(a.field))}}catch(c){i.e(c)}finally{i.f()}var u,o=y(e.orderBy);try{for(o.s();!(u=o.n()).done;){var s=u.value;s.field.isKeyField()||(n=n.add(s.field))}}catch(c){o.e(c)}finally{o.f()}return n.size+(r?1:0)}(t)&&(r=1):r=0})}).next(function(){return r})}},{key:"on",value:function(e,t){var n,r=new ma,i=y(xe(e));try{for(i.s();!(n=i.n()).done;){var a=n.value,u=t.data.field(a.fieldPath);if(null==u)return null;var o=r.Be(a.kind);fa.ye.re(u,o)}}catch(s){i.e(s)}finally{i.f()}return r.Oe()}},{key:"nn",value:function(e){var t=new ma;return fa.ye.re(e,t.Be(0)),t.Oe()}},{key:"un",value:function(e,t){var n=new ma;return fa.ye.re(Et(this.databaseId,t),n.Be(function(e){var t=xe(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Oe()}},{key:"tn",value:function(e,t,n){if(null===n)return[];var r=[];r.push(new ma);var i,a=0,u=y(xe(e));try{for(u.s();!(i=u.n()).done;){var o,s=i.value,c=n[a++],l=y(r);try{for(l.s();!(o=l.n()).done;){var f=o.value;if(this.cn(t,s.fieldPath)&&St(c))r=this.an(r,s,c);else{var h=f.Be(s.kind);fa.ye.re(c,h)}}}catch(d){l.e(d)}finally{l.f()}}}catch(d){u.e(d)}finally{u.f()}return this.hn(r)}},{key:"Ze",value:function(e,t,n){return this.tn(e,t,n.position)}},{key:"hn",value:function(e){for(var t=[],n=0;n<e.length;++n)t[n]=e[n].Oe();return t}},{key:"an",value:function(e,t,n){var r,i=S(e),a=[],u=y(n.arrayValue.values||[]);try{for(u.s();!(r=u.n()).done;){var o,s=r.value,c=y(i);try{for(c.s();!(o=c.n()).done;){var l=o.value,f=new ma;f.seed(l.Oe()),fa.ye.re(s,f.Be(t.kind)),a.push(f)}}catch(h){c.e(h)}finally{c.f()}}}catch(h){u.e(h)}finally{u.f()}return a}},{key:"cn",value:function(e,t){return!!e.filters.find(function(e){return e instanceof Ht&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)})}},{key:"getFieldIndexes",value:function(e,t){var n=this,r=_a(e),i=Aa(e);return(t?r.K("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.K()).next(function(e){var t=[];return Le.forEach(e,function(e){return i.get([e.indexId,n.uid]).next(function(n){t.push(function(e,t){var n=t?new Ie(t.sequenceNumber,new Se($i(t.readTime),new ge(mi(t.documentKey)),t.largestBatchId)):Ie.empty(),r=e.fields.map(function(e){var t=l(e,2),n=t[0],r=t[1];return new be(me.fromServerFormat(n),r)});return new ke(e.indexId,e.collectionGroup,r,n)}(e,n))})}).next(function(){return t})})}},{key:"getNextCollectionGroupToUpdate",value:function(e){return this.getFieldIndexes(e).next(function(e){return 0===e.length?null:(e.sort(function(e,t){var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:ce(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup)})}},{key:"updateCollectionGroup",value:function(e,t,n){var r=this,i=_a(e),a=Aa(e);return this.ln(e).next(function(e){return i.K("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(function(t){return Le.forEach(t,function(t){return a.put(aa(t.indexId,r.user,e,n))})})})}},{key:"updateIndexEntries",value:function(e,t){var n=this,r=new Map;return Le.forEach(t,function(t,i){var a=r.get(t.collectionGroup);return(a?Le.resolve(a):n.getFieldIndexes(e,t.collectionGroup)).next(function(a){return r.set(t.collectionGroup,a),Le.forEach(a,function(r){return n.fn(e,t,r).next(function(t){var a=n.dn(i,r);return t.isEqual(a)?Le.resolve():n._n(e,i,r,t,a)})})})})}},{key:"wn",value:function(e,t,n,r){return Da(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.un(n,t.key),documentKey:t.key.path.toArray()})}},{key:"mn",value:function(e,t,n,r){return Da(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.un(n,t.key),t.key.path.toArray()])}},{key:"fn",value:function(e,t,n){var r=Da(e),i=new Xe(ka);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.un(n,t)])},function(e,r){i=i.add(new ga(n.indexId,t,r.arrayValue,r.directionalValue))}).next(function(){return i})}},{key:"dn",value:function(e,t){var n=new Xe(ka),r=this.on(t,e);if(null==r)return n;var i=we(t);if(null!=i){var a=e.data.field(i.fieldPath);if(St(a)){var u,o=y(a.arrayValue.values||[]);try{for(o.s();!(u=o.n()).done;){var s=u.value;n=n.add(new ga(t.indexId,e.key,this.nn(s),r))}}catch(c){o.e(c)}finally{o.f()}}}else n=n.add(new ga(t.indexId,e.key,Ea,r));return n}},{key:"_n",value:function(e,t,n,r,i){var a=this;B("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);var u=[];return function(e,t,n,r,i){for(var a=e.getIterator(),u=t.getIterator(),o=Ze(a),s=Ze(u);o||s;){var c=!1,l=!1;if(o&&s){var f=n(o,s);f<0?l=!0:f>0&&(c=!0)}else null!=o?l=!0:c=!0;c?(r(s),s=Ze(u)):l?(i(o),o=Ze(a)):(o=Ze(a),s=Ze(u))}}(r,i,ka,function(r){u.push(a.wn(e,t,n,r))},function(r){u.push(a.mn(e,t,n,r))}),Le.waitFor(u)}},{key:"ln",value:function(e){var t=1;return Aa(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},function(e,n,r){r.done(),t=n.sequenceNumber+1}).next(function(){return t})}},{key:"createRange",value:function(e,t,n){n=n.sort(function(e,t){return ka(e,t)}).filter(function(e,t,n){return!t||0!==ka(e,n[t-1])});var r=[];r.push(e);var i,a=y(n);try{for(a.s();!(i=a.n()).done;){var u=i.value,o=ka(u,e),s=ka(u,t);if(0===o)r[0]=e.Le();else if(o>0&&s<0)r.push(u),r.push(u.Le());else if(s>0)break}}catch(f){a.e(f)}finally{a.f()}r.push(t);for(var c=[],l=0;l<r.length;l+=2)c.push(IDBKeyRange.bound([r[l].indexId,this.uid,r[l].arrayValue,r[l].directionalValue,Ea,[]],[r[l+1].indexId,this.uid,r[l+1].arrayValue,r[l+1].directionalValue,Ea,[]]));return c}},{key:"getMinOffsetFromCollectionGroup",value:function(e,t){return this.getFieldIndexes(e,t).next(Na)}},{key:"getMinOffset",value:function(e,t){var n=this;return Le.mapArray(this.Ye(t),function(t){return n.Xe(e,t).next(function(e){return e||z()})}).next(Na)}}]),e}();function Sa(e){return Ki(e,"collectionParents")}function Da(e){return Ki(e,"indexEntries")}function _a(e){return Ki(e,"indexConfiguration")}function Aa(e){return Ki(e,"indexState")}function Na(e){Q(0!==e.length);for(var t=e[0].indexState.offset,n=t.largestBatchId,r=1;r<e.length;r++){var i=e[r].indexState.offset;De(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new Se(t.readTime,t.documentKey,n)}var Ca={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},La=function(){function e(t,n,r){L(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return M(e,null,[{key:"withCacheSize",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();function Va(e,t,n){var r=e.store("mutations"),i=e.store("documentMutations"),a=[],u=IDBKeyRange.only(n.batchId),o=0,s=r.J({range:u},function(e,t,n){return o++,n.delete()});a.push(s.next(function(){Q(1===o)}));var c,l=[],f=y(n.mutations);try{for(f.s();!(c=f.n()).done;){var h=c.value,d=wi(t,h.key.path,n.batchId);a.push(i.delete(d)),l.push(h.key)}}catch(v){f.e(v)}finally{f.f()}return Le.waitFor(a).next(function(){return l})}function Ma(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw z();t=e.noDocument}return JSON.stringify(t).length}La.DEFAULT_COLLECTION_PERCENTILE=10,La.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,La.DEFAULT=new La(41943040,La.DEFAULT_COLLECTION_PERCENTILE,La.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),La.DISABLED=new La(-1,0,0);var Ra=function(){function e(t,n,r,i){L(this,e),this.userId=t,this.wt=n,this.indexManager=r,this.referenceDelegate=i,this.gn={}}return M(e,[{key:"checkEmpty",value:function(e){var t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Fa(e).J({index:"userMutationsIndex",range:n},function(e,n,r){t=!1,r.done()}).next(function(){return t})}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this,a=Pa(e),u=Fa(e);return u.add({}).next(function(o){Q("number"==typeof o);var s,c=new Gi(o,t,n,r),l=function(e,t,n){var r=n.baseMutations.map(function(t){return $r(e.ne,t)}),i=n.mutations.map(function(t){return $r(e.ne,t)});return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(i.wt,i.userId,c),f=[],h=new Xe(function(e,t){return ce(e.canonicalString(),t.canonicalString())}),d=y(r);try{for(d.s();!(s=d.n()).done;){var v=s.value,p=wi(i.userId,v.key.path,o);h=h.add(v.key.path.popLast()),f.push(u.put(l)),f.push(a.put(p,xi))}}catch(m){d.e(m)}finally{d.f()}return h.forEach(function(t){f.push(i.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(function(){i.gn[o]=c.keys()}),Le.waitFor(f).next(function(){return c})})}},{key:"lookupMutationBatch",value:function(e,t){var n=this;return Fa(e).get(t).next(function(e){return e?(Q(e.userId===n.userId),Zi(n.wt,e)):null})}},{key:"yn",value:function(e,t){var n=this;return this.gn[t]?Le.resolve(this.gn[t]):this.lookupMutationBatch(e,t).next(function(e){if(e){var r=e.keys();return n.gn[t]=r,r}return null})}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=this,r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),a=null;return Fa(e).J({index:"userMutationsIndex",range:i},function(e,t,i){t.userId===n.userId&&(Q(t.batchId>=r),a=Zi(n.wt,t)),i.done()}).next(function(){return a})}},{key:"getHighestUnacknowledgedBatchId",value:function(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Fa(e).J({index:"userMutationsIndex",range:t,reverse:!0},function(e,t,r){n=t.batchId,r.done()}).next(function(){return n})}},{key:"getAllMutationBatches",value:function(e){var t=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Fa(e).K("userMutationsIndex",n).next(function(e){return e.map(function(e){return Zi(t.wt,e)})})}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=ki(this.userId,t.path),i=IDBKeyRange.lowerBound(r),a=[];return Pa(e).J({range:i},function(r,i,u){var o=l(r,3),s=o[0],c=o[1],f=o[2],h=mi(c);if(s===n.userId&&t.path.isEqual(h))return Fa(e).get(f).next(function(e){if(!e)throw z();Q(e.userId===n.userId),a.push(Zi(n.wt,e))});u.done()}).next(function(){return a})}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Xe(ce),i=[];return t.forEach(function(t){var a=ki(n.userId,t.path),u=IDBKeyRange.lowerBound(a),o=Pa(e).J({range:u},function(e,i,a){var u=l(e,3),o=u[0],s=u[1],c=u[2],f=mi(s);o===n.userId&&t.path.isEqual(f)?r=r.add(c):a.done()});i.push(o)}),Le.waitFor(i).next(function(){return n.pn(e,r)})}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=this,r=t.path,i=r.length+1,a=ki(this.userId,r),u=IDBKeyRange.lowerBound(a),o=new Xe(ce);return Pa(e).J({range:u},function(e,t,a){var u=l(e,3),s=u[0],c=u[1],f=u[2],h=mi(c);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(o=o.add(f)):a.done()}).next(function(){return n.pn(e,o)})}},{key:"pn",value:function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(Fa(e).get(t).next(function(e){if(null===e)throw z();Q(e.userId===n.userId),r.push(Zi(n.wt,e))}))}),Le.waitFor(i).next(function(){return r})}},{key:"removeMutationBatch",value:function(e,t){var n=this;return Va(e.ee,this.userId,t).next(function(r){return e.addOnCommittedListener(function(){n.In(t.batchId)}),Le.forEach(r,function(t){return n.referenceDelegate.markPotentiallyOrphaned(e,t)})})}},{key:"In",value:function(e){delete this.gn[e]}},{key:"performConsistencyCheck",value:function(e){var t=this;return this.checkEmpty(e).next(function(n){if(!n)return Le.resolve();var r=IDBKeyRange.lowerBound([t.userId]),i=[];return Pa(e).J({range:r},function(e,n,r){if(e[0]===t.userId){var a=mi(e[1]);i.push(a)}else r.done()}).next(function(){Q(0===i.length)})})}},{key:"containsKey",value:function(e,t){return Oa(e,this.userId,t)}},{key:"Tn",value:function(e){var t=this;return qa(e).get(this.userId).next(function(e){return e||{userId:t.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}})}}],[{key:"se",value:function(t,n,r,i){return Q(""!==t.uid),new e(t.isAuthenticated()?t.uid:"",n,r,i)}}]),e}();function Oa(e,t,n){var r=ki(t,n.path),i=r[1],a=IDBKeyRange.lowerBound(r),u=!1;return Pa(e).J({range:a,H:!0},function(e,n,r){var a=l(e,3),o=a[0],s=a[1];a[2];o===t&&s===i&&(u=!0),r.done()}).next(function(){return u})}function Fa(e){return Ki(e,"mutations")}function Pa(e){return Ki(e,"documentMutations")}function qa(e){return Ki(e,"mutationQueues")}var Ua=function(){function e(t){L(this,e),this.En=t}return M(e,[{key:"next",value:function(){return this.En+=2,this.En}}],[{key:"An",value:function(){return new e(0)}},{key:"Rn",value:function(){return new e(-1)}}]),e}(),Ba=function(){function e(t,n){L(this,e),this.referenceDelegate=t,this.wt=n}return M(e,[{key:"allocateTargetId",value:function(e){var t=this;return this.bn(e).next(function(n){var r=new Ua(n.highestTargetId);return n.highestTargetId=r.next(),t.Pn(e,n).next(function(){return n.highestTargetId})})}},{key:"getLastRemoteSnapshotVersion",value:function(e){return this.bn(e).next(function(e){return de.fromTimestamp(new he(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))})}},{key:"getHighestSequenceNumber",value:function(e){return this.bn(e).next(function(e){return e.highestListenSequenceNumber})}},{key:"setTargetsMetadata",value:function(e,t,n){var r=this;return this.bn(e).next(function(i){return i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),r.Pn(e,i)})}},{key:"addTargetData",value:function(e,t){var n=this;return this.vn(e,t).next(function(){return n.bn(e).next(function(r){return r.targetCount+=1,n.Vn(t,r),n.Pn(e,r)})})}},{key:"updateTargetData",value:function(e,t){return this.vn(e,t)}},{key:"removeTargetData",value:function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return Ka(e).delete(t.targetId)}).next(function(){return n.bn(e)}).next(function(t){return Q(t.targetCount>0),t.targetCount-=1,n.Pn(e,t)})}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return Ka(e).J(function(u,o){var s=ea(o);s.sequenceNumber<=t&&null===n.get(s.targetId)&&(i++,a.push(r.removeTargetData(e,s)))}).next(function(){return Le.waitFor(a)}).next(function(){return i})}},{key:"forEachTarget",value:function(e,t){return Ka(e).J(function(e,n){var r=ea(n);t(r)})}},{key:"bn",value:function(e){return Ga(e).get("targetGlobalKey").next(function(e){return Q(null!==e),e})}},{key:"Pn",value:function(e,t){return Ga(e).put("targetGlobalKey",t)}},{key:"vn",value:function(e,t){return Ka(e).put(ta(this.wt,t))}},{key:"Vn",value:function(e,t){var n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}},{key:"getTargetCount",value:function(e){return this.bn(e).next(function(e){return e.targetCount})}},{key:"getTargetData",value:function(e,t){var n=Bt(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Ka(e).J({range:r,index:"queryTargetsIndex"},function(e,n,r){var a=ea(n);Gt(t,a.target)&&(i=a,r.done())}).next(function(){return i})}},{key:"addMatchingKeys",value:function(e,t,n){var r=this,i=[],a=ja(e);return t.forEach(function(t){var u=vi(t.path);i.push(a.put({targetId:n,path:u})),i.push(r.referenceDelegate.addReference(e,n,t))}),Le.waitFor(i)}},{key:"removeMatchingKeys",value:function(e,t,n){var r=this,i=ja(e);return Le.forEach(t,function(t){var a=vi(t.path);return Le.waitFor([i.delete([n,a]),r.referenceDelegate.removeReference(e,n,t)])})}},{key:"removeMatchingKeysForTargetId",value:function(e,t){var n=ja(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=IDBKeyRange.bound([t],[t+1],!1,!0),r=ja(e),i=xr();return r.J({range:n,H:!0},function(e,t,n){var r=mi(e[1]),a=new ge(r);i=i.add(a)}).next(function(){return i})}},{key:"containsKey",value:function(e,t){var n=vi(t.path),r=IDBKeyRange.bound([n],[fe(n)],!1,!0),i=0;return ja(e).J({index:"documentTargetsIndex",H:!0,range:r},function(e,t,n){var r=l(e,2),a=r[0];r[1];0!==a&&(i++,n.done())}).next(function(){return i>0})}},{key:"te",value:function(e,t){return Ka(e).get(t).next(function(e){return e?ea(e):null})}}]),e}();function Ka(e){return Ki(e,"targets")}function Ga(e){return Ki(e,"targetGlobal")}function ja(e){return Ki(e,"targetDocuments")}function za(e,t){var n=l(e,2),r=n[0],i=n[1],a=l(t,2),u=a[0],o=a[1],s=ce(r,u);return 0===s?ce(i,o):s}var Qa=function(){function e(t){L(this,e),this.Sn=t,this.buffer=new Xe(za),this.Dn=0}return M(e,[{key:"Cn",value:function(){return++this.Dn}},{key:"xn",value:function(e){var t=[e,this.Cn()];if(this.buffer.size<this.Sn)this.buffer=this.buffer.add(t);else{var n=this.buffer.last();za(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}},{key:"maxValue",get:function(){return this.buffer.last()[0]}}]),e}(),Wa=function(){function e(t,n,r){L(this,e),this.garbageCollector=t,this.asyncQueue=n,this.localStore=r,this.Nn=null}return M(e,[{key:"start",value:function(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.kn(6e4)}},{key:"stop",value:function(){this.Nn&&(this.Nn.cancel(),this.Nn=null)}},{key:"started",get:function(){return null!==this.Nn}},{key:"kn",value:function(e){var t=this;B("LruGarbageCollector","Garbage collection scheduled in ".concat(e,"ms")),this.Nn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,g(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.Nn=null,e.prev=1,e.next=4,t.localStore.collectGarbage(t.garbageCollector);case 4:e.next=14;break;case 6:if(e.prev=6,e.t0=e.catch(1),!Fe(e.t0)){e.next=12;break}B("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e.t0),e.next=14;break;case 12:return e.next=14,Ne(e.t0);case 14:return e.next=16,t.kn(3e5);case 16:case"end":return e.stop()}},e,null,[[1,6]])})))}}]),e}(),Ha=function(){function e(t,n){L(this,e),this.On=t,this.params=n}return M(e,[{key:"calculateTargetCount",value:function(e,t){return this.On.Mn(e).next(function(e){return Math.floor(t/100*e)})}},{key:"nthSequenceNumber",value:function(e,t){var n=this;if(0===t)return Le.resolve(je.ot);var r=new Qa(t);return this.On.forEachTarget(e,function(e){return r.xn(e.sequenceNumber)}).next(function(){return n.On.Fn(e,function(e){return r.xn(e)})}).next(function(){return r.maxValue})}},{key:"removeTargets",value:function(e,t,n){return this.On.removeTargets(e,t,n)}},{key:"removeOrphanedDocuments",value:function(e,t){return this.On.removeOrphanedDocuments(e,t)}},{key:"collect",value:function(e,t){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(B("LruGarbageCollector","Garbage collection skipped; disabled"),Le.resolve(Ca)):this.getCacheSize(e).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(B("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(r," is lower than threshold ").concat(n.params.cacheSizeCollectionThreshold)),Ca):n.$n(e,t)})}},{key:"getCacheSize",value:function(e){return this.On.getCacheSize(e)}},{key:"$n",value:function(e,t){var n,r,a,u,o,s,c,l=this,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return t>l.params.maximumSequenceNumbersToCollect?(B("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(l.params.maximumSequenceNumbersToCollect," from ").concat(t)),r=l.params.maximumSequenceNumbersToCollect):r=t,u=Date.now(),l.nthSequenceNumber(e,r)}).next(function(r){return n=r,o=Date.now(),l.removeTargets(e,n,t)}).next(function(t){return a=t,s=Date.now(),l.removeOrphanedDocuments(e,n)}).next(function(e){return c=Date.now(),q()<=i.LogLevel.DEBUG&&B("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(u-f,"ms\n\tDetermined least recently used ").concat(r," in ")+(o-u)+"ms\n"+"\tRemoved ".concat(a," targets in ")+(s-o)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(c-s)+"ms\n"+"Total Duration: ".concat(c-f,"ms")),Le.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:a,documentsRemoved:e})})}}]),e}(),Ya=function(){function e(t,n){L(this,e),this.db=t,this.garbageCollector=function(e,t){return new Ha(e,t)}(this,n)}return M(e,[{key:"Mn",value:function(e){var t=this.Bn(e);return this.db.getTargetCache().getTargetCount(e).next(function(e){return t.next(function(t){return e+t})})}},{key:"Bn",value:function(e){var t=0;return this.Fn(e,function(e){t++}).next(function(){return t})}},{key:"forEachTarget",value:function(e,t){return this.db.getTargetCache().forEachTarget(e,t)}},{key:"Fn",value:function(e,t){return this.Ln(e,function(e,n){return t(n)})}},{key:"addReference",value:function(e,t,n){return Ja(e,n)}},{key:"removeReference",value:function(e,t,n){return Ja(e,n)}},{key:"removeTargets",value:function(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}},{key:"markPotentiallyOrphaned",value:function(e,t){return Ja(e,t)}},{key:"Un",value:function(e,t){return function(e,t){var n=!1;return qa(e).Y(function(r){return Oa(e,r,t).next(function(e){return e&&(n=!0),Le.resolve(!e)})}).next(function(){return n})}(e,t)}},{key:"removeOrphanedDocuments",value:function(e,t){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],a=0;return this.Ln(e,function(u,o){if(o<=t){var s=n.Un(e,u).next(function(t){if(!t)return a++,r.getEntry(e,u).next(function(){return r.removeEntry(u,de.min()),ja(e).delete([0,vi(u.path)])})});i.push(s)}}).next(function(){return Le.waitFor(i)}).next(function(){return r.apply(e)}).next(function(){return a})}},{key:"removeTarget",value:function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}},{key:"updateLimboDocument",value:function(e,t){return Ja(e,t)}},{key:"Ln",value:function(e,t){var n,r=ja(e),i=je.ot;return r.J({index:"documentTargetsIndex"},function(e,r){var a=l(e,2),u=a[0],o=(a[1],r.path),s=r.sequenceNumber;0===u?(i!==je.ot&&t(new ge(mi(n)),i),i=s,n=o):i=je.ot}).next(function(){i!==je.ot&&t(new ge(mi(n)),i)})}},{key:"getCacheSize",value:function(e){return this.db.getRemoteDocumentCache().getSize(e)}}]),e}();function Ja(e,t){return ja(e).put(function(e,t){return{targetId:0,path:vi(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}var Xa=function(){function e(){L(this,e),this.changes=new lr(function(e){return e.toString()},function(e,t){return e.isEqual(t)}),this.changesApplied=!1}return M(e,[{key:"addEntry",value:function(e){this.assertNotApplied(),this.changes.set(e.key,e)}},{key:"removeEntry",value:function(e,t){this.assertNotApplied(),this.changes.set(e,Pt.newInvalidDocument(e).setReadTime(t))}},{key:"getEntry",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?Le.resolve(n):this.getFromCache(e,t)}},{key:"getEntries",value:function(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function(){}}]),e}(),$a=function(){function e(t){L(this,e),this.wt=t}return M(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t,n){return nu(e).put(n)}},{key:"removeEntry",value:function(e,t,n){return nu(e).delete(function(e,t){var n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Ji(t),n[n.length-1]]}(t,n))}},{key:"updateMetadata",value:function(e,t){var n=this;return this.getMetadata(e).next(function(r){return r.byteSize+=t,n.qn(e,r)})}},{key:"getEntry",value:function(e,t){var n=this,r=Pt.newInvalidDocument(t);return nu(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ru(t))},function(e,i){r=n.Kn(t,i)}).next(function(){return r})}},{key:"Gn",value:function(e,t){var n=this,r={size:0,document:Pt.newInvalidDocument(t)};return nu(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ru(t))},function(e,i){r={document:n.Kn(t,i),size:Ma(i)}}).next(function(){return r})}},{key:"getEntries",value:function(e,t){var n=this,r=hr();return this.Qn(e,t,function(e,t){var i=n.Kn(e,t);r=r.insert(e,i)}).next(function(){return r})}},{key:"jn",value:function(e,t){var n=this,r=hr(),i=new He(ge.comparator);return this.Qn(e,t,function(e,t){var a=n.Kn(e,t);r=r.insert(e,a),i=i.insert(e,Ma(t))}).next(function(){return{documents:r,Wn:i}})}},{key:"Qn",value:function(e,t,n){if(t.isEmpty())return Le.resolve();var r=new Xe(au);t.forEach(function(e){return r=r.add(e)});var i=IDBKeyRange.bound(ru(r.first()),ru(r.last())),a=r.getIterator(),u=a.getNext();return nu(e).J({index:"documentKeyIndex",range:i},function(e,t,r){for(var i=ge.fromSegments([].concat(S(t.prefixPath),[t.collectionGroup,t.documentId]));u&&au(u,i)<0;)n(u,null),u=a.getNext();u&&u.isEqual(i)&&(n(u,t),u=a.hasNext()?a.getNext():null),u?r.q(ru(u)):r.done()}).next(function(){for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}},{key:"getAllFromCollection",value:function(e,t,n){var r=this,i=[t.popLast().toArray(),t.lastSegment(),Ji(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return nu(e).K(IDBKeyRange.bound(i,a,!0)).next(function(e){var t,n=hr(),i=y(e);try{for(i.s();!(t=i.n()).done;){var a=t.value,u=r.Kn(ge.fromSegments(a.prefixPath.concat(a.collectionGroup,a.documentId)),a);n=n.insert(u.key,u)}}catch(o){i.e(o)}finally{i.f()}return n})}},{key:"getAllFromCollectionGroup",value:function(e,t,n,r){var i=this,a=hr(),u=iu(t,n),o=iu(t,Se.max());return nu(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(u,o,!0)},function(e,t,n){var u=i.Kn(ge.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(a=a.insert(u.key,u)).size===r&&n.done()}).next(function(){return a})}},{key:"newChangeBuffer",value:function(e){return new eu(this,!!e&&e.trackRemovals)}},{key:"getSize",value:function(e){return this.getMetadata(e).next(function(e){return e.byteSize})}},{key:"getMetadata",value:function(e){return tu(e).get("remoteDocumentGlobalKey").next(function(e){return Q(!!e),e})}},{key:"qn",value:function(e,t){return tu(e).put("remoteDocumentGlobalKey",t)}},{key:"Kn",value:function(e,t){if(t){var n=Hi(this.wt,t);if(!n.isNoDocument()||!n.version.isEqual(de.min()))return n}return Pt.newInvalidDocument(e)}}]),e}();function Za(e){return new $a(e)}var eu=function(e){k(n,Xa);var t=x(n);function n(e,r){var i;return L(this,n),(i=t.call(this)).zn=e,i.trackRemovals=r,i.Hn=new lr(function(e){return e.toString()},function(e,t){return e.isEqual(t)}),i}return M(n,[{key:"applyChanges",value:function(e){var t=this,n=[],r=0,i=new Xe(function(e,t){return ce(e.canonicalString(),t.canonicalString())});return this.changes.forEach(function(a,u){var o=t.Hn.get(a);if(n.push(t.zn.removeEntry(e,a,o.readTime)),u.isValidDocument()){var s=Yi(t.zn.wt,u);i=i.add(a.path.popLast());var c=Ma(s);r+=c-o.size,n.push(t.zn.addEntry(e,a,s))}else if(r-=o.size,t.trackRemovals){var l=Yi(t.zn.wt,u.convertToNoDocument(de.min()));n.push(t.zn.addEntry(e,a,l))}}),i.forEach(function(r){n.push(t.zn.indexManager.addToCollectionParentIndex(e,r))}),n.push(this.zn.updateMetadata(e,r)),Le.waitFor(n)}},{key:"getFromCache",value:function(e,t){var n=this;return this.zn.Gn(e,t).next(function(e){return n.Hn.set(t,{size:e.size,readTime:e.document.readTime}),e.document})}},{key:"getAllFromCache",value:function(e,t){var n=this;return this.zn.jn(e,t).next(function(e){var t=e.documents;return e.Wn.forEach(function(e,r){n.Hn.set(e,{size:r,readTime:t.get(e).readTime})}),t})}}]),n}();function tu(e){return Ki(e,"remoteDocumentGlobal")}function nu(e){return Ki(e,"remoteDocumentsV14")}function ru(e){var t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function iu(e,t){var n=t.documentKey.path.toArray();return[e,Ji(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function au(e,t){for(var n=e.path.toArray(),r=t.path.toArray(),i=0,a=0;a<n.length-2&&a<r.length-2;++a)if(i=ce(n[a],r[a]))return i;return(i=ce(n.length,r.length))||((i=ce(n[n.length-2],r[r.length-2]))||ce(n[n.length-1],r[r.length-1]))}var uu=M(function e(t,n){L(this,e),this.overlayedDocument=t,this.mutatedFields=n}),ou=function(){function e(t,n,r,i){L(this,e),this.remoteDocumentCache=t,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}return M(e,[{key:"getDocument",value:function(e,t){var n=this,r=null;return this.documentOverlayCache.getOverlay(e,t).next(function(i){return r=i,n.getBaseDocument(e,t,r)}).next(function(e){return null!==r&&Yn(r.mutation,e,et.empty(),he.now()),e})}},{key:"getDocuments",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.getLocalViewOfDocuments(e,t,xr()).next(function(){return t})})}},{key:"getLocalViewOfDocuments",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xr(),i=pr();return this.populateOverlays(e,i,t).next(function(){return n.computeViews(e,t,i,r).next(function(e){var t=vr();return e.forEach(function(e,n){t=t.insert(e,n.overlayedDocument)}),t})})}},{key:"getOverlayedDocuments",value:function(e,t){var n=this,r=pr();return this.populateOverlays(e,r,t).next(function(){return n.computeViews(e,t,r,xr())})}},{key:"populateOverlays",value:function(e,t,n){var r=[];return n.forEach(function(e){t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(function(e){e.forEach(function(e,n){t.set(e,n)})})}},{key:"computeViews",value:function(e,t,n,r){var i=hr(),a=gr(),u=gr();return t.forEach(function(e,t){var u=n.get(t.key);r.has(t.key)&&(void 0===u||u.mutation instanceof Zn)?i=i.insert(t.key,t):void 0!==u&&(a.set(t.key,u.mutation.getFieldMask()),Yn(u.mutation,t,u.mutation.getFieldMask(),he.now()))}),this.recalculateAndSaveOverlays(e,i).next(function(e){return e.forEach(function(e,t){return a.set(e,t)}),t.forEach(function(e,t){var n;return u.set(e,new uu(t,null!==(n=a.get(e))&&void 0!==n?n:null))}),u})}},{key:"recalculateAndSaveOverlays",value:function(e,t){var n=this,r=gr(),i=new He(function(e,t){return e-t}),a=xr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(function(e){var n,a=y(e);try{var u=function(){var e=n.value;e.keys().forEach(function(n){var a=t.get(n);if(null!==a){var u=r.get(n)||et.empty();u=e.applyToLocalView(a,u),r.set(n,u);var o=(i.get(e.batchId)||xr()).add(n);i=i.insert(e.batchId,o)}})};for(a.s();!(n=a.n()).done;)u()}catch(o){a.e(o)}finally{a.f()}}).next(function(){for(var u=[],o=i.getReverseIterator(),s=function(){var i=o.getNext(),s=i.key,c=i.value,l=mr();c.forEach(function(e){if(!a.has(e)){var n=Wn(t.get(e),r.get(e));null!==n&&l.set(e,n),a=a.add(e)}}),u.push(n.documentOverlayCache.saveOverlays(e,s,l))};o.hasNext();)s();return Le.waitFor(u)}).next(function(){return r})}},{key:"recalculateAndSaveOverlaysForDocumentKeys",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.recalculateAndSaveOverlays(e,t)})}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){return function(e){return ge.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):yn(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}},{key:"getNextDocuments",value:function(e,t,n,r){var i=this;return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(function(a){var u=r-a.size>0?i.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-a.size):Le.resolve(pr()),o=-1,s=a;return u.next(function(t){return Le.forEach(t,function(t,n){return o<n.largestBatchId&&(o=n.largestBatchId),a.get(t)?Le.resolve():i.getBaseDocument(e,t,n).next(function(e){s=s.insert(t,e)})}).next(function(){return i.populateOverlays(e,t,a)}).next(function(){return i.computeViews(e,s,t,xr())}).next(function(e){return{batchId:o,changes:yr(e)}})})})}},{key:"getDocumentsMatchingDocumentQuery",value:function(e,t){return this.getDocument(e,new ge(t)).next(function(e){var t=vr();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}},{key:"getDocumentsMatchingCollectionGroupQuery",value:function(e,t,n){var r=this,i=t.collectionGroup,a=vr();return this.indexManager.getCollectionParents(e,i).next(function(u){return Le.forEach(u,function(u){var o=function(e,t){return new cn(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,u.child(i));return r.getDocumentsMatchingCollectionQuery(e,o,n).next(function(e){e.forEach(function(e,t){a=a.insert(e,t)})})}).next(function(){return a})})}},{key:"getDocumentsMatchingCollectionQuery",value:function(e,t,n){var r,i=this;return this.remoteDocumentCache.getAllFromCollection(e,t.path,n).next(function(a){return r=a,i.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId)}).next(function(e){e.forEach(function(e,t){var n=t.getKey();null===r.get(n)&&(r=r.insert(n,Pt.newInvalidDocument(n)))});var n=vr();return r.forEach(function(r,i){var a=e.get(r);void 0!==a&&Yn(a.mutation,i,et.empty(),he.now()),bn(t,i)&&(n=n.insert(r,i))}),n})}},{key:"getBaseDocument",value:function(e,t,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(e,t):Le.resolve(Pt.newInvalidDocument(t))}}]),e}(),su=function(){function e(t){L(this,e),this.wt=t,this.Jn=new Map,this.Yn=new Map}return M(e,[{key:"getBundleMetadata",value:function(e,t){return Le.resolve(this.Jn.get(t))}},{key:"saveBundleMetadata",value:function(e,t){var n;return this.Jn.set(t.id,{id:(n=t).id,version:n.version,createTime:qr(n.createTime)}),Le.resolve()}},{key:"getNamedQuery",value:function(e,t){return Le.resolve(this.Yn.get(t))}},{key:"saveNamedQuery",value:function(e,t){return this.Yn.set(t.name,function(e){return{name:e.name,query:na(e.bundledQuery),readTime:qr(e.readTime)}}(t)),Le.resolve()}}]),e}(),cu=function(){function e(){L(this,e),this.overlays=new He(ge.comparator),this.Xn=new Map}return M(e,[{key:"getOverlay",value:function(e,t){return Le.resolve(this.overlays.get(t))}},{key:"getOverlays",value:function(e,t){var n=this,r=pr();return Le.forEach(t,function(t){return n.getOverlay(e,t).next(function(e){null!==e&&r.set(t,e)})}).next(function(){return r})}},{key:"saveOverlays",value:function(e,t,n){var r=this;return n.forEach(function(n,i){r.ie(e,t,i)}),Le.resolve()}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,i=this.Xn.get(n);return void 0!==i&&(i.forEach(function(e){return r.overlays=r.overlays.remove(e)}),this.Xn.delete(n)),Le.resolve()}},{key:"getOverlaysForCollection",value:function(e,t,n){for(var r=pr(),i=t.length+1,a=new ge(t.child("")),u=this.overlays.getIteratorFrom(a);u.hasNext();){var o=u.getNext().value,s=o.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&o.largestBatchId>n&&r.set(o.getKey(),o)}return Le.resolve(r)}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){for(var i=new He(function(e,t){return e-t}),a=this.overlays.getIterator();a.hasNext();){var u=a.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>n){var o=i.get(u.largestBatchId);null===o&&(o=pr(),i=i.insert(u.largestBatchId,o)),o.set(u.getKey(),u)}}for(var s=pr(),c=i.getIterator();c.hasNext()&&(c.getNext().value.forEach(function(e,t){return s.set(e,t)}),!(s.size()>=r)););return Le.resolve(s)}},{key:"ie",value:function(e,t,n){var r=this.overlays.get(n.key);if(null!==r){var i=this.Xn.get(r.largestBatchId).delete(n.key);this.Xn.set(r.largestBatchId,i)}this.overlays=this.overlays.insert(n.key,new zi(t,n));var a=this.Xn.get(t);void 0===a&&(a=xr(),this.Xn.set(t,a)),this.Xn.set(t,a.add(n.key))}}]),e}(),lu=function(){function e(){L(this,e),this.Zn=new Xe(fu.ts),this.es=new Xe(fu.ns)}return M(e,[{key:"isEmpty",value:function(){return this.Zn.isEmpty()}},{key:"addReference",value:function(e,t){var n=new fu(e,t);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}},{key:"ss",value:function(e,t){var n=this;e.forEach(function(e){return n.addReference(e,t)})}},{key:"removeReference",value:function(e,t){this.rs(new fu(e,t))}},{key:"os",value:function(e,t){var n=this;e.forEach(function(e){return n.removeReference(e,t)})}},{key:"us",value:function(e){var t=this,n=new ge(new ye([])),r=new fu(n,e),i=new fu(n,e+1),a=[];return this.es.forEachInRange([r,i],function(e){t.rs(e),a.push(e.key)}),a}},{key:"cs",value:function(){var e=this;this.Zn.forEach(function(t){return e.rs(t)})}},{key:"rs",value:function(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}},{key:"hs",value:function(e){var t=new ge(new ye([])),n=new fu(t,e),r=new fu(t,e+1),i=xr();return this.es.forEachInRange([n,r],function(e){i=i.add(e.key)}),i}},{key:"containsKey",value:function(e){var t=new fu(e,0),n=this.Zn.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),fu=function(){function e(t,n){L(this,e),this.key=t,this.ls=n}return M(e,null,[{key:"ts",value:function(e,t){return ge.comparator(e.key,t.key)||ce(e.ls,t.ls)}},{key:"ns",value:function(e,t){return ce(e.ls,t.ls)||ge.comparator(e.key,t.key)}}]),e}(),hu=function(){function e(t,n){L(this,e),this.indexManager=t,this.referenceDelegate=n,this.mutationQueue=[],this.fs=1,this.ds=new Xe(fu.ts)}return M(e,[{key:"checkEmpty",value:function(e){return Le.resolve(0===this.mutationQueue.length)}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this.fs;this.fs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];var a=new Gi(i,t,n,r);this.mutationQueue.push(a);var u,o=y(r);try{for(o.s();!(u=o.n()).done;){var s=u.value;this.ds=this.ds.add(new fu(s.key,i)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast())}}catch(c){o.e(c)}finally{o.f()}return Le.resolve(a)}},{key:"lookupMutationBatch",value:function(e,t){return Le.resolve(this._s(t))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=t+1,r=this.ws(n),i=r<0?0:r;return Le.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return Le.resolve(0===this.mutationQueue.length?-1:this.fs-1)}},{key:"getAllMutationBatches",value:function(e){return Le.resolve(this.mutationQueue.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=new fu(t,0),i=new fu(t,Number.POSITIVE_INFINITY),a=[];return this.ds.forEachInRange([r,i],function(e){var t=n._s(e.ls);a.push(t)}),Le.resolve(a)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Xe(ce);return t.forEach(function(e){var t=new fu(e,0),i=new fu(e,Number.POSITIVE_INFINITY);n.ds.forEachInRange([t,i],function(e){r=r.add(e.ls)})}),Le.resolve(this.gs(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=t.path,r=n.length+1,i=n;ge.isDocumentKey(i)||(i=i.child(""));var a=new fu(new ge(i),0),u=new Xe(ce);return this.ds.forEachWhile(function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(u=u.add(e.ls)),!0)},a),Le.resolve(this.gs(u))}},{key:"gs",value:function(e){var t=this,n=[];return e.forEach(function(e){var r=t._s(e);null!==r&&n.push(r)}),n}},{key:"removeMutationBatch",value:function(e,t){var n=this;Q(0===this.ys(t.batchId,"removed")),this.mutationQueue.shift();var r=this.ds;return Le.forEach(t.mutations,function(i){var a=new fu(i.key,t.batchId);return r=r.delete(a),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(function(){n.ds=r})}},{key:"In",value:function(e){}},{key:"containsKey",value:function(e,t){var n=new fu(t,0),r=this.ds.firstAfterOrEqual(n);return Le.resolve(t.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(e){return this.mutationQueue.length,Le.resolve()}},{key:"ys",value:function(e,t){return this.ws(e)}},{key:"ws",value:function(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}},{key:"_s",value:function(e){var t=this.ws(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}]),e}(),du=function(){function e(t){L(this,e),this.ps=t,this.docs=new He(ge.comparator),this.size=0}return M(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t){var n=t.key,r=this.docs.get(n),i=r?r.size:0,a=this.ps(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}},{key:"removeEntry",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function(e,t){var n=this.docs.get(t);return Le.resolve(n?n.document.mutableCopy():Pt.newInvalidDocument(t))}},{key:"getEntries",value:function(e,t){var n=this,r=hr();return t.forEach(function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():Pt.newInvalidDocument(e))}),Le.resolve(r)}},{key:"getAllFromCollection",value:function(e,t,n){for(var r=hr(),i=new ge(t.child("")),a=this.docs.getIteratorFrom(i);a.hasNext();){var u=a.getNext(),o=u.key,s=u.value.document;if(!t.isPrefixOf(o.path))break;o.path.length>t.length+1||De(Te(s),n)<=0||(r=r.insert(s.key,s.mutableCopy()))}return Le.resolve(r)}},{key:"getAllFromCollectionGroup",value:function(e,t,n,r){z()}},{key:"Is",value:function(e,t){return Le.forEach(this.docs,function(e){return t(e)})}},{key:"newChangeBuffer",value:function(e){return new vu(this)}},{key:"getSize",value:function(e){return Le.resolve(this.size)}}]),e}(),vu=function(e){k(n,Xa);var t=x(n);function n(e){var r;return L(this,n),(r=t.call(this)).zn=e,r}return M(n,[{key:"applyChanges",value:function(e){var t=this,n=[];return this.changes.forEach(function(r,i){i.isValidDocument()?n.push(t.zn.addEntry(e,i)):t.zn.removeEntry(r)}),Le.waitFor(n)}},{key:"getFromCache",value:function(e,t){return this.zn.getEntry(e,t)}},{key:"getAllFromCache",value:function(e,t){return this.zn.getEntries(e,t)}}]),n}(),yu=function(){function e(t){L(this,e),this.persistence=t,this.Ts=new lr(function(e){return Bt(e)},Gt),this.lastRemoteSnapshotVersion=de.min(),this.highestTargetId=0,this.Es=0,this.As=new lu,this.targetCount=0,this.Rs=Ua.An()}return M(e,[{key:"forEachTarget",value:function(e,t){return this.Ts.forEach(function(e,n){return t(n)}),Le.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(e){return Le.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(e){return Le.resolve(this.Es)}},{key:"allocateTargetId",value:function(e){return this.highestTargetId=this.Rs.next(),Le.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Es&&(this.Es=t),Le.resolve()}},{key:"vn",value:function(e){this.Ts.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Rs=new Ua(t),this.highestTargetId=t),e.sequenceNumber>this.Es&&(this.Es=e.sequenceNumber)}},{key:"addTargetData",value:function(e,t){return this.vn(t),this.targetCount+=1,Le.resolve()}},{key:"updateTargetData",value:function(e,t){return this.vn(t),Le.resolve()}},{key:"removeTargetData",value:function(e,t){return this.Ts.delete(t.target),this.As.us(t.targetId),this.targetCount-=1,Le.resolve()}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return this.Ts.forEach(function(u,o){o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r.Ts.delete(u),a.push(r.removeMatchingKeysForTargetId(e,o.targetId)),i++)}),Le.waitFor(a).next(function(){return i})}},{key:"getTargetCount",value:function(e){return Le.resolve(this.targetCount)}},{key:"getTargetData",value:function(e,t){var n=this.Ts.get(t)||null;return Le.resolve(n)}},{key:"addMatchingKeys",value:function(e,t,n){return this.As.ss(t,n),Le.resolve()}},{key:"removeMatchingKeys",value:function(e,t,n){this.As.os(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.markPotentiallyOrphaned(e,t))}),Le.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function(e,t){return this.As.us(t),Le.resolve()}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=this.As.hs(t);return Le.resolve(n)}},{key:"containsKey",value:function(e,t){return Le.resolve(this.As.containsKey(t))}}]),e}(),pu=function(){function e(t,n){var r=this;L(this,e),this.bs={},this.overlays={},this.Ps=new je(0),this.vs=!1,this.vs=!0,this.referenceDelegate=t(this),this.Vs=new yu(this),this.indexManager=new ba,this.remoteDocumentCache=new du(function(e){return r.referenceDelegate.Ss(e)}),this.wt=new Wi(n),this.Ds=new su(this.wt)}return M(e,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.vs=!1,Promise.resolve()}},{key:"started",get:function(){return this.vs}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(e){return this.indexManager}},{key:"getDocumentOverlayCache",value:function(e){var t=this.overlays[e.toKey()];return t||(t=new cu,this.overlays[e.toKey()]=t),t}},{key:"getMutationQueue",value:function(e,t){var n=this.bs[e.toKey()];return n||(n=new hu(t,this.referenceDelegate),this.bs[e.toKey()]=n),n}},{key:"getTargetCache",value:function(){return this.Vs}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getBundleCache",value:function(){return this.Ds}},{key:"runTransaction",value:function(e,t,n){var r=this;B("MemoryPersistence","Starting transaction:",e);var i=new mu(this.Ps.next());return this.referenceDelegate.Cs(),n(i).next(function(e){return r.referenceDelegate.xs(i).next(function(){return e})}).toPromise().then(function(e){return i.raiseOnCommittedEvent(),e})}},{key:"Ns",value:function(e,t){return Le.or(Object.values(this.bs).map(function(n){return function(){return n.containsKey(e,t)}}))}}]),e}(),mu=function(e){k(n,Ae);var t=x(n);function n(e){var r;return L(this,n),(r=t.call(this)).currentSequenceNumber=e,r}return M(n)}(),gu=function(){function e(t){L(this,e),this.persistence=t,this.ks=new lu,this.Os=null}return M(e,[{key:"Fs",get:function(){if(this.Os)return this.Os;throw z()}},{key:"addReference",value:function(e,t,n){return this.ks.addReference(n,t),this.Fs.delete(n.toString()),Le.resolve()}},{key:"removeReference",value:function(e,t,n){return this.ks.removeReference(n,t),this.Fs.add(n.toString()),Le.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.Fs.add(t.toString()),Le.resolve()}},{key:"removeTarget",value:function(e,t){var n=this;this.ks.us(t.targetId).forEach(function(e){return n.Fs.add(e.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(function(e){e.forEach(function(e){return n.Fs.add(e.toString())})}).next(function(){return r.removeTargetData(e,t)})}},{key:"Cs",value:function(){this.Os=new Set}},{key:"xs",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Le.forEach(this.Fs,function(r){var i=ge.fromPath(r);return t.$s(e,i).next(function(e){e||n.removeEntry(i,de.min())})}).next(function(){return t.Os=null,n.apply(e)})}},{key:"updateLimboDocument",value:function(e,t){var n=this;return this.$s(e,t).next(function(e){e?n.Fs.delete(t.toString()):n.Fs.add(t.toString())})}},{key:"Ss",value:function(e){return 0}},{key:"$s",value:function(e,t){var n=this;return Le.or([function(){return Le.resolve(n.ks.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Ns(e,t)}])}}],[{key:"Ms",value:function(t){return new e(t)}}]),e}(),ku=function(){function e(t){L(this,e),this.wt=t}return M(e,[{key:"O",value:function(e,t,n,r){var i=this,a=new Ve("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",gi,{unique:!0}),e.createObjectStore("documentMutations")}(e),wu(e),function(e){e.createObjectStore("remoteDocuments")}(e));var u=Le.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),wu(e)),u=u.next(function(){return e=a.store("targetGlobal"),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:de.min().toTimestamp(),targetCount:0},e.put("targetGlobalKey",t);var e,t})),n<4&&r>=4&&(0!==n&&(u=u.next(function(){return function(e,t){return t.store("mutations").K().next(function(n){e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",gi,{unique:!0});var r=t.store("mutations"),i=n.map(function(e){return r.put(e)});return Le.waitFor(i)})}(e,a)})),u=u.next(function(){!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&r>=5&&(u=u.next(function(){return i.Bs(a)})),n<6&&r>=6&&(u=u.next(function(){return function(e){e.createObjectStore("remoteDocumentGlobal")}(e),i.Ls(a)})),n<7&&r>=7&&(u=u.next(function(){return i.Us(a)})),n<8&&r>=8&&(u=u.next(function(){return i.qs(e,a)})),n<9&&r>=9&&(u=u.next(function(){!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&r>=10&&(u=u.next(function(){return i.Ks(a)})),n<11&&r>=11&&(u=u.next(function(){!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&r>=12&&(u=u.next(function(){!function(e){var t=e.createObjectStore("documentOverlays",{keyPath:Vi});t.createIndex("collectionPathOverlayIndex",Mi,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",Ri,{unique:!1})}(e)})),n<13&&r>=13&&(u=u.next(function(){return function(e){var t=e.createObjectStore("remoteDocumentsV14",{keyPath:bi});t.createIndex("documentKeyIndex",Ii),t.createIndex("collectionGroupIndex",Ei)}(e)}).next(function(){return i.Gs(e,a)}).next(function(){return e.deleteObjectStore("remoteDocuments")})),n<14&&r>=14&&(u=u.next(function(){return i.Qs(e,a)})),n<15&&r>=15&&(u=u.next(function(){return function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Ai}).createIndex("sequenceNumberIndex",Ni,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Ci}).createIndex("documentKeyIndex",Li,{unique:!1})}(e)})),u}},{key:"Ls",value:function(e){var t=0;return e.store("remoteDocuments").J(function(e,n){t+=Ma(n)}).next(function(){var n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}},{key:"Bs",value:function(e){var t=this,n=e.store("mutationQueues"),r=e.store("mutations");return n.K().next(function(n){return Le.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.K("userMutationsIndex",i).next(function(r){return Le.forEach(r,function(r){Q(r.userId===n.userId);var i=Zi(t.wt,r);return Va(e,n.userId,i).next(function(){})})})})})}},{key:"Us",value:function(e){var t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(function(e){var r=[];return n.J(function(n,i){var a=new ye(n),u=[0,vi(a)];r.push(t.get(u).next(function(n){return n?Le.resolve():function(n){return t.put({targetId:0,path:vi(n),sequenceNumber:e.highestListenSequenceNumber})}(a)}))}).next(function(){return Le.waitFor(r)})})}},{key:"qs",value:function(e,t){e.createObjectStore("collectionParents",{keyPath:_i});var n=t.store("collectionParents"),r=new Ia,i=function(e){if(r.add(e)){var t=e.lastSegment(),i=e.popLast();return n.put({collectionId:t,parent:vi(i)})}};return t.store("remoteDocuments").J({H:!0},function(e,t){var n=new ye(e);return i(n.popLast())}).next(function(){return t.store("documentMutations").J({H:!0},function(e,t){var n=l(e,3),r=(n[0],n[1]),a=(n[2],mi(r));return i(a.popLast())})})}},{key:"Ks",value:function(e){var t=this,n=e.store("targets");return n.J(function(e,r){var i=ea(r),a=ta(t.wt,i);return n.put(a)})}},{key:"Gs",value:function(e,t){var n=t.store("remoteDocuments"),r=[];return n.J(function(e,n){var i,a=t.store("remoteDocumentsV14"),u=(i=n,i.document?new ge(ye.fromString(i.document.name).popFirst(5)):i.noDocument?ge.fromSegments(i.noDocument.path):i.unknownDocument?ge.fromSegments(i.unknownDocument.path):z()).path.toArray(),o={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(a.put(o))}).next(function(){return Le.waitFor(r)})}},{key:"Qs",value:function(e,t){var n=this,r=t.store("mutations"),i=Za(this.wt),a=new pu(gu.Ms,this.wt.ne);return r.K().next(function(e){var r=new Map;return e.forEach(function(e){var t,i=null!==(t=r.get(e.userId))&&void 0!==t?t:xr();Zi(n.wt,e).keys().forEach(function(e){return i=i.add(e)}),r.set(e.userId,i)}),Le.forEach(r,function(e,r){var u=new O(r),o=ca.se(n.wt,u),s=a.getIndexManager(u),c=Ra.se(u,n.wt,s,a.referenceDelegate);return new ou(i,c,o,s).recalculateAndSaveOverlaysForDocumentKeys(new Bi(t,je.ot),e).next()})})}}]),e}();function wu(e){e.createObjectStore("targetDocuments",{keyPath:Si}).createIndex("documentTargetsIndex",Di,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Ti,{unique:!0}),e.createObjectStore("targetGlobal")}var xu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",bu=function(){function e(t,n,r,i,a,u,o,s,c,l){var f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:14;if(L(this,e),this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.js=a,this.window=u,this.document=o,this.Ws=c,this.zs=l,this.Hs=f,this.Ps=null,this.vs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Js=null,this.inForeground=!1,this.Ys=null,this.Xs=null,this.Zs=Number.NEGATIVE_INFINITY,this.ti=function(e){return Promise.resolve()},!e.V())throw new J(Y.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ya(this,i),this.ei=n+"main",this.wt=new Wi(s),this.ni=new Me(this.ei,this.Hs,new ku(this.wt)),this.Vs=new Ba(this.referenceDelegate,this.wt),this.remoteDocumentCache=Za(this.wt),this.Ds=new ua,this.window&&this.window.localStorage?this.si=this.window.localStorage:(this.si=null,!1===l&&K("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return M(e,[{key:"start",value:function(){var e=this;return this.ii().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new J(Y.FAILED_PRECONDITION,xu);return e.ri(),e.oi(),e.ui(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.Vs.getHighestSequenceNumber(t)})}).then(function(t){e.Ps=new je(t,e.Ws)}).then(function(){e.vs=!0}).catch(function(t){return e.ni&&e.ni.close(),Promise.reject(t)})}},{key:"ci",value:function(e){var t=this;return this.ti=function(){var n=g(p().mark(function n(r){return p().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.started){n.next=2;break}return n.abrupt("return",e(r));case 2:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}(),e(this.isPrimary)}},{key:"setDatabaseDeletedListener",value:function(e){this.ni.F(function(){var t=g(p().mark(function t(n){return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=null===n.newVersion,!t.t0){t.next=4;break}return t.next=4,e();case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"setNetworkEnabled",value:function(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.js.enqueueAndForget(g(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.started,!e.t0){e.next=4;break}return e.next=4,t.ii();case 4:case"end":return e.stop()}},e)}))))}},{key:"ii",value:function(){var e=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(t){return Eu(t).put({clientId:e.clientId,updateTimeMs:Date.now(),networkEnabled:e.networkEnabled,inForeground:e.inForeground}).next(function(){if(e.isPrimary)return e.ai(t).next(function(t){t||(e.isPrimary=!1,e.js.enqueueRetryable(function(){return e.ti(!1)}))})}).next(function(){return e.hi(t)}).next(function(n){return e.isPrimary&&!n?e.li(t).next(function(){return!1}):!!n&&e.fi(t).next(function(){return!0})})}).catch(function(t){if(Fe(t))return B("IndexedDbPersistence","Failed to extend owner lease: ",t),e.isPrimary;if(!e.allowTabSynchronization)throw t;return B("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){e.isPrimary!==t&&e.js.enqueueRetryable(function(){return e.ti(t)}),e.isPrimary=t})}},{key:"ai",value:function(e){var t=this;return Iu(e).get("owner").next(function(e){return Le.resolve(t.di(e))})}},{key:"_i",value:function(e){return Eu(e).delete(this.clientId)}},{key:"wi",value:function(){var e=g(p().mark(function e(){var t,n,r,i,a=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrimary||this.mi(this.Zs,18e5)){e.next=6;break}return this.Zs=Date.now(),e.next=4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(e){var t=Ki(e,"clientMetadata");return t.K().next(function(e){var n=a.gi(e,18e5),r=e.filter(function(e){return-1===n.indexOf(e)});return Le.forEach(r,function(e){return t.delete(e.clientId)}).next(function(){return r})})}).catch(function(){return[]});case 4:if(t=e.sent,this.si){n=y(t);try{for(n.s();!(r=n.n()).done;)i=r.value,this.si.removeItem(this.yi(i.clientId))}catch(u){n.e(u)}finally{n.f()}}case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"ui",value:function(){var e=this;this.Xs=this.js.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return e.ii().then(function(){return e.wi()}).then(function(){return e.ui()})})}},{key:"di",value:function(e){return!!e&&e.ownerId===this.clientId}},{key:"hi",value:function(e){var t=this;return this.zs?Le.resolve(!0):Iu(e).get("owner").next(function(n){if(null!==n&&t.mi(n.leaseTimestampMs,5e3)&&!t.pi(n.ownerId)){if(t.di(n)&&t.networkEnabled)return!0;if(!t.di(n)){if(!n.allowTabSynchronization)throw new J(Y.FAILED_PRECONDITION,xu);return!1}}return!(!t.networkEnabled||!t.inForeground)||Eu(e).K().next(function(e){return void 0===t.gi(e,5e3).find(function(e){if(t.clientId!==e.clientId){var n=!t.networkEnabled&&e.networkEnabled,r=!t.inForeground&&e.inForeground,i=t.networkEnabled===e.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(e){return t.isPrimary!==e&&B("IndexedDbPersistence","Client ".concat(e?"is":"is not"," eligible for a primary lease.")),e})}},{key:"shutdown",value:function(){var e=g(p().mark(function e(){var t=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.vs=!1,this.Ii(),this.Xs&&(this.Xs.cancel(),this.Xs=null),this.Ti(),this.Ei(),e.next=7,this.ni.runTransaction("shutdown","readwrite",["owner","clientMetadata"],function(e){var n=new Bi(e,je.ot);return t.li(n).next(function(){return t._i(n)})});case 7:this.ni.close(),this.Ai();case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"gi",value:function(e,t){var n=this;return e.filter(function(e){return n.mi(e.updateTimeMs,t)&&!n.pi(e.clientId)})}},{key:"Ri",value:function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return Eu(t).K().next(function(t){return e.gi(t,18e5).map(function(e){return e.clientId})})})}},{key:"started",get:function(){return this.vs}},{key:"getMutationQueue",value:function(e,t){return Ra.se(e,this.wt,t,this.referenceDelegate)}},{key:"getTargetCache",value:function(){return this.Vs}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getIndexManager",value:function(e){return new Ta(e,this.wt.ne.databaseId)}},{key:"getDocumentOverlayCache",value:function(e){return ca.se(this.wt,e)}},{key:"getBundleCache",value:function(){return this.Ds}},{key:"runTransaction",value:function(e,t,n){var r=this;B("IndexedDbPersistence","Starting transaction:",e);var i,a,u="readonly"===t?"readonly":"readwrite",o=15===(i=this.Hs)?Ui:14===i?qi:13===i?Pi:12===i?Fi:11===i?Oi:void z();return this.ni.runTransaction(e,u,o,function(i){return a=new Bi(i,r.Ps?r.Ps.next():je.ot),"readwrite-primary"===t?r.ai(a).next(function(e){return!!e||r.hi(a)}).next(function(t){if(!t)throw K("Failed to obtain primary lease for action '".concat(e,"'.")),r.isPrimary=!1,r.js.enqueueRetryable(function(){return r.ti(!1)}),new J(Y.FAILED_PRECONDITION,_e);return n(a)}).next(function(e){return r.fi(a).next(function(){return e})}):r.bi(a).next(function(){return n(a)})}).then(function(e){return a.raiseOnCommittedEvent(),e})}},{key:"bi",value:function(e){var t=this;return Iu(e).get("owner").next(function(e){if(null!==e&&t.mi(e.leaseTimestampMs,5e3)&&!t.pi(e.ownerId)&&!t.di(e)&&!(t.zs||t.allowTabSynchronization&&e.allowTabSynchronization))throw new J(Y.FAILED_PRECONDITION,xu)})}},{key:"fi",value:function(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Iu(e).put("owner",t)}},{key:"li",value:function(e){var t=this,n=Iu(e);return n.get("owner").next(function(e){return t.di(e)?(B("IndexedDbPersistence","Releasing primary lease."),n.delete("owner")):Le.resolve()})}},{key:"mi",value:function(e,t){var n=Date.now();return!(e<n-t||e>n&&(K("Detected an update time that is in the future: ".concat(e," > ").concat(n)),1))}},{key:"ri",value:function(){var e=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ys=function(){e.js.enqueueAndForget(function(){return e.inForeground="visible"===e.document.visibilityState,e.ii()})},this.document.addEventListener("visibilitychange",this.Ys),this.inForeground="visible"===this.document.visibilityState)}},{key:"Ti",value:function(){this.Ys&&(this.document.removeEventListener("visibilitychange",this.Ys),this.Ys=null)}},{key:"oi",value:function(){var e,t=this;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Js=function(){t.Ii(),(0,a.isSafari)()&&navigator.appVersion.match(/Version\/1[45]/)&&t.js.enterRestrictedMode(!0),t.js.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("pagehide",this.Js))}},{key:"Ei",value:function(){this.Js&&(this.window.removeEventListener("pagehide",this.Js),this.Js=null)}},{key:"pi",value:function(e){var t;try{var n=null!==(null===(t=this.si)||void 0===t?void 0:t.getItem(this.yi(e)));return B("IndexedDbPersistence","Client '".concat(e,"' ").concat(n?"is":"is not"," zombied in LocalStorage")),n}catch(e){return K("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}},{key:"Ii",value:function(){if(this.si)try{this.si.setItem(this.yi(this.clientId),String(Date.now()))}catch(e){K("Failed to set zombie client id.",e)}}},{key:"Ai",value:function(){if(this.si)try{this.si.removeItem(this.yi(this.clientId))}catch(e){}}},{key:"yi",value:function(e){return"firestore_zombie_".concat(this.persistenceKey,"_").concat(e)}}],[{key:"V",value:function(){return Me.V()}}]),e}();function Iu(e){return Ki(e,"owner")}function Eu(e){return Ki(e,"clientMetadata")}function Tu(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var Su=function(){function e(t,n,r,i){L(this,e),this.targetId=t,this.fromCache=n,this.Pi=r,this.vi=i}return M(e,null,[{key:"Vi",value:function(t,n){var r,i=xr(),a=xr(),u=y(n.docChanges);try{for(u.s();!(r=u.n()).done;){var o=r.value;switch(o.type){case 0:i=i.add(o.doc.key);break;case 1:a=a.add(o.doc.key)}}}catch(s){u.e(s)}finally{u.f()}return new e(t,n.fromCache,i,a)}}]),e}(),Du=function(){function e(){L(this,e),this.Si=!1}return M(e,[{key:"initialize",value:function(e,t){this.Di=e,this.indexManager=t,this.Si=!0}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var i=this;return this.Ci(e,t).next(function(a){return a||i.xi(e,t,r,n)}).next(function(n){return n||i.Ni(e,t)})}},{key:"Ci",value:function(e,t){return Le.resolve(null)}},{key:"xi",value:function(e,t,n,r){var a=this;return hn(t)||r.isEqual(de.min())?this.Ni(e,t):this.Di.getDocuments(e,n).next(function(u){var o=a.ki(t,u);return a.Oi(t,o,n,r)?a.Ni(e,t):(q()<=i.LogLevel.DEBUG&&B("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),xn(t)),a.Mi(e,o,t,Ee(r,-1)))})}},{key:"ki",value:function(e,t){var n=new Xe(En(e));return t.forEach(function(t,r){bn(e,r)&&(n=n.add(r))}),n}},{key:"Oi",value:function(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;var i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Ni",value:function(e,t){return q()<=i.LogLevel.DEBUG&&B("QueryEngine","Using full collection scan to execute query:",xn(t)),this.Di.getDocumentsMatchingQuery(e,t,Se.min())}},{key:"Mi",value:function(e,t,n,r){return this.Di.getDocumentsMatchingQuery(e,n,r).next(function(e){return t.forEach(function(t){e=e.insert(t.key,t)}),e})}}]),e}(),_u=function(){function e(t,n,r,i){L(this,e),this.persistence=t,this.Fi=n,this.wt=i,this.$i=new He(ce),this.Bi=new lr(function(e){return Bt(e)},Gt),this.Li=new Map,this.Ui=t.getRemoteDocumentCache(),this.Vs=t.getTargetCache(),this.Ds=t.getBundleCache(),this.qi(r)}return M(e,[{key:"qi",value:function(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ou(this.Ui,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ui.setIndexManager(this.indexManager),this.Fi.initialize(this.localDocuments,this.indexManager)}},{key:"collectGarbage",value:function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return e.collect(n,t.$i)})}}]),e}();function Au(e,t,n,r){return new _u(e,t,n,r)}function Nu(e,t){return Cu.apply(this,arguments)}function Cu(){return(Cu=g(p().mark(function e(t,n){var r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=H(t),e.next=3,r.persistence.runTransaction("Handle user change","readonly",function(e){var t;return r.mutationQueue.getAllMutationBatches(e).next(function(i){return t=i,r.qi(n),r.mutationQueue.getAllMutationBatches(e)}).next(function(n){var i,a=[],u=[],o=xr(),s=y(t);try{for(s.s();!(i=s.n()).done;){var c=i.value;a.push(c.batchId);var l,f=y(c.mutations);try{for(f.s();!(l=f.n()).done;){var h=l.value;o=o.add(h.key)}}catch(w){f.e(w)}finally{f.f()}}}catch(w){s.e(w)}finally{s.f()}var d,v=y(n);try{for(v.s();!(d=v.n()).done;){var p=d.value;u.push(p.batchId);var m,g=y(p.mutations);try{for(g.s();!(m=g.n()).done;){var k=m.value;o=o.add(k.key)}}catch(w){g.e(w)}finally{g.f()}}}catch(w){v.e(w)}finally{v.f()}return r.localDocuments.getDocuments(e,o).next(function(e){return{Ki:e,removedBatchIds:a,addedBatchIds:u}})})});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Lu(e,t){var n=H(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(e){var r=t.batch.keys(),i=n.Ui.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){var i=n.batch,a=i.keys(),u=Le.resolve();return a.forEach(function(e){u=u.next(function(){return r.getEntry(t,e)}).next(function(t){var a=n.docVersions.get(e);Q(null!==a),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),u.next(function(){return e.mutationQueue.removeMutationBatch(t,i)})}(n,e,t,i).next(function(){return i.apply(e)}).next(function(){return n.mutationQueue.performConsistencyCheck(e)}).next(function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)}).next(function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){for(var t=xr(),n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))}).next(function(){return n.localDocuments.getDocuments(e,r)})})}function Vu(e){var t=H(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.Vs.getLastRemoteSnapshotVersion(e)})}function Mu(e,t){var n=H(e),r=t.snapshotVersion,i=n.$i;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(e){var a=n.Ui.newChangeBuffer({trackRemovals:!0});i=n.$i;var u=[];t.targetChanges.forEach(function(a,o){var s=i.get(o);if(s){u.push(n.Vs.removeMatchingKeys(e,a.removedDocuments,o).next(function(){return n.Vs.addMatchingKeys(e,a.addedDocuments,o)}));var c=s.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(o)?c=c.withResumeToken(nt.EMPTY_BYTE_STRING,de.min()).withLastLimboFreeSnapshotVersion(de.min()):a.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(a.resumeToken,r)),i=i.insert(o,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(s,c,a)&&u.push(n.Vs.updateTargetData(e,c))}});var o=hr(),s=xr();if(t.documentUpdates.forEach(function(r){t.resolvedLimboDocuments.has(r)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),u.push(Ru(e,a,t.documentUpdates).next(function(e){o=e.Gi,s=e.Qi})),!r.isEqual(de.min())){var c=n.Vs.getLastRemoteSnapshotVersion(e).next(function(t){return n.Vs.setTargetsMetadata(e,e.currentSequenceNumber,r)});u.push(c)}return Le.waitFor(u).next(function(){return a.apply(e)}).next(function(){return n.localDocuments.getLocalViewOfDocuments(e,o,s)}).next(function(){return o})}).then(function(e){return n.$i=i,e})}function Ru(e,t,n){var r=xr(),i=xr();return n.forEach(function(e){return r=r.add(e)}),t.getEntries(e,r).next(function(e){var r=hr();return n.forEach(function(n,a){var u=e.get(n);a.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(n)),a.isNoDocument()&&a.version.isEqual(de.min())?(t.removeEntry(n,a.readTime),r=r.insert(n,a)):!u.isValidDocument()||a.version.compareTo(u.version)>0||0===a.version.compareTo(u.version)&&u.hasPendingWrites?(t.addEntry(a),r=r.insert(n,a)):B("LocalStore","Ignoring outdated watch update for ",n,". Current version:",u.version," Watch version:",a.version)}),{Gi:r,Qi:i}})}function Ou(e,t){var n=H(e);return n.persistence.runTransaction("Get next mutation batch","readonly",function(e){return void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)})}function Fu(e,t){var n=H(e);return n.persistence.runTransaction("Allocate target","readwrite",function(e){var r;return n.Vs.getTargetData(e,t).next(function(i){return i?(r=i,Le.resolve(r)):n.Vs.allocateTargetId(e).next(function(i){return r=new Qi(t,i,0,e.currentSequenceNumber),n.Vs.addTargetData(e,r).next(function(){return r})})})}).then(function(e){var r=n.$i.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.$i=n.$i.insert(e.targetId,e),n.Bi.set(t,e.targetId)),e})}function Pu(e,t,n){return qu.apply(this,arguments)}function qu(){return(qu=g(p().mark(function e(t,n,r){var i,a,u;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=H(t),a=i.$i.get(n),u=r?"readwrite":"readwrite-primary",e.prev=1,e.t0=r,e.t0){e.next=6;break}return e.next=6,i.persistence.runTransaction("Release target",u,function(e){return i.persistence.referenceDelegate.removeTarget(e,a)});case 6:e.next=13;break;case 8:if(e.prev=8,e.t1=e.catch(1),Fe(e.t1)){e.next=12;break}throw e.t1;case 12:B("LocalStore","Failed to update sequence numbers for target ".concat(n,": ").concat(e.t1));case 13:i.$i=i.$i.remove(n),i.Bi.delete(a.target);case 14:case"end":return e.stop()}},e,null,[[1,8]])}))).apply(this,arguments)}function Uu(e,t,n){var r=H(e),i=de.min(),a=xr();return r.persistence.runTransaction("Execute query","readonly",function(e){return function(e,t,n){var r=H(e),i=r.Bi.get(n);return void 0!==i?Le.resolve(r.$i.get(i)):r.Vs.getTargetData(t,n)}(r,e,mn(t)).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Vs.getMatchingKeysForTargetId(e,t.targetId).next(function(e){a=e})}).next(function(){return r.Fi.getDocumentsMatchingQuery(e,t,n?i:de.min(),n?a:xr())}).next(function(e){return Gu(r,In(t),e),{documents:e,ji:a}})})}function Bu(e,t){var n=H(e),r=H(n.Vs),i=n.$i.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(e){return r.te(e,t).next(function(e){return e?e.target:null})})}function Ku(e,t){var n=H(e),r=n.Li.get(t)||de.min();return n.persistence.runTransaction("Get new document changes","readonly",function(e){return n.Ui.getAllFromCollectionGroup(e,t,Ee(r,-1),Number.MAX_SAFE_INTEGER)}).then(function(e){return Gu(n,t,e),e})}function Gu(e,t,n){var r=de.min();n.forEach(function(e,t){t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Li.set(t,r)}function ju(e,t,n,r){return zu.apply(this,arguments)}function zu(){return(zu=g(p().mark(function e(t,n,r,i){var a,u,o,s,c,l,f,h,d,v;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=H(t),u=xr(),o=hr(),s=y(r);try{for(s.s();!(c=s.n()).done;)l=c.value,f=n.Wi(l.metadata.name),l.document&&(u=u.add(f)),(h=n.zi(l)).setReadTime(n.Hi(l.metadata.readTime)),o=o.insert(f,h)}catch(p){s.e(p)}finally{s.f()}return d=a.Ui.newChangeBuffer({trackRemovals:!0}),e.next=7,Fu(a,function(e){return mn(fn(ye.fromString("__bundle__/docs/".concat(e))))}(i));case 7:return v=e.sent,e.abrupt("return",a.persistence.runTransaction("Apply bundle documents","readwrite",function(e){return Ru(e,d,o).next(function(t){return d.apply(e),t}).next(function(t){return a.Vs.removeMatchingKeysForTargetId(e,v.targetId).next(function(){return a.Vs.addMatchingKeys(e,u,v.targetId)}).next(function(){return a.localDocuments.getLocalViewOfDocuments(e,t.Gi,t.Qi)}).next(function(){return t.Gi})})}));case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Qu(e,t){return Wu.apply(this,arguments)}function Wu(){return(Wu=g(p().mark(function e(t,n){var r,i,a,u=arguments;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]?u[2]:xr(),e.next=3,Fu(t,mn(na(n.bundledQuery)));case 3:return i=e.sent,a=H(t),e.abrupt("return",a.persistence.runTransaction("Save named query","readwrite",function(e){var t=qr(n.readTime);if(i.snapshotVersion.compareTo(t)>=0)return a.Ds.saveNamedQuery(e,n);var u=i.withResumeToken(nt.EMPTY_BYTE_STRING,t);return a.$i=a.$i.insert(u.targetId,u),a.Vs.updateTargetData(e,u).next(function(){return a.Vs.removeMatchingKeysForTargetId(e,i.targetId)}).next(function(){return a.Vs.addMatchingKeys(e,r,i.targetId)}).next(function(){return a.Ds.saveNamedQuery(e,n)})}));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Hu(e,t){return"firestore_clients_".concat(e,"_").concat(t)}function Yu(e,t,n){var r="firestore_mutations_".concat(e,"_").concat(n);return t.isAuthenticated()&&(r+="_".concat(t.uid)),r}function Ju(e,t){return"firestore_targets_".concat(e,"_").concat(t)}var Xu=function(){function e(t,n,r,i){L(this,e),this.user=t,this.batchId=n,this.state=r,this.error=i}return M(e,[{key:"Yi",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Ji",value:function(t,n,r){var i,a=JSON.parse(r),u="object"==v(a)&&-1!==["pending","acknowledged","rejected"].indexOf(a.state)&&(void 0===a.error||"object"==v(a.error));return u&&a.error&&((u="string"==typeof a.error.message&&"string"==typeof a.error.code)&&(i=new J(a.error.code,a.error.message))),u?new e(t,n,a.state,i):(K("SharedClientState","Failed to parse mutation state for ID '".concat(n,"': ").concat(r)),null)}}]),e}(),$u=function(){function e(t,n,r){L(this,e),this.targetId=t,this.state=n,this.error=r}return M(e,[{key:"Yi",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Ji",value:function(t,n){var r,i=JSON.parse(n),a="object"==v(i)&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==v(i.error));return a&&i.error&&((a="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new J(i.error.code,i.error.message))),a?new e(t,i.state,r):(K("SharedClientState","Failed to parse target state for ID '".concat(t,"': ").concat(n)),null)}}]),e}(),Zu=function(){function e(t,n){L(this,e),this.clientId=t,this.activeTargetIds=n}return M(e,null,[{key:"Ji",value:function(t,n){for(var r=JSON.parse(n),i="object"==v(r)&&r.activeTargetIds instanceof Array,a=Ir(),u=0;i&&u<r.activeTargetIds.length;++u)i=vt(r.activeTargetIds[u]),a=a.add(r.activeTargetIds[u]);return i?new e(t,a):(K("SharedClientState","Failed to parse client data for instance '".concat(t,"': ").concat(n)),null)}}]),e}(),eo=function(){function e(t,n){L(this,e),this.clientId=t,this.onlineState=n}return M(e,null,[{key:"Ji",value:function(t){var n=JSON.parse(t);return"object"==v(n)&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new e(n.clientId,n.onlineState):(K("SharedClientState","Failed to parse online state: ".concat(t)),null)}}]),e}(),to=function(){function e(){L(this,e),this.activeTargetIds=Ir()}return M(e,[{key:"Xi",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"Zi",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"Yi",value:function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]),e}(),no=function(){function e(t,n,r,i,a){L(this,e),this.window=t,this.js=n,this.persistenceKey=r,this.tr=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.er=this.nr.bind(this),this.sr=new He(ce),this.started=!1,this.ir=[];var u=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=a,this.rr=Hu(this.persistenceKey,this.tr),this.ur=function(e){return"firestore_sequence_number_".concat(e)}(this.persistenceKey),this.sr=this.sr.insert(this.tr,new to),this.cr=new RegExp("^firestore_clients_".concat(u,"_([^_]*)$")),this.ar=new RegExp("^firestore_mutations_".concat(u,"_(\\d+)(?:_(.*))?$")),this.hr=new RegExp("^firestore_targets_".concat(u,"_(\\d+)$")),this.lr=function(e){return"firestore_online_state_".concat(e)}(this.persistenceKey),this.dr=function(e){return"firestore_bundle_loaded_v2_".concat(e)}(this.persistenceKey),this.window.addEventListener("storage",this.er)}return M(e,[{key:"start",value:function(){var e=g(p().mark(function e(){var t,n,r,i,a,u,o,s,c,l,f,h=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.syncEngine.Ri();case 2:t=e.sent,n=y(t),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=14;break}if((i=r.value)!==this.tr){e.next=10;break}return e.abrupt("continue",12);case 10:(a=this.getItem(Hu(this.persistenceKey,i)))&&(u=Zu.Ji(i,a))&&(this.sr=this.sr.insert(u.clientId,u));case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:this._r(),(o=this.storage.getItem(this.lr))&&(s=this.wr(o))&&this.mr(s),c=y(this.ir);try{for(c.s();!(l=c.n()).done;)f=l.value,this.nr(f)}catch(d){c.e(d)}finally{c.f()}this.ir=[],this.window.addEventListener("pagehide",function(){return h.shutdown()}),this.started=!0;case 28:case"end":return e.stop()}},e,this,[[4,16,19,22]])}));return function(){return e.apply(this,arguments)}}()},{key:"writeSequenceNumber",value:function(e){this.setItem(this.ur,JSON.stringify(e))}},{key:"getAllActiveQueryTargets",value:function(){return this.gr(this.sr)}},{key:"isActiveQueryTarget",value:function(e){var t=!1;return this.sr.forEach(function(n,r){r.activeTargetIds.has(e)&&(t=!0)}),t}},{key:"addPendingMutation",value:function(e){this.yr(e,"pending")}},{key:"updateMutationState",value:function(e,t,n){this.yr(e,t,n),this.pr(e)}},{key:"addLocalQueryTarget",value:function(e){var t="not-current";if(this.isActiveQueryTarget(e)){var n=this.storage.getItem(Ju(this.persistenceKey,e));if(n){var r=$u.Ji(e,n);r&&(t=r.state)}}return this.Ir.Xi(e),this._r(),t}},{key:"removeLocalQueryTarget",value:function(e){this.Ir.Zi(e),this._r()}},{key:"isLocalQueryTarget",value:function(e){return this.Ir.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){this.removeItem(Ju(this.persistenceKey,e))}},{key:"updateQueryState",value:function(e,t,n){this.Tr(e,t,n)}},{key:"handleUserChange",value:function(e,t,n){var r=this;t.forEach(function(e){r.pr(e)}),this.currentUser=e,n.forEach(function(e){r.addPendingMutation(e)})}},{key:"setOnlineState",value:function(e){this.Er(e)}},{key:"notifyBundleLoaded",value:function(e){this.Ar(e)}},{key:"shutdown",value:function(){this.started&&(this.window.removeEventListener("storage",this.er),this.removeItem(this.rr),this.started=!1)}},{key:"getItem",value:function(e){var t=this.storage.getItem(e);return B("SharedClientState","READ",e,t),t}},{key:"setItem",value:function(e,t){B("SharedClientState","SET",e,t),this.storage.setItem(e,t)}},{key:"removeItem",value:function(e){B("SharedClientState","REMOVE",e),this.storage.removeItem(e)}},{key:"nr",value:function(e){var t=this,n=e;if(n.storageArea===this.storage){if(B("SharedClientState","EVENT",n.key,n.newValue),n.key===this.rr)return void K("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.js.enqueueRetryable(g(p().mark(function e(){var r,i,a,u,o,s,c;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.started){e.next=43;break}if(null===n.key){e.next=41;break}if(!t.cr.test(n.key)){e.next=11;break}if(null!=n.newValue){e.next=6;break}return r=t.Rr(n.key),e.abrupt("return",t.br(r,null));case 6:if(!(i=t.Pr(n.key,n.newValue))){e.next=9;break}return e.abrupt("return",t.br(i.clientId,i));case 9:e.next=41;break;case 11:if(!t.ar.test(n.key)){e.next=18;break}if(null===n.newValue){e.next=16;break}if(!(a=t.vr(n.key,n.newValue))){e.next=16;break}return e.abrupt("return",t.Vr(a));case 16:e.next=41;break;case 18:if(!t.hr.test(n.key)){e.next=25;break}if(null===n.newValue){e.next=23;break}if(!(u=t.Sr(n.key,n.newValue))){e.next=23;break}return e.abrupt("return",t.Dr(u));case 23:e.next=41;break;case 25:if(n.key!==t.lr){e.next=32;break}if(null===n.newValue){e.next=30;break}if(!(o=t.wr(n.newValue))){e.next=30;break}return e.abrupt("return",t.mr(o));case 30:e.next=41;break;case 32:if(n.key!==t.ur){e.next=37;break}(s=function(e){var t=je.ot;if(null!=e)try{var n=JSON.parse(e);Q("number"==typeof n),t=n}catch(e){K("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(n.newValue))!==je.ot&&t.sequenceNumberHandler(s),e.next=41;break;case 37:if(n.key!==t.dr){e.next=41;break}return c=t.Cr(n.newValue),e.next=41,Promise.all(c.map(function(e){return t.syncEngine.Nr(e)}));case 41:e.next=44;break;case 43:t.ir.push(n);case 44:case"end":return e.stop()}},e)})))}}},{key:"Ir",get:function(){return this.sr.get(this.tr)}},{key:"_r",value:function(){this.setItem(this.rr,this.Ir.Yi())}},{key:"yr",value:function(e,t,n){var r=new Xu(this.currentUser,e,t,n),i=Yu(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Yi())}},{key:"pr",value:function(e){var t=Yu(this.persistenceKey,this.currentUser,e);this.removeItem(t)}},{key:"Er",value:function(e){var t={clientId:this.tr,onlineState:e};this.storage.setItem(this.lr,JSON.stringify(t))}},{key:"Tr",value:function(e,t,n){var r=Ju(this.persistenceKey,e),i=new $u(e,t,n);this.setItem(r,i.Yi())}},{key:"Ar",value:function(e){var t=JSON.stringify(Array.from(e));this.setItem(this.dr,t)}},{key:"Rr",value:function(e){var t=this.cr.exec(e);return t?t[1]:null}},{key:"Pr",value:function(e,t){var n=this.Rr(e);return Zu.Ji(n,t)}},{key:"vr",value:function(e,t){var n=this.ar.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Xu.Ji(new O(i),r,t)}},{key:"Sr",value:function(e,t){var n=this.hr.exec(e),r=Number(n[1]);return $u.Ji(r,t)}},{key:"wr",value:function(e){return eo.Ji(e)}},{key:"Cr",value:function(e){return JSON.parse(e)}},{key:"Vr",value:function(){var e=g(p().mark(function e(t){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.user.uid!==this.currentUser.uid){e.next=2;break}return e.abrupt("return",this.syncEngine.kr(t.batchId,t.state,t.error));case 2:B("SharedClientState","Ignoring mutation for non-active user ".concat(t.user.uid));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"Dr",value:function(e){return this.syncEngine.Or(e.targetId,e.state,e.error)}},{key:"br",value:function(e,t){var n=this,r=t?this.sr.insert(e,t):this.sr.remove(e),i=this.gr(this.sr),a=this.gr(r),u=[],o=[];return a.forEach(function(e){i.has(e)||u.push(e)}),i.forEach(function(e){a.has(e)||o.push(e)}),this.syncEngine.Mr(u,o).then(function(){n.sr=r})}},{key:"mr",value:function(e){this.sr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}},{key:"gr",value:function(e){var t=Ir();return e.forEach(function(e,n){t=t.unionWith(n.activeTargetIds)}),t}}],[{key:"V",value:function(e){return!(!e||!e.localStorage)}}]),e}(),ro=function(){function e(){L(this,e),this.Fr=new to,this.$r={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return M(e,[{key:"addPendingMutation",value:function(e){}},{key:"updateMutationState",value:function(e,t,n){}},{key:"addLocalQueryTarget",value:function(e){return this.Fr.Xi(e),this.$r[e]||"not-current"}},{key:"updateQueryState",value:function(e,t,n){this.$r[e]=t}},{key:"removeLocalQueryTarget",value:function(e){this.Fr.Zi(e)}},{key:"isLocalQueryTarget",value:function(e){return this.Fr.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){delete this.$r[e]}},{key:"getAllActiveQueryTargets",value:function(){return this.Fr.activeTargetIds}},{key:"isActiveQueryTarget",value:function(e){return this.Fr.activeTargetIds.has(e)}},{key:"start",value:function(){return this.Fr=new to,Promise.resolve()}},{key:"handleUserChange",value:function(e,t,n){}},{key:"setOnlineState",value:function(e){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(e){}},{key:"notifyBundleLoaded",value:function(e){}}]),e}(),io=function(){function e(){L(this,e)}return M(e,[{key:"Br",value:function(e){}},{key:"shutdown",value:function(){}}]),e}(),ao=function(){function e(){var t=this;L(this,e),this.Lr=function(){return t.Ur()},this.qr=function(){return t.Kr()},this.Gr=[],this.Qr()}return M(e,[{key:"Br",value:function(e){this.Gr.push(e)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.Lr),window.removeEventListener("offline",this.qr)}},{key:"Qr",value:function(){window.addEventListener("online",this.Lr),window.addEventListener("offline",this.qr)}},{key:"Ur",value:function(){B("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var e,t=y(this.Gr);try{for(t.s();!(e=t.n()).done;){(0,e.value)(0)}}catch(n){t.e(n)}finally{t.f()}}},{key:"Kr",value:function(){B("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var e,t=y(this.Gr);try{for(t.s();!(e=t.n()).done;){(0,e.value)(1)}}catch(n){t.e(n)}finally{t.f()}}}],[{key:"V",value:function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),uo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},oo=function(){function e(t){L(this,e),this.jr=t.jr,this.Wr=t.Wr}return M(e,[{key:"zr",value:function(e){this.Hr=e}},{key:"Jr",value:function(e){this.Yr=e}},{key:"onMessage",value:function(e){this.Xr=e}},{key:"close",value:function(){this.Wr()}},{key:"send",value:function(e){this.jr(e)}},{key:"Zr",value:function(){this.Hr()}},{key:"eo",value:function(e){this.Yr(e)}},{key:"no",value:function(e){this.Xr(e)}}]),e}(),so=function(e){k(n,function(){function e(t){L(this,e);this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http";this.so=n+"://"+t.host,this.io="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}M(e,[{key:"ro",value:function e(t,n,r,i,a){var u=this.oo(t,n);B("RestConnection","Sending: ",u,r);var o={};return this.uo(o,i,a),this.co(t,u,o,r).then(function(e){return B("RestConnection","Received: ",e),e},function(e){throw G("RestConnection","".concat(t," failed with error: "),e,"url: ",u,"request:",r),e})}},{key:"ao",value:function e(t,n,r,i,a){return this.ro(t,n,r,i,a)}},{key:"uo",value:function e(t,n,r){t["X-Goog-Api-Client"]="gl-js/ fire/"+F,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(function(e,n){return t[n]=e}),r&&r.headers.forEach(function(e,n){return t[n]=e})}},{key:"oo",value:function e(t,n){var r=uo[t];return"".concat(this.so,"/v1/").concat(n,":").concat(r)}}]);return e}());var t=x(n);function n(e){var r;return L(this,n),(r=t.call(this,e)).forceLongPolling=e.forceLongPolling,r.autoDetectLongPolling=e.autoDetectLongPolling,r.useFetchStreams=e.useFetchStreams,r}return M(n,[{key:"co",value:function(e,t,n,r){return new Promise(function(i,a){var o=new u.XhrIo;o.listenOnce(u.EventType.COMPLETE,function(){try{switch(o.getLastErrorCode()){case u.ErrorCode.NO_ERROR:var t=o.getResponseJson();B("Connection","XHR received:",JSON.stringify(t)),i(t);break;case u.ErrorCode.TIMEOUT:B("Connection",'RPC "'+e+'" timed out'),a(new J(Y.DEADLINE_EXCEEDED,"Request time out"));break;case u.ErrorCode.HTTP_ERROR:var n=o.getStatus();if(B("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){var r=o.getResponseJson().error;if(r&&r.status&&r.message){var s=(c=r.status.toLowerCase().replace(/_/g,"-"),Object.values(Y).indexOf(c)>=0?c:Y.UNKNOWN);a(new J(s,r.message))}else a(new J(Y.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new J(Y.UNAVAILABLE,"Connection failed."));break;default:z()}}finally{B("Connection",'RPC "'+e+'" completed.')}var c});var s=JSON.stringify(r);o.send(t,"POST",s,n,15)})}},{key:"ho",value:function(e,t,n){var r=[this.so,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=(0,u.createWebChannelTransport)(),o=(0,u.getStatEventTarget)(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(s.xmlHttpFactory=new u.FetchXmlHttpFactory({})),this.uo(s.initMessageHeaders,t,n),(0,a.isMobileCordova)()||(0,a.isReactNative)()||(0,a.isElectron)()||(0,a.isIE)()||(0,a.isUWP)()||(0,a.isBrowserExtension)()||(s.httpHeadersOverwriteParam="$httpHeaders");var c=r.join("");B("Connection","Creating WebChannel: "+c,s);var l=i.createWebChannel(c,s),f=!1,h=!1,d=new oo({jr:function(e){h?B("Connection","Not sending because WebChannel is closed:",e):(f||(B("Connection","Opening WebChannel transport."),l.open(),f=!0),B("Connection","WebChannel sending:",e),l.send(e))},Wr:function(){return l.close()}}),v=function(e,t,n){e.listen(t,function(e){try{n(e)}catch(e){setTimeout(function(){throw e},0)}})};return v(l,u.WebChannel.EventType.OPEN,function(){h||B("Connection","WebChannel transport opened.")}),v(l,u.WebChannel.EventType.CLOSE,function(){h||(h=!0,B("Connection","WebChannel transport closed"),d.eo())}),v(l,u.WebChannel.EventType.ERROR,function(e){h||(h=!0,G("Connection","WebChannel transport errored:",e),d.eo(new J(Y.UNAVAILABLE,"The operation could not be completed")))}),v(l,u.WebChannel.EventType.MESSAGE,function(e){var t;if(!h){var n=e.data[0];Q(!!n);var r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){B("Connection","WebChannel received error:",i);var a=i.status,u=function(e){var t=rr[a];if(void 0!==t)return cr(t)}(),o=i.message;void 0===u&&(u=Y.INTERNAL,o="Unknown error status: "+a+" with message "+i.message),h=!0,d.eo(new J(u,o)),l.close()}else B("Connection","WebChannel received:",n),d.no(n)}}),v(o,u.Event.STAT_EVENT,function(e){e.stat===u.Stat.PROXY?B("Connection","Detected buffering proxy"):e.stat===u.Stat.NOPROXY&&B("Connection","Detected no buffering proxy")}),setTimeout(function(){d.Zr()},0),d}}]),n}();function co(){return"undefined"!=typeof window?window:null}function lo(){return"undefined"!=typeof document?document:null}function fo(e){return new Rr(e,!0)}var ho=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;L(this,e),this.js=t,this.timerId=n,this.lo=r,this.fo=i,this._o=a,this.wo=0,this.mo=null,this.yo=Date.now(),this.reset()}return M(e,[{key:"reset",value:function(){this.wo=0}},{key:"po",value:function(){this.wo=this._o}},{key:"Io",value:function(e){var t=this;this.cancel();var n=Math.floor(this.wo+this.To()),r=Math.max(0,Date.now()-this.yo),i=Math.max(0,n-r);i>0&&B("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.wo," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.mo=this.js.enqueueAfterDelay(this.timerId,i,function(){return t.yo=Date.now(),e()}),this.wo*=this.fo,this.wo<this.lo&&(this.wo=this.lo),this.wo>this._o&&(this.wo=this._o)}},{key:"Eo",value:function(){null!==this.mo&&(this.mo.skipDelay(),this.mo=null)}},{key:"cancel",value:function(){null!==this.mo&&(this.mo.cancel(),this.mo=null)}},{key:"To",value:function(){return(Math.random()-.5)*this.wo}}]),e}(),vo=function(){function e(t,n,r,i,a,u,o,s){L(this,e),this.js=t,this.Ao=r,this.Ro=i,this.bo=a,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=o,this.listener=s,this.state=0,this.Po=0,this.vo=null,this.Vo=null,this.stream=null,this.So=new ho(t,n)}return M(e,[{key:"Do",value:function(){return 1===this.state||5===this.state||this.Co()}},{key:"Co",value:function(){return 2===this.state||3===this.state}},{key:"start",value:function(){4!==this.state?this.auth():this.xo()}},{key:"stop",value:function(){var e=g(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.Do(),!e.t0){e.next=4;break}return e.next=4,this.close(0);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"No",value:function(){this.state=0,this.So.reset()}},{key:"ko",value:function(){var e=this;this.Co()&&null===this.vo&&(this.vo=this.js.enqueueAfterDelay(this.Ao,6e4,function(){return e.Oo()}))}},{key:"Mo",value:function(e){this.Fo(),this.stream.send(e)}},{key:"Oo",value:function(){var e=g(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.Co()){e.next=2;break}return e.abrupt("return",this.close(0));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"Fo",value:function(){this.vo&&(this.vo.cancel(),this.vo=null)}},{key:"$o",value:function(){this.Vo&&(this.Vo.cancel(),this.Vo=null)}},{key:"close",value:function(){var e=g(p().mark(function e(t,n){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.Fo(),this.$o(),this.So.cancel(),this.Po++,4!==t?this.So.reset():n&&n.code===Y.RESOURCE_EXHAUSTED?(K(n.toString()),K("Using maximum backoff delay to prevent overloading the backend."),this.So.po()):n&&n.code===Y.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Bo(),this.stream.close(),this.stream=null),this.state=t,e.next=9,this.listener.Jr(n);case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"Bo",value:function(){}},{key:"auth",value:function(){var e=this;this.state=1;var t=this.Lo(this.Po),n=this.Po;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(function(t){var r=l(t,2),i=r[0],a=r[1];e.Po===n&&e.Uo(i,a)},function(n){t(function(){var t=new J(Y.UNKNOWN,"Fetching auth token failed: "+n.message);return e.qo(t)})})}},{key:"Uo",value:function(e,t){var n=this,r=this.Lo(this.Po);this.stream=this.Ko(e,t),this.stream.zr(function(){r(function(){return n.state=2,n.Vo=n.js.enqueueAfterDelay(n.Ro,1e4,function(){return n.Co()&&(n.state=3),Promise.resolve()}),n.listener.zr()})}),this.stream.Jr(function(e){r(function(){return n.qo(e)})}),this.stream.onMessage(function(e){r(function(){return n.onMessage(e)})})}},{key:"xo",value:function(){var e=this;this.state=5,this.So.Io(g(p().mark(function t(){return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case"end":return t.stop()}},t)})))}},{key:"qo",value:function(e){return B("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}},{key:"Lo",value:function(e){var t=this;return function(n){t.js.enqueueAndForget(function(){return t.Po===e?n():(B("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}}}]),e}(),yo=function(e){k(n,vo);var t=x(n);function n(e,r,i,a,u,o){var s;return L(this,n),(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,i,a,o)).wt=u,s}return M(n,[{key:"Ko",value:function(e,t){return this.bo.ho("Listen",e,t)}},{key:"onMessage",value:function(e){this.So.reset();var t=Xr(this.wt,e),n=function(e){if(!("targetChange"in e))return de.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?de.min():t.readTime?qr(t.readTime):de.min()}(e);return this.listener.Go(t,n)}},{key:"Qo",value:function(e){var t={};t.database=Qr(this.wt),t.addTarget=function(e,t){var n,r=t.target;return(n=jt(r)?{documents:ti(e,r)}:{query:ni(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=Fr(e,t.resumeToken):t.snapshotVersion.compareTo(de.min())>0&&(n.readTime=Or(e,t.snapshotVersion.toTimestamp())),n}(this.wt,e);var n=ii(this.wt,e);n&&(t.labels=n),this.Mo(t)}},{key:"jo",value:function(e){var t={};t.database=Qr(this.wt),t.removeTarget=e,this.Mo(t)}}]),n}(),po=function(e){k(n,vo);var t=x(n);function n(e,r,i,a,u,o){var s;return L(this,n),(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,i,a,o)).wt=u,s.Wo=!1,s}return M(n,[{key:"zo",get:function(){return this.Wo}},{key:"start",value:function(){this.Wo=!1,this.lastStreamToken=void 0,s(T(n.prototype),"start",this).call(this)}},{key:"Bo",value:function(){this.Wo&&this.Ho([])}},{key:"Ko",value:function(e,t){return this.bo.ho("Write",e,t)}},{key:"onMessage",value:function(e){if(Q(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Wo){this.So.reset();var t=ei(e.writeResults,e.commitTime),n=qr(e.commitTime);return this.listener.Jo(n,t)}return Q(!e.writeResults||0===e.writeResults.length),this.Wo=!0,this.listener.Yo()}},{key:"Xo",value:function(){var e={};e.database=Qr(this.wt),this.Mo(e)}},{key:"Ho",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map(function(e){return $r(t.wt,e)})};this.Mo(n)}}]),n}(),mo=function(e){k(n,function(){function e(){L(this,e)}return M(e)}());var t=x(n);function n(e,r,i,a){var u;return L(this,n),(u=t.call(this)).authCredentials=e,u.appCheckCredentials=r,u.bo=i,u.wt=a,u.Zo=!1,u}return M(n,[{key:"tu",value:function(){if(this.Zo)throw new J(Y.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"ro",value:function(e,t,n){var r=this;return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(function(i){var a=l(i,2),u=a[0],o=a[1];return r.bo.ro(e,t,n,u,o)}).catch(function(e){throw"FirebaseError"===e.name?(e.code===Y.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new J(Y.UNKNOWN,e.toString())})}},{key:"ao",value:function(e,t,n){var r=this;return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(function(i){var a=l(i,2),u=a[0],o=a[1];return r.bo.ao(e,t,n,u,o)}).catch(function(e){throw"FirebaseError"===e.name?(e.code===Y.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new J(Y.UNKNOWN,e.toString())})}},{key:"terminate",value:function(){this.Zo=!0}}]),n}(),go=function(){function e(t,n){L(this,e),this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.eu=0,this.nu=null,this.su=!0}return M(e,[{key:"iu",value:function(){var e=this;0===this.eu&&(this.ru("Unknown"),this.nu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return e.nu=null,e.ou("Backend didn't respond within 10 seconds."),e.ru("Offline"),Promise.resolve()}))}},{key:"uu",value:function(e){"Online"===this.state?this.ru("Unknown"):(this.eu++,this.eu>=1&&(this.cu(),this.ou("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.ru("Offline")))}},{key:"set",value:function(e){this.cu(),this.eu=0,"Online"===e&&(this.su=!1),this.ru(e)}},{key:"ru",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"ou",value:function(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.su?(K(t),this.su=!1):B("OnlineStateTracker",t)}},{key:"cu",value:function(){null!==this.nu&&(this.nu.cancel(),this.nu=null)}}]),e}(),ko=M(function e(t,n,r,i,a){var u=this;L(this,e),this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.au=[],this.hu=new Map,this.lu=new Set,this.fu=[],this.du=a,this.du.Br(function(e){r.enqueueAndForget(g(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=No(u),!e.t0){e.next=5;break}return B("RemoteStore","Restarting streams for network reachability change."),e.next=5,function(){var e=g(p().mark(function e(t){var n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=H(t)).lu.add(4),e.next=4,bo(n);case 4:return n._u.set("Unknown"),n.lu.delete(4),e.next=8,wo(n);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()(u);case 5:case"end":return e.stop()}},e)})))}),this._u=new go(r,i)});function wo(e){return xo.apply(this,arguments)}function xo(){return(xo=g(p().mark(function e(t){var n,r,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!No(t)){e.next=18;break}n=y(t.fu),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return i=r.value,e.next=8,i(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}},e,null,[[2,12,15,18]])}))).apply(this,arguments)}function bo(e){return Io.apply(this,arguments)}function Io(){return(Io=g(p().mark(function e(t){var n,r,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=y(t.fu),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,i(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}},e,null,[[1,11,14,17]])}))).apply(this,arguments)}function Eo(e,t){var n=H(e);n.hu.has(t.targetId)||(n.hu.set(t.targetId,t),Ao(n)?_o(n):as(n).Co()&&So(n,t))}function To(e,t){var n=H(e),r=as(n);n.hu.delete(t),r.Co()&&Do(n,t),0===n.hu.size&&(r.Co()?r.ko():No(n)&&n._u.set("Unknown"))}function So(e,t){e.wu.Nt(t.targetId),as(e).Qo(t)}function Do(e,t){e.wu.Nt(t),as(e).jo(t)}function _o(e){e.wu=new Nr({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},te:function(t){return e.hu.get(t)||null}}),as(e).start(),e._u.iu()}function Ao(e){return No(e)&&!as(e).Do()&&e.hu.size>0}function No(e){return 0===H(e).lu.size}function Co(e){e.wu=void 0}function Lo(e){return Vo.apply(this,arguments)}function Vo(){return(Vo=g(p().mark(function e(t){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.hu.forEach(function(e,n){So(t,e)});case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Mo(e,t){return Ro.apply(this,arguments)}function Ro(){return(Ro=g(p().mark(function e(t,n){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Co(t),Ao(t)?(t._u.uu(n),_o(t)):t._u.set("Unknown");case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Oo(e,t,n){return Fo.apply(this,arguments)}function Fo(){return(Fo=g(p().mark(function e(t,n,r){var i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t._u.set("Online"),!(n instanceof _r&&2===n.state&&n.cause)){e.next=13;break}return e.prev=1,e.next=4,function(){var e=g(p().mark(function e(t,n){var r,i,a,u;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.cause,i=y(n.targetIds),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=14;break}if(u=a.value,e.t0=t.hu.has(u),!e.t0){e.next=12;break}return e.next=10,t.remoteSyncer.rejectListen(u,r);case 10:t.hu.delete(u),t.wu.removeTarget(u);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(2),i.e(e.t1);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case"end":return e.stop()}},e,null,[[2,16,19,22]])}));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),B("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),e.t0),e.next=11,Po(t,e.t0);case 11:e.next=29;break;case 13:if(n instanceof Sr?t.wu.Ut(n):n instanceof Dr?t.wu.zt(n):t.wu.Gt(n),r.isEqual(de.min())){e.next=29;break}return e.prev=14,e.next=17,Vu(t.localStore);case 17:if(i=e.sent,e.t1=r.compareTo(i)>=0,!e.t1){e.next=22;break}return e.next=22,function(e,t){var n=e.wu.Yt(t);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.hu.get(r);i&&e.hu.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(function(t){var n=e.hu.get(t);if(n){e.hu.set(t,n.withResumeToken(nt.EMPTY_BYTE_STRING,n.snapshotVersion)),Do(e,t);var r=new Qi(n.target,t,1,n.sequenceNumber);So(e,r)}}),e.remoteSyncer.applyRemoteEvent(n)}(t,r);case 22:e.next=29;break;case 24:return e.prev=24,e.t2=e.catch(14),B("RemoteStore","Failed to raise snapshot:",e.t2),e.next=29,Po(t,e.t2);case 29:case"end":return e.stop()}},e,null,[[1,6],[14,24]])}))).apply(this,arguments)}function Po(e,t,n){return qo.apply(this,arguments)}function qo(){return(qo=g(p().mark(function e(t,n,r){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Fe(n)){e.next=2;break}throw n;case 2:return t.lu.add(1),e.next=5,bo(t);case 5:t._u.set("Offline"),r||(r=function(){return Vu(t.localStore)}),t.asyncQueue.enqueueRetryable(g(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return B("RemoteStore","Retrying IndexedDB access"),e.next=3,r();case 3:return t.lu.delete(1),e.next=6,wo(t);case 6:case"end":return e.stop()}},e)})));case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Uo(e,t){return t().catch(function(n){return Po(e,n,t)})}function Bo(e){return Ko.apply(this,arguments)}function Ko(){return(Ko=g(p().mark(function e(t){var n,r,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=H(t),r=us(n),i=n.au.length>0?n.au[n.au.length-1].batchId:-1;case 2:if(!Go(n)){e.next=19;break}return e.prev=3,e.next=6,Ou(n.localStore,i);case 6:if(null!==(a=e.sent)){e.next=10;break}return 0===n.au.length&&r.ko(),e.abrupt("break",19);case 10:i=a.batchId,jo(n,a),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,Po(n,e.t0);case 17:e.next=2;break;case 19:zo(n)&&Qo(n);case 20:case"end":return e.stop()}},e,null,[[3,13]])}))).apply(this,arguments)}function Go(e){return No(e)&&e.au.length<10}function jo(e,t){e.au.push(t);var n=us(e);n.Co()&&n.zo&&n.Ho(t.mutations)}function zo(e){return No(e)&&!us(e).Do()&&e.au.length>0}function Qo(e){us(e).start()}function Wo(e){return Ho.apply(this,arguments)}function Ho(){return(Ho=g(p().mark(function e(t){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:us(t).Xo();case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Yo(e){return Jo.apply(this,arguments)}function Jo(){return(Jo=g(p().mark(function e(t){var n,r,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=us(t),r=y(t.au);try{for(r.s();!(i=r.n()).done;)a=i.value,n.Ho(a.mutations)}catch(u){r.e(u)}finally{r.f()}case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Xo(e,t,n){return $o.apply(this,arguments)}function $o(){return($o=g(p().mark(function e(t,n,r){var i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.au.shift(),a=ji.from(i,n,r),e.next=3,Uo(t,function(){return t.remoteSyncer.applySuccessfulWrite(a)});case 3:return e.next=5,Bo(t);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Zo(e,t){return es.apply(this,arguments)}function es(){return(es=g(p().mark(function e(t,n){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n&&us(t).zo,!e.t0){e.next=4;break}return e.next=4,function(){var e=g(p().mark(function e(t,n){var r,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!sr(i=n.code)||i===Y.ABORTED){e.next=7;break}return r=t.au.shift(),us(t).No(),e.next=5,Uo(t,function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)});case 5:return e.next=7,Bo(t);case 7:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:zo(t)&&Qo(t);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ts(e,t){return ns.apply(this,arguments)}function ns(){return(ns=g(p().mark(function e(t,n){var r,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=H(t)).asyncQueue.verifyOperationInProgress(),B("RemoteStore","RemoteStore received new credentials"),i=No(r),r.lu.add(3),e.next=6,bo(r);case 6:return i&&r._u.set("Unknown"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r.lu.delete(3),e.next=12,wo(r);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}function rs(e,t){return is.apply(this,arguments)}function is(){return(is=g(p().mark(function e(t,n){var r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=H(t),!n){e.next=7;break}return r.lu.delete(2),e.next=5,wo(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r.lu.add(2),e.next=12,bo(r);case 12:r._u.set("Unknown");case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function as(e){return e.mu||(e.mu=function(e,t,n){var r=H(e);return r.tu(),new yo(t,r.bo,r.authCredentials,r.appCheckCredentials,r.wt,n)}(e.datastore,e.asyncQueue,{zr:Lo.bind(null,e),Jr:Mo.bind(null,e),Go:Oo.bind(null,e)}),e.fu.push(function(){var t=g(p().mark(function t(n){return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}e.mu.No(),Ao(e)?_o(e):e._u.set("Unknown"),t.next=7;break;case 4:return t.next=6,e.mu.stop();case 6:Co(e);case 7:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())),e.mu}function us(e){return e.gu||(e.gu=function(e,t,n){var r=H(e);return r.tu(),new po(t,r.bo,r.authCredentials,r.appCheckCredentials,r.wt,n)}(e.datastore,e.asyncQueue,{zr:Wo.bind(null,e),Jr:Zo.bind(null,e),Yo:Yo.bind(null,e),Jo:Xo.bind(null,e)}),e.fu.push(function(){var t=g(p().mark(function t(n){return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.gu.No(),t.next=4,Bo(e);case 4:t.next=9;break;case 6:return t.next=8,e.gu.stop();case 8:e.au.length>0&&(B("RemoteStore","Stopping write stream with ".concat(e.au.length," pending writes")),e.au=[]);case 9:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())),e.gu}var os=function(){function e(t,n,r,i,a){L(this,e),this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new X,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(e){})}return M(e,[{key:"start",value:function(e){var t=this;this.timerHandle=setTimeout(function(){return t.handleDelayElapsed()},e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new J(Y.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)})}],[{key:"createAndSchedule",value:function(t,n,r,i,a){var u=new e(t,n,Date.now()+r,i,a);return u.start(r),u}}]),e}();function ss(e,t){if(K("AsyncQueue","".concat(t,": ").concat(e)),Fe(e))return new J(Y.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}var cs=function(){function e(t){L(this,e),this.comparator=t?function(e,n){return t(e,n)||ge.comparator(e.key,n.key)}:function(e,t){return ge.comparator(e.key,t.key)},this.keyedMap=vr(),this.sortedSet=new He(this.comparator)}return M(e,[{key:"has",value:function(e){return null!=this.keyedMap.get(e)}},{key:"get",value:function(e){return this.keyedMap.get(e)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:"size",get:function(){return this.sortedSet.size}},{key:"forEach",value:function(e){this.sortedSet.inorderTraversal(function(t,n){return e(t),!1})}},{key:"add",value:function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:"delete",value:function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}},{key:"copy",value:function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}],[{key:"emptySet",value:function(t){return new e(t.comparator)}}]),e}(),ls=function(){function e(){L(this,e),this.yu=new He(ge.comparator)}return M(e,[{key:"track",value:function(e){var t=e.doc.key,n=this.yu.get(t);n?0!==e.type&&3===n.type?this.yu=this.yu.insert(t,e):3===e.type&&1!==n.type?this.yu=this.yu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.yu=this.yu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.yu=this.yu.remove(t):1===e.type&&2===n.type?this.yu=this.yu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):z():this.yu=this.yu.insert(t,e)}},{key:"pu",value:function(){var e=[];return this.yu.inorderTraversal(function(t,n){e.push(n)}),e}}]),e}(),fs=function(){function e(t,n,r,i,a,u,o,s){L(this,e),this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=u,this.syncStateChanged=o,this.excludesMetadataChanges=s}return M(e,[{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&kn(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function(t,n,r,i){var a=[];return n.forEach(function(e){a.push({type:0,doc:e})}),new e(t,n,cs.emptySet(n),a,r,i,!0,!1)}}]),e}(),hs=M(function e(){L(this,e),this.Iu=void 0,this.listeners=[]}),ds=M(function e(){L(this,e),this.queries=new lr(function(e){return wn(e)},kn),this.onlineState="Unknown",this.Tu=new Set});function vs(e,t){return ys.apply(this,arguments)}function ys(){return(ys=g(p().mark(function e(t,n){var r,i,a,u,o;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=H(t),i=n.query,a=!1,(u=r.queries.get(i))||(a=!0,u=new hs),!a){e.next=13;break}return e.prev=3,e.next=6,r.onListen(i);case 6:u.Iu=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),o=ss(e.t0,"Initialization of query '".concat(xn(n.query),"' failed")),e.abrupt("return",void n.onError(o));case 13:r.queries.set(i,u),u.listeners.push(n),n.Eu(r.onlineState),u.Iu&&n.Au(u.Iu)&&ws(r);case 14:case"end":return e.stop()}},e,null,[[3,9]])}))).apply(this,arguments)}function ps(e,t){return ms.apply(this,arguments)}function ms(){return(ms=g(p().mark(function e(t,n){var r,i,a,u,o;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=H(t),i=n.query,a=!1,(u=r.queries.get(i))&&(o=u.listeners.indexOf(n))>=0&&(u.listeners.splice(o,1),a=0===u.listeners.length),!a){e.next=6;break}return e.abrupt("return",(r.queries.delete(i),r.onUnlisten(i)));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function gs(e,t){var n,r=H(e),i=!1,a=y(t);try{for(a.s();!(n=a.n()).done;){var u=n.value,o=u.query,s=r.queries.get(o);if(s){var c,l=y(s.listeners);try{for(l.s();!(c=l.n()).done;){c.value.Au(u)&&(i=!0)}}catch(f){l.e(f)}finally{l.f()}s.Iu=u}}}catch(f){a.e(f)}finally{a.f()}i&&ws(r)}function ks(e,t,n){var r=H(e),i=r.queries.get(t);if(i){var a,u=y(i.listeners);try{for(u.s();!(a=u.n()).done;){a.value.onError(n)}}catch(o){u.e(o)}finally{u.f()}}r.queries.delete(t)}function ws(e){e.Tu.forEach(function(e){e.next()})}var xs=function(){function e(t,n,r){L(this,e),this.query=t,this.Ru=n,this.bu=!1,this.Pu=null,this.onlineState="Unknown",this.options=r||{}}return M(e,[{key:"Au",value:function(e){if(!this.options.includeMetadataChanges){var t,n=[],r=y(e.docChanges);try{for(r.s();!(t=r.n()).done;){var i=t.value;3!==i.type&&n.push(i)}}catch(u){r.e(u)}finally{r.f()}e=new fs(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}var a=!1;return this.bu?this.vu(e)&&(this.Ru.next(e),a=!0):this.Vu(e,this.onlineState)&&(this.Su(e),a=!0),this.Pu=e,a}},{key:"onError",value:function(e){this.Ru.error(e)}},{key:"Eu",value:function(e){this.onlineState=e;var t=!1;return this.Pu&&!this.bu&&this.Vu(this.Pu,e)&&(this.Su(this.Pu),t=!0),t}},{key:"Vu",value:function(e,t){if(!e.fromCache)return!0;var n="Offline"!==t;return!(this.options.Du&&n||e.docs.isEmpty()&&"Offline"!==t)}},{key:"vu",value:function(e){if(e.docChanges.length>0)return!0;var t=this.Pu&&this.Pu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}},{key:"Su",value:function(e){e=fs.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.bu=!0,this.Ru.next(e)}}]),e}(),bs=function(){function e(t,n){L(this,e),this.payload=t,this.byteLength=n}return M(e,[{key:"Cu",value:function(){return"metadata"in this.payload}}]),e}(),Is=function(){function e(t){L(this,e),this.wt=t}return M(e,[{key:"Wi",value:function(e){return Gr(this.wt,e)}},{key:"zi",value:function(e){return e.metadata.exists?Yr(this.wt,e.document,!1):Pt.newNoDocument(this.Wi(e.metadata.name),this.Hi(e.metadata.readTime))}},{key:"Hi",value:function(e){return qr(e)}}]),e}(),Es=function(){function e(t,n,r){L(this,e),this.xu=t,this.localStore=n,this.wt=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Ts(t)}return M(e,[{key:"Nu",value:function(e){this.progress.bytesLoaded+=e.byteLength;var t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;var n=ye.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}},{key:"ku",value:function(e){var t,n=new Map,r=new Is(this.wt),i=y(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.metadata.queries){var u,o=r.Wi(a.metadata.name),s=y(a.metadata.queries);try{for(s.s();!(u=s.n()).done;){var c=u.value,l=(n.get(c)||xr()).add(o);n.set(c,l)}}catch(f){s.e(f)}finally{s.f()}}}}catch(f){i.e(f)}finally{i.f()}return n}},{key:"complete",value:function(){var e=g(p().mark(function e(){var t,n,r,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ju(this.localStore,new Is(this.wt),this.documents,this.xu.id);case 2:t=e.sent,n=this.ku(this.documents),r=y(this.queries),e.prev=5,r.s();case 7:if((i=r.n()).done){e.next=13;break}return a=i.value,e.next=11,Qu(this.localStore,a,n.get(a.name));case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",(this.progress.taskState="Success",{progress:this.progress,Ou:this.collectionGroups,Mu:t}));case 22:case"end":return e.stop()}},e,this,[[5,15,18,21]])}));return function(){return e.apply(this,arguments)}}()}]),e}();function Ts(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}var Ss=M(function e(t){L(this,e),this.key=t}),Ds=M(function e(t){L(this,e),this.key=t}),_s=function(){function e(t,n){L(this,e),this.query=t,this.Fu=n,this.$u=null,this.current=!1,this.Bu=xr(),this.mutatedKeys=xr(),this.Lu=En(t),this.Uu=new cs(this.Lu)}return M(e,[{key:"qu",get:function(){return this.Fu}},{key:"Ku",value:function(e,t){var n=this,r=t?t.Gu:new ls,i=t?t.Uu:this.Uu,a=t?t.mutatedKeys:this.mutatedKeys,u=i,o=!1,s="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(function(e,t){var l=i.get(e),f=bn(n.query,t)?t:null,h=!!l&&n.mutatedKeys.has(l.key),d=!!f&&(f.hasLocalMutations||n.mutatedKeys.has(f.key)&&f.hasCommittedMutations),v=!1;l&&f?l.data.isEqual(f.data)?h!==d&&(r.track({type:3,doc:f}),v=!0):n.Qu(l,f)||(r.track({type:2,doc:f}),v=!0,(s&&n.Lu(f,s)>0||c&&n.Lu(f,c)<0)&&(o=!0)):!l&&f?(r.track({type:0,doc:f}),v=!0):l&&!f&&(r.track({type:1,doc:l}),v=!0,(s||c)&&(o=!0)),v&&(f?(u=u.add(f),a=d?a.add(e):a.delete(e)):(u=u.delete(e),a=a.delete(e)))}),null!==this.query.limit)for(;u.size>this.query.limit;){var l="F"===this.query.limitType?u.last():u.first();u=u.delete(l.key),a=a.delete(l.key),r.track({type:1,doc:l})}return{Uu:u,Gu:r,Oi:o,mutatedKeys:a}}},{key:"Qu",value:function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:"applyChanges",value:function(e,t,n){var r=this,i=this.Uu;this.Uu=e.Uu,this.mutatedKeys=e.mutatedKeys;var a=e.Gu.pu();a.sort(function(e,t){return function(e,t){var n=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return z()}};return n(e)-n(t)}(e.type,t.type)||r.Lu(e.doc,t.doc)}),this.ju(n);var u=t?this.Wu():[],o=0===this.Bu.size&&this.current?1:0,s=o!==this.$u;return this.$u=o,0!==a.length||s?{snapshot:new fs(this.query,e.Uu,i,a,e.mutatedKeys,0===o,s,!1),zu:u}:{zu:u}}},{key:"Eu",value:function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Uu:this.Uu,Gu:new ls,mutatedKeys:this.mutatedKeys,Oi:!1},!1)):{zu:[]}}},{key:"Hu",value:function(e){return!this.Fu.has(e)&&!!this.Uu.has(e)&&!this.Uu.get(e).hasLocalMutations}},{key:"ju",value:function(e){var t=this;e&&(e.addedDocuments.forEach(function(e){return t.Fu=t.Fu.add(e)}),e.modifiedDocuments.forEach(function(e){}),e.removedDocuments.forEach(function(e){return t.Fu=t.Fu.delete(e)}),this.current=e.current)}},{key:"Wu",value:function(){var e=this;if(!this.current)return[];var t=this.Bu;this.Bu=xr(),this.Uu.forEach(function(t){e.Hu(t.key)&&(e.Bu=e.Bu.add(t.key))});var n=[];return t.forEach(function(t){e.Bu.has(t)||n.push(new Ds(t))}),this.Bu.forEach(function(e){t.has(e)||n.push(new Ss(e))}),n}},{key:"Ju",value:function(e){this.Fu=e.ji,this.Bu=xr();var t=this.Ku(e.documents);return this.applyChanges(t,!0)}},{key:"Yu",value:function(){return fs.fromInitialDocuments(this.query,this.Uu,this.mutatedKeys,0===this.$u)}}]),e}(),As=M(function e(t,n,r){L(this,e),this.query=t,this.targetId=n,this.view=r}),Ns=M(function e(t){L(this,e),this.key=t,this.Xu=!1}),Cs=function(){function e(t,n,r,i,a,u){L(this,e),this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=u,this.Zu={},this.tc=new lr(function(e){return wn(e)},kn),this.ec=new Map,this.nc=new Set,this.sc=new He(ge.comparator),this.ic=new Map,this.rc=new lu,this.oc={},this.uc=new Map,this.cc=Ua.Rn(),this.onlineState="Unknown",this.ac=void 0}return M(e,[{key:"isPrimaryClient",get:function(){return!0===this.ac}}]),e}();function Ls(e,t){return Vs.apply(this,arguments)}function Vs(){return(Vs=g(p().mark(function e(t,n){var r,i,a,u,o,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Tc(t),!(u=r.tc.get(n))){e.next=6;break}i=u.targetId,r.sharedClientState.addLocalQueryTarget(i),a=u.view.Yu(),e.next=15;break;case 6:return e.next=8,Fu(r.localStore,mn(n));case 8:return o=e.sent,r.isPrimaryClient&&Eo(r.remoteStore,o),s=r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.targetId,e.next=14,Ms(r,n,i,"current"===s);case 14:a=e.sent;case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ms(e,t,n,r){return Rs.apply(this,arguments)}function Rs(){return(Rs=g(p().mark(function e(t,n,r,i){var a,u,o,s,c,l;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.hc=function(e,n,r){return(i=g(p().mark(function e(t,n,r,i){var a,u,o;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.view.Ku(r),e.t0=a.Oi,!e.t0){e.next=6;break}return e.next=5,Uu(t.localStore,n.query,!1).then(function(e){var t=e.documents;return n.view.Ku(t,a)});case 5:a=e.sent;case 6:return u=i&&i.targetChanges.get(n.targetId),o=n.view.applyChanges(a,t.isPrimaryClient,u),e.abrupt("return",(tc(t,n.targetId,o.zu),o.snapshot));case 8:case"end":return e.stop()}},e)})),function(e,t,n,r){return i.apply(this,arguments)})(t,e,n,r);var i},e.next=3,Uu(t.localStore,n,!0);case 3:return a=e.sent,u=new _s(n,a.ji),o=u.Ku(a.documents),s=Tr.createSynthesizedTargetChangeForCurrentChange(r,i&&"Offline"!==t.onlineState),c=u.applyChanges(o,t.isPrimaryClient,s),tc(t,r,c.zu),l=new As(n,r,u),e.abrupt("return",(t.tc.set(n,l),t.ec.has(r)?t.ec.get(r).push(n):t.ec.set(r,[n]),c.snapshot));case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Os(e,t){return Fs.apply(this,arguments)}function Fs(){return(Fs=g(p().mark(function e(t,n){var r,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=H(t),i=r.tc.get(n),!((a=r.ec.get(i.targetId)).length>1)){e.next=3;break}return e.abrupt("return",(r.ec.set(i.targetId,a.filter(function(e){return!kn(e,n)})),void r.tc.delete(n)));case 3:if(!r.isPrimaryClient){e.next=11;break}if(r.sharedClientState.removeLocalQueryTarget(i.targetId),e.t0=r.sharedClientState.isActiveQueryTarget(i.targetId),e.t0){e.next=9;break}return e.next=9,Pu(r.localStore,i.targetId,!1).then(function(){r.sharedClientState.clearQueryState(i.targetId),To(r.remoteStore,i.targetId),Zs(r,i.targetId)}).catch(Ne);case 9:e.next=14;break;case 11:return Zs(r,i.targetId),e.next=14,Pu(r.localStore,i.targetId,!0);case 14:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ps(e,t,n){return qs.apply(this,arguments)}function qs(){return(qs=g(p().mark(function e(t,n,r){var i,a,u;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=Sc(t),e.prev=1,e.next=4,function(e,t){var n,r,i=H(e),a=he.now(),u=t.reduce(function(e,t){return e.add(t.key)},xr());return i.persistence.runTransaction("Locally write mutations","readwrite",function(e){var o=hr(),s=xr();return i.Ui.getEntries(e,u).next(function(e){(o=e).forEach(function(e,t){t.isValidDocument()||(s=s.add(e))})}).next(function(){return i.localDocuments.getOverlayedDocuments(e,o)}).next(function(r){n=r;var u,o=[],s=y(t);try{for(s.s();!(u=s.n()).done;){var c=u.value,l=Jn(c,n.get(c.key).overlayedDocument);null!=l&&o.push(new Zn(c.key,l,Ft(l.value.mapValue),jn.exists(!0)))}}catch(f){s.e(f)}finally{s.f()}return i.mutationQueue.addMutationBatch(e,a,o,t)}).next(function(t){r=t;var a=t.applyToLocalDocumentSet(n,s);return i.documentOverlayCache.saveOverlays(e,t.batchId,a)})}).then(function(){return{batchId:r.batchId,changes:yr(n)}})}(i.localStore,n);case 4:return a=e.sent,i.sharedClientState.addPendingMutation(a.batchId),function(e,t,n){var r=e.oc[e.currentUser.toKey()];r||(r=new He(ce)),r=r.insert(t,n),e.oc[e.currentUser.toKey()]=r}(i,a.batchId,r),e.next=9,ic(i,a.changes);case 9:return e.next=11,Bo(i.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),u=ss(e.t0,"Failed to persist write"),r.reject(u);case 17:case"end":return e.stop()}},e,null,[[1,13]])}))).apply(this,arguments)}function Us(e,t){return Bs.apply(this,arguments)}function Bs(){return(Bs=g(p().mark(function e(t,n){var r,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=H(t),e.prev=1,e.next=4,Mu(r.localStore,n);case 4:return i=e.sent,n.targetChanges.forEach(function(e,t){var n=r.ic.get(t);n&&(Q(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.Xu=!0:e.modifiedDocuments.size>0?Q(n.Xu):e.removedDocuments.size>0&&(Q(n.Xu),n.Xu=!1))}),e.next=8,ic(r,i,n);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,Ne(e.t0);case 14:case"end":return e.stop()}},e,null,[[1,10]])}))).apply(this,arguments)}function Ks(e,t,n){var r=H(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.tc.forEach(function(e,n){var r=n.view.Eu(t);r.snapshot&&i.push(r.snapshot)}),function(e,t){var n=H(e);n.onlineState=t;var r=!1;n.queries.forEach(function(e,n){var i,a=y(n.listeners);try{for(a.s();!(i=a.n()).done;){i.value.Eu(t)&&(r=!0)}}catch(u){a.e(u)}finally{a.f()}}),r&&ws(n)}(r.eventManager,t),i.length&&r.Zu.Go(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Gs(e,t,n){return js.apply(this,arguments)}function js(){return(js=g(p().mark(function e(t,n,r){var i,a,u,o,s,c;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((i=H(t)).sharedClientState.updateQueryState(n,"rejected",r),a=i.ic.get(n),!(u=a&&a.key)){e.next=14;break}return o=(o=new He(ge.comparator)).insert(u,Pt.newNoDocument(u,de.min())),s=xr().add(u),c=new Er(de.min(),new Map,new Xe(ce),o,s),e.next=9,Us(i,c);case 9:i.sc=i.sc.remove(u),i.ic.delete(n),rc(i),e.next=16;break;case 14:return e.next=16,Pu(i.localStore,n,!1).then(function(){return Zs(i,n,r)}).catch(Ne);case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}function zs(e,t){return Qs.apply(this,arguments)}function Qs(){return(Qs=g(p().mark(function e(t,n){var r,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=H(t),i=n.batch.batchId,e.prev=1,e.next=4,Lu(r.localStore,n);case 4:return a=e.sent,$s(r,i,null),Xs(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),e.next=10,ic(r,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Ne(e.t0);case 16:case"end":return e.stop()}},e,null,[[1,12]])}))).apply(this,arguments)}function Ws(e,t,n){return Hs.apply(this,arguments)}function Hs(){return(Hs=g(p().mark(function e(t,n,r){var i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=H(t),e.prev=1,e.next=4,function(e,t){var n=H(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var r;return n.mutationQueue.lookupMutationBatch(e,t).next(function(t){return Q(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)}).next(function(){return n.mutationQueue.performConsistencyCheck(e)}).next(function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)}).next(function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)}).next(function(){return n.localDocuments.getDocuments(e,r)})})}(i.localStore,n);case 4:return a=e.sent,$s(i,n,r),Xs(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),e.next=10,ic(i,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Ne(e.t0);case 16:case"end":return e.stop()}},e,null,[[1,12]])}))).apply(this,arguments)}function Ys(e,t){return Js.apply(this,arguments)}function Js(){return(Js=g(p().mark(function e(t,n){var r,i,a,u;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return No((r=H(t)).remoteStore)||B("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.prev=2,e.next=5,function(e){var t=H(r.localStore);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(e){return t.mutationQueue.getHighestUnacknowledgedBatchId(e)})}();case 5:if(-1!==(i=e.sent)){e.next=8;break}return e.abrupt("return",void n.resolve());case 8:(a=r.uc.get(i)||[]).push(n),r.uc.set(i,a),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),u=ss(e.t0,"Initialization of waitForPendingWrites() operation failed"),n.reject(u);case 16:case"end":return e.stop()}},e,null,[[2,12]])}))).apply(this,arguments)}function Xs(e,t){(e.uc.get(t)||[]).forEach(function(e){e.resolve()}),e.uc.delete(t)}function $s(e,t,n){var r=H(e),i=r.oc[r.currentUser.toKey()];if(i){var a=i.get(t);a&&(n?a.reject(n):a.resolve(),i=i.remove(t)),r.oc[r.currentUser.toKey()]=i}}function Zs(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var r,i=y(e.ec.get(t));try{for(i.s();!(r=i.n()).done;){var a=r.value;e.tc.delete(a),n&&e.Zu.lc(a,n)}}catch(u){i.e(u)}finally{i.f()}e.ec.delete(t),e.isPrimaryClient&&e.rc.us(t).forEach(function(t){e.rc.containsKey(t)||ec(e,t)})}function ec(e,t){e.nc.delete(t.path.canonicalString());var n=e.sc.get(t);null!==n&&(To(e.remoteStore,n),e.sc=e.sc.remove(t),e.ic.delete(n),rc(e))}function tc(e,t,n){var r,i=y(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;a instanceof Ss?(e.rc.addReference(a.key,t),nc(e,a)):a instanceof Ds?(B("SyncEngine","Document no longer in limbo: "+a.key),e.rc.removeReference(a.key,t),e.rc.containsKey(a.key)||ec(e,a.key)):z()}}catch(u){i.e(u)}finally{i.f()}}function nc(e,t){var n=t.key,r=n.path.canonicalString();e.sc.get(n)||e.nc.has(r)||(B("SyncEngine","New document in limbo: "+n),e.nc.add(r),rc(e))}function rc(e){for(;e.nc.size>0&&e.sc.size<e.maxConcurrentLimboResolutions;){var t=e.nc.values().next().value;e.nc.delete(t);var n=new ge(ye.fromString(t)),r=e.cc.next();e.ic.set(r,new Ns(n)),e.sc=e.sc.insert(n,r),Eo(e.remoteStore,new Qi(mn(fn(n.path)),r,2,je.ot))}}function ic(e,t,n){return ac.apply(this,arguments)}function ac(){return(ac=g(p().mark(function e(t,n,r){var i,a,u,o;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=H(t),a=[],u=[],o=[],e.t0=i.tc.isEmpty(),e.t0){e.next=9;break}return i.tc.forEach(function(e,t){o.push(i.hc(t,n,r).then(function(e){if(e){i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),a.push(e);var n=Su.Vi(t.targetId,e);u.push(n)}}))}),e.next=6,Promise.all(o);case 6:return i.Zu.Go(a),e.next=9,function(){var e=g(p().mark(function e(t,n){var r,i,a,u,o,s,c,l;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=H(t),e.prev=1,e.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(e){return Le.forEach(n,function(t){return Le.forEach(t.Pi,function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)}).next(function(){return Le.forEach(t.vi,function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)})})})});case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),Fe(e.t0)){e.next=10;break}throw e.t0;case 10:B("LocalStore","Failed to update sequence numbers: "+e.t0);case 11:i=y(n);try{for(i.s();!(a=i.n()).done;)u=a.value,o=u.targetId,u.fromCache||(s=r.$i.get(o),c=s.snapshotVersion,l=s.withLastLimboFreeSnapshotVersion(c),r.$i=r.$i.insert(o,l))}catch(f){i.e(f)}finally{i.f()}case 13:case"end":return e.stop()}},e,null,[[1,6]])}));return function(t,n){return e.apply(this,arguments)}}()(i.localStore,u);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function uc(e,t){return oc.apply(this,arguments)}function oc(){return(oc=g(p().mark(function e(t,n){var r,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((r=H(t)).currentUser.isEqual(n)){e.next=11;break}return B("SyncEngine","User change. New user:",n.toKey()),e.next=5,Nu(r.localStore,n);case 5:return i=e.sent,r.currentUser=n,function(e,t){e.uc.forEach(function(e){e.forEach(function(e){e.reject(new J(Y.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.uc.clear()}(r),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),e.next=11,ic(r,i.Ki);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function sc(e,t){var n=H(e),r=n.ic.get(t);if(r&&r.Xu)return xr().add(r.key);var i=xr(),a=n.ec.get(t);if(!a)return i;var u,o=y(a);try{for(o.s();!(u=o.n()).done;){var s=u.value,c=n.tc.get(s);i=i.unionWith(c.view.qu)}}catch(l){o.e(l)}finally{o.f()}return i}function cc(e,t){return lc.apply(this,arguments)}function lc(){return(lc=g(p().mark(function e(t,n){var r,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=H(t),e.next=3,Uu(r.localStore,n.query,!0);case 3:return i=e.sent,a=n.view.Ju(i),e.abrupt("return",(r.isPrimaryClient&&tc(r,n.targetId,a.zu),a));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function fc(e,t){return hc.apply(this,arguments)}function hc(){return(hc=g(p().mark(function e(t,n){var r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=H(t),e.abrupt("return",Ku(r.localStore,n).then(function(e){return ic(r,e)}));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function dc(e,t,n,r){return vc.apply(this,arguments)}function vc(){return(vc=g(p().mark(function e(t,n,r,i){var a,u;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=H(t),e.next=3,function(e,t){var n=H(e),r=H(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return r.yn(e,t).next(function(t){return t?n.localDocuments.getDocuments(e,t):Le.resolve(null)})})}(a.localStore,n);case 3:if(null===(u=e.sent)){e.next=15;break}if("pending"!==r){e.next=10;break}return e.next=8,Bo(a.remoteStore);case 8:e.next=11;break;case 10:"acknowledged"===r||"rejected"===r?($s(a,n,i||null),Xs(a,n),function(e,t){H(H(e).mutationQueue).In(t)}(a.localStore,n)):z();case 11:return e.next=13,ic(a,u);case 13:e.next=16;break;case 15:B("SyncEngine","Cannot apply mutation batch with id: "+n);case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}function yc(e,t){return pc.apply(this,arguments)}function pc(){return(pc=g(p().mark(function e(t,n){var r,i,a,u,o,s,c,l;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Tc(r=H(t)),Sc(r),!0!==n||!0===r.ac){e.next=13;break}return i=r.sharedClientState.getAllActiveQueryTargets(),e.next=5,mc(r,i.toArray());case 5:return a=e.sent,r.ac=!0,e.next=9,rs(r.remoteStore,!0);case 9:u=y(a);try{for(u.s();!(o=u.n()).done;)s=o.value,Eo(r.remoteStore,s)}catch(f){u.e(f)}finally{u.f()}e.next=25;break;case 13:if(!1!==n||!1===r.ac){e.next=25;break}return c=[],l=Promise.resolve(),r.ec.forEach(function(e,t){r.sharedClientState.isLocalQueryTarget(t)?c.push(t):l=l.then(function(){return Zs(r,t),Pu(r.localStore,t,!0)}),To(r.remoteStore,t)}),e.next=19,l;case 19:return e.next=21,mc(r,c);case 21:return function(e){var t=H(r);t.ic.forEach(function(e,n){To(t.remoteStore,n)}),t.rc.cs(),t.ic=new Map,t.sc=new He(ge.comparator)}(),r.ac=!1,e.next=25,rs(r.remoteStore,!1);case 25:case"end":return e.stop()}},e)}))).apply(this,arguments)}function mc(e,t,n){return gc.apply(this,arguments)}function gc(){return(gc=g(p().mark(function e(t,n,r){var i,a,u,o,s,c,l,f,h,d,v,m,g,k;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=H(t),a=[],u=[],o=y(n),e.prev=2,o.s();case 4:if((s=o.n()).done){e.next=45;break}if(c=s.value,l=void 0,!(f=i.ec.get(c))||0===f.length){e.next=34;break}return e.next=11,Fu(i.localStore,mn(f[0]));case 11:l=e.sent,h=y(f),e.prev=13,h.s();case 15:if((d=h.n()).done){e.next=24;break}return v=d.value,m=i.tc.get(v),e.next=20,cc(i,m);case 20:(g=e.sent).snapshot&&u.push(g.snapshot);case 22:e.next=15;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),h.e(e.t0);case 29:return e.prev=29,h.f(),e.finish(29);case 32:e.next=42;break;case 34:return e.next=36,Bu(i.localStore,c);case 36:return k=e.sent,e.next=39,Fu(i.localStore,k);case 39:return l=e.sent,e.next=42,Ms(i,kc(k),c,!1);case 42:a.push(l);case 43:e.next=4;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(2),o.e(e.t1);case 50:return e.prev=50,o.f(),e.finish(50);case 53:return e.abrupt("return",(i.Zu.Go(u),a));case 54:case"end":return e.stop()}},e,null,[[2,47,50,53],[13,26,29,32]])}))).apply(this,arguments)}function kc(e){return ln(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function wc(e){var t=H(e);return H(H(t.localStore).persistence).Ri()}function xc(e,t,n,r){return bc.apply(this,arguments)}function bc(){return(bc=g(p().mark(function e(t,n,r,i){var a,u,o,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=H(t)).ac){e.next=3;break}return e.abrupt("return",void B("SyncEngine","Ignoring unexpected query state notification."));case 3:if(!((u=a.ec.get(n))&&u.length>0)){e.next=20;break}e.t0=r,e.next="current"===e.t0?8:"not-current"===e.t0?8:"rejected"===e.t0?15:19;break;case 8:return e.next=10,Ku(a.localStore,In(u[0]));case 10:return o=e.sent,s=Er.createSynthesizedRemoteEventForCurrentChange(n,"current"===r),e.next=14,ic(a,o,s);case 14:return e.abrupt("break",20);case 15:return e.next=17,Pu(a.localStore,n,!0);case 17:return Zs(a,n,i),e.abrupt("break",20);case 19:z();case 20:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ic(e,t,n){return Ec.apply(this,arguments)}function Ec(){return(Ec=g(p().mark(function e(t,n,r){var i,a,u,o,s,c,l,f,h;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=Tc(t)).ac){e.next=45;break}a=y(n),e.prev=3,a.s();case 5:if((u=a.n()).done){e.next=21;break}if(o=u.value,!i.ec.has(o)){e.next=10;break}return B("SyncEngine","Adding an already active target "+o),e.abrupt("continue",19);case 10:return e.next=12,Bu(i.localStore,o);case 12:return s=e.sent,e.next=15,Fu(i.localStore,s);case 15:return c=e.sent,e.next=18,Ms(i,kc(s),c.targetId,!1);case 18:Eo(i.remoteStore,c);case 19:e.next=5;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),a.e(e.t0);case 26:return e.prev=26,a.f(),e.finish(26);case 29:l=y(r),e.prev=30,h=p().mark(function e(){var t;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.value,e.t0=i.ec.has(t),!e.t0){e.next=5;break}return e.next=5,Pu(i.localStore,t,!1).then(function(){To(i.remoteStore,t),Zs(i,t)}).catch(Ne);case 5:case"end":return e.stop()}},e)}),l.s();case 33:if((f=l.n()).done){e.next=37;break}return e.delegateYield(h(),"t1",35);case 35:e.next=33;break;case 37:e.next=42;break;case 39:e.prev=39,e.t2=e.catch(30),l.e(e.t2);case 42:return e.prev=42,l.f(),e.finish(42);case 45:case"end":return e.stop()}},e,null,[[3,23,26,29],[30,39,42,45]])}))).apply(this,arguments)}function Tc(e){var t=H(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Us.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=sc.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Gs.bind(null,t),t.Zu.Go=gs.bind(null,t.eventManager),t.Zu.lc=ks.bind(null,t.eventManager),t}function Sc(e){var t=H(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=zs.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Ws.bind(null,t),t}function Dc(e,t,n){var r,i=H(e);(r=g(p().mark(function e(t,n,r){var i,a,u,o,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getMetadata();case 3:return i=e.sent,e.next=6,function(e,t){var n=H(e),r=qr(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",function(e){return n.Ds.getBundleMetadata(e,t.id)}).then(function(e){return!!e&&e.createTime.compareTo(r)>=0})}(t.localStore,i);case 6:if(!e.sent){e.next=11;break}return e.next=9,n.close();case 9:return r._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(i)),e.abrupt("return",Promise.resolve(new Set));case 11:return r._updateProgress(Ts(i)),a=new Es(i,t.localStore,n.wt),e.next=15,n.fc();case 15:u=e.sent;case 16:if(!u){e.next=26;break}return e.next=19,a.Nu(u);case 19:return(o=e.sent)&&r._updateProgress(o),e.next=23,n.fc();case 23:u=e.sent;case 24:e.next=16;break;case 26:return e.next=28,a.complete();case 28:return s=e.sent,e.next=31,ic(t,s.Mu,void 0);case 31:return e.next=33,function(e,t){var n=H(e);return n.persistence.runTransaction("Save bundle","readwrite",function(e){return n.Ds.saveBundleMetadata(e,t)})}(t.localStore,i);case 33:return r._completeWith(s.progress),e.abrupt("return",Promise.resolve(s.Ou));case 37:return e.prev=37,e.t0=e.catch(0),e.abrupt("return",(G("SyncEngine","Loading bundle failed with ".concat(e.t0)),r._failWith(e.t0),Promise.resolve(new Set)));case 40:case"end":return e.stop()}},e,null,[[0,37]])})),function(e,t,n){return r.apply(this,arguments)})(i,t,n).then(function(e){i.sharedClientState.notifyBundleLoaded(e)})}var _c=function(){function e(){L(this,e),this.synchronizeTabs=!1}return M(e,[{key:"initialize",value:function(){var e=g(p().mark(function e(t){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.wt=fo(t.databaseInfo.databaseId),this.sharedClientState=this.dc(t),this.persistence=this._c(t),e.next=5,this.persistence.start();case 5:this.localStore=this.wc(t),this.gcScheduler=this.mc(t,this.localStore),this.indexBackfillerScheduler=this.gc(t,this.localStore);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mc",value:function(e,t){return null}},{key:"gc",value:function(e,t){return null}},{key:"wc",value:function(e){return Au(this.persistence,new Du,e.initialUser,this.wt)}},{key:"_c",value:function(e){return new pu(gu.Ms,this.wt)}},{key:"dc",value:function(e){return new ro}},{key:"terminate",value:function(){var e=g(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.gcScheduler&&this.gcScheduler.stop(),e.next=3,this.sharedClientState.shutdown();case 3:return e.next=5,this.persistence.shutdown();case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),Ac=function(e){k(n,_c);var t=x(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this)).yc=e,a.cacheSizeBytes=r,a.forceOwnership=i,a.synchronizeTabs=!1,a}return M(n,[{key:"initialize",value:function(){var e=g(p().mark(function e(t){var r=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s(T(n.prototype),"initialize",this).call(this,t);case 2:return e.next=4,this.yc.initialize(this,t);case 4:return e.next=6,Sc(this.yc.syncEngine);case 6:return e.next=8,Bo(this.yc.remoteStore);case 8:return e.next=10,this.persistence.ci(function(){return r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()});case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"wc",value:function(e){return Au(this.persistence,new Du,e.initialUser,this.wt)}},{key:"mc",value:function(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new Wa(n,e.asyncQueue,t)}},{key:"gc",value:function(e,t){var n=new Ge(t,this.persistence);return new Ke(e.asyncQueue,n)}},{key:"_c",value:function(e){var t=Tu(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?La.withCacheSize(this.cacheSizeBytes):La.DEFAULT;return new bu(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,co(),lo(),this.wt,this.sharedClientState,!!this.forceOwnership)}},{key:"dc",value:function(e){return new ro}}]),n}(),Nc=function(e){k(n,Ac);var t=x(n);function n(e,r){var i;return L(this,n),(i=t.call(this,e,r,!1)).yc=e,i.cacheSizeBytes=r,i.synchronizeTabs=!0,i}return M(n,[{key:"initialize",value:function(){var e=g(p().mark(function e(t){var r,i=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s(T(n.prototype),"initialize",this).call(this,t);case 2:if(r=this.yc.syncEngine,e.t0=this.sharedClientState instanceof no,!e.t0){e.next=8;break}return this.sharedClientState.syncEngine={kr:dc.bind(null,r),Or:xc.bind(null,r),Mr:Ic.bind(null,r),Ri:wc.bind(null,r),Nr:fc.bind(null,r)},e.next=8,this.sharedClientState.start();case 8:return e.next=10,this.persistence.ci(function(){var e=g(p().mark(function e(t){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yc(i.yc.syncEngine,t);case 2:i.gcScheduler&&(t&&!i.gcScheduler.started?i.gcScheduler.start():t||i.gcScheduler.stop()),i.indexBackfillerScheduler&&(t&&!i.indexBackfillerScheduler.started?i.indexBackfillerScheduler.start():t||i.indexBackfillerScheduler.stop());case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"dc",value:function(e){var t=co();if(!no.V(t))throw new J(Y.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Tu(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new no(t,e.asyncQueue,n,e.clientId,e.initialUser)}}]),n}(),Cc=function(){function e(){L(this,e)}return M(e,[{key:"initialize",value:function(){var e=g(p().mark(function e(t,n){var r=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.localStore,e.t0){e.next=12;break}return this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return Ks(r.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=uc.bind(null,this.syncEngine),e.next=12,rs(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"createEventManager",value:function(e){return new ds}},{key:"createDatastore",value:function(e){var t,n=fo(e.databaseInfo.databaseId),r=(t=e.databaseInfo,new so(t));return function(e,t,n,r){return new mo(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,r,n)}},{key:"createRemoteStore",value:function(e){var t,n,r,i,a,u=this;return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=function(e){return Ks(u.syncEngine,e,0)},a=ao.V()?new ao:new io,new ko(t,n,r,i,a)}},{key:"createSyncEngine",value:function(e,t){return function(e,t,n,r,i,a,u){var o=new Cs(e,t,n,r,i,a);return u&&(o.ac=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}},{key:"terminate",value:function(){return(e=g(p().mark(function e(t){var n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=H(t),B("RemoteStore","RemoteStore shutting down."),n.lu.add(5),e.next=5,bo(n);case 5:n.du.shutdown(),n._u.set("Unknown");case 7:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}]),e}();function Lc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10240,n=0;return{read:function(){return g(p().mark(function r(){var i;return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n<e.byteLength)){r.next=3;break}return i={value:e.slice(n,n+t),done:!1},r.abrupt("return",(n+=t,i));case 3:return r.abrupt("return",{done:!0});case 4:case"end":return r.stop()}},r)}))()},cancel:function(){return g(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))()},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var Vc=function(){function e(t){L(this,e),this.observer=t,this.muted=!1}return M(e,[{key:"next",value:function(e){this.observer.next&&this.Ic(this.observer.next,e)}},{key:"error",value:function(e){this.observer.error?this.Ic(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}},{key:"Tc",value:function(){this.muted=!0}},{key:"Ic",value:function(e,t){var n=this;this.muted||setTimeout(function(){n.muted||e(t)},0)}}]),e}(),Mc=function(){function e(t,n){var r=this;L(this,e),this.Ec=t,this.wt=n,this.metadata=new X,this.buffer=new Uint8Array,this.Ac=new TextDecoder("utf-8"),this.Rc().then(function(e){e&&e.Cu()?r.metadata.resolve(e.payload.metadata):r.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             ".concat(JSON.stringify(null==e?void 0:e.payload))))},function(e){return r.metadata.reject(e)})}return M(e,[{key:"close",value:function(){return this.Ec.cancel()}},{key:"getMetadata",value:function(){var e=g(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.metadata.promise);case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fc",value:function(){var e=g(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadata();case 2:return e.abrupt("return",this.Rc());case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"Rc",value:function(){var e=g(p().mark(function e(){var t,n,r,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bc();case 2:if(null!==(t=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:return n=this.Ac.decode(t),r=Number(n),isNaN(r)&&this.Pc("length string (".concat(n,") is not valid number")),e.next=9,this.vc(r);case 9:return i=e.sent,e.abrupt("return",new bs(JSON.parse(i),t.length+r));case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"Vc",value:function(){return this.buffer.findIndex(function(e){return e==="{".charCodeAt(0)})}},{key:"bc",value:function(){var e=g(p().mark(function e(){var t,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.Vc()<0)){e.next=7;break}return e.next=3,this.Sc();case 3:if(!e.sent){e.next=5;break}return e.abrupt("break",7);case 5:e.next=0;break;case 7:if(0!==this.buffer.length){e.next=9;break}return e.abrupt("return",null);case 9:return(t=this.Vc())<0&&this.Pc("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,t),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"vc",value:function(){var e=g(p().mark(function e(t){var n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.buffer.length<t)){e.next=8;break}return e.next=3,this.Sc();case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}this.Pc("Reached the end of bundle when more is expected.");case 6:e.next=0;break;case 8:return n=this.Ac.decode(this.buffer.slice(0,t)),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"Pc",value:function(e){throw this.Ec.cancel(),new Error("Invalid bundle format: ".concat(e))}},{key:"Sc",value:function(){var e=g(p().mark(function e(){var t,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Ec.read();case 2:return(t=e.sent).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),e.abrupt("return",t.done);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),Rc=function(){function e(t){L(this,e),this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return M(e,[{key:"lookup",value:function(){var e=g(p().mark(function e(t){var n,r=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!(this.mutations.length>0)){e.next=2;break}throw new J(Y.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");case 2:return e.next=4,function(){var e=g(p().mark(function e(t,n){var r,i,a,u,o,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=H(t),i=Qr(r.wt)+"/documents",a={documents:n.map(function(e){return Kr(r.wt,e)})},e.next=5,r.ao("BatchGetDocuments",i,a);case 5:return u=e.sent,o=new Map,u.forEach(function(e){var t=Jr(r.wt,e);o.set(t.key.toString(),t)}),s=[],e.abrupt("return",(n.forEach(function(e){var t=o.get(e.toString());Q(!!t),s.push(t)}),s));case 10:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,t);case 4:return n=e.sent,e.abrupt("return",(n.forEach(function(e){return r.recordVersion(e)}),n));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"update",value:function(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}},{key:"delete",value:function(e){this.write(new ar(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"commit",value:function(){var e=g(p().mark(function e(){var t,n=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!this.lastWriteError){e.next=2;break}throw this.lastWriteError;case 2:return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(e,t){var r=ge.fromPath(t);n.mutations.push(new ur(r,n.precondition(r)))}),e.next=7,function(){var e=g(p().mark(function e(t,n){var r,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=H(t),i=Qr(r.wt)+"/documents",a={writes:n.map(function(e){return $r(r.wt,e)})},e.next=3,r.ro("Commit",i,a);case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,this.mutations);case 7:this.committed=!0;case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"recordVersion",value:function(e){var t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw z();t=de.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new J(Y.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}},{key:"precondition",value:function(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?jn.updateTime(t):jn.none()}},{key:"preconditionForUpdate",value:function(e){var t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(de.min()))throw new J(Y.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return jn.updateTime(t)}return jn.exists(!0)}},{key:"write",value:function(e){this.ensureCommitNotCalled(),this.mutations.push(e)}},{key:"ensureCommitNotCalled",value:function(){}}]),e}(),Oc=function(){function e(t,n,r,i,a){L(this,e),this.asyncQueue=t,this.datastore=n,this.options=r,this.updateFunction=i,this.deferred=a,this.Dc=r.maxAttempts,this.So=new ho(this.asyncQueue,"transaction_retry")}return M(e,[{key:"run",value:function(){this.Dc-=1,this.Cc()}},{key:"Cc",value:function(){var e=this;this.So.Io(g(p().mark(function t(){var n,r;return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=new Rc(e.datastore),(r=e.xc(n))&&r.then(function(t){e.asyncQueue.enqueueAndForget(function(){return n.commit().then(function(){e.deferred.resolve(t)}).catch(function(t){e.Nc(t)})})}).catch(function(t){e.Nc(t)});case 2:case"end":return t.stop()}},t)})))}},{key:"xc",value:function(e){try{var t=this.updateFunction(e);return!ht(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}},{key:"Nc",value:function(e){var t=this;this.Dc>0&&this.kc(e)?(this.Dc-=1,this.asyncQueue.enqueueAndForget(function(){return t.Cc(),Promise.resolve()})):this.deferred.reject(e)}},{key:"kc",value:function(e){if("FirebaseError"===e.name){var t=e.code;return"aborted"===t||"failed-precondition"===t||!sr(t)}return!1}}]),e}(),Fc=function(){function e(t,n,r,i){var a=this;L(this,e),this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=O.UNAUTHENTICATED,this.clientId=se.I(),this.authCredentialListener=function(){return Promise.resolve()},this.appCheckCredentialListener=function(){return Promise.resolve()},this.authCredentials.start(r,function(){var e=g(p().mark(function e(t){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return B("FirestoreClient","Received user=",t.uid),e.next=3,a.authCredentialListener(t);case 3:a.user=t;case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(r,function(e){return B("FirestoreClient","Received new app check token=",e),a.appCheckCredentialListener(e,a.user)})}return M(e,[{key:"getConfiguration",value:function(){var e=g(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100});case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setCredentialChangeListener",value:function(e){this.authCredentialListener=e}},{key:"setAppCheckTokenChangeListener",value:function(e){this.appCheckCredentialListener=e}},{key:"verifyNotTerminated",value:function(){if(this.asyncQueue.isShuttingDown)throw new J(Y.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new X;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(g(p().mark(function n(){var r;return p().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=e.onlineComponents,!n.t0){n.next=5;break}return n.next=5,e.onlineComponents.terminate();case 5:if(n.t1=e.offlineComponents,!n.t1){n.next=9;break}return n.next=9,e.offlineComponents.terminate();case 9:e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve(),n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),r=ss(n.t2,"Failed to shutdown persistence"),t.reject(r);case 18:case"end":return n.stop()}},n,null,[[0,14]])}))),t.promise}}]),e}();function Pc(e,t){return qc.apply(this,arguments)}function qc(){return(qc=g(p().mark(function e(t,n){var r,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),B("FirestoreClient","Initializing OfflineComponentProvider"),e.next=3,t.getConfiguration();case 3:return r=e.sent,e.next=6,n.initialize(r);case 6:i=r.initialUser,t.setCredentialChangeListener(function(){var e=g(p().mark(function e(t){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.isEqual(t),e.t0){e.next=5;break}return e.next=4,Nu(n.localStore,t);case 4:i=t;case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=n;case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Uc(e,t){return Bc.apply(this,arguments)}function Bc(){return(Bc=g(p().mark(function e(t,n){var r,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),e.next=3,Kc(t);case 3:return r=e.sent,B("FirestoreClient","Initializing OnlineComponentProvider"),e.next=7,t.getConfiguration();case 7:return i=e.sent,e.next=10,n.initialize(r,i);case 10:t.setCredentialChangeListener(function(e){return ts(n.remoteStore,e)}),t.setAppCheckTokenChangeListener(function(e,t){return ts(n.remoteStore,t)}),t.onlineComponents=n;case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Kc(e){return Gc.apply(this,arguments)}function Gc(){return(Gc=g(p().mark(function e(t){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.offlineComponents,e.t0){e.next=5;break}return B("FirestoreClient","Using default OfflineComponentProvider"),e.next=5,Pc(t,new _c);case 5:return e.abrupt("return",t.offlineComponents);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function jc(e){return zc.apply(this,arguments)}function zc(){return(zc=g(p().mark(function e(t){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.onlineComponents,e.t0){e.next=5;break}return B("FirestoreClient","Using default OnlineComponentProvider"),e.next=5,Uc(t,new Cc);case 5:return e.abrupt("return",t.onlineComponents);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Qc(e){return Kc(e).then(function(e){return e.persistence})}function Wc(e){return Kc(e).then(function(e){return e.localStore})}function Hc(e){return jc(e).then(function(e){return e.remoteStore})}function Yc(e){return jc(e).then(function(e){return e.syncEngine})}function Jc(e){return Xc.apply(this,arguments)}function Xc(){return(Xc=g(p().mark(function e(t){var n,r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jc(t);case 2:return n=e.sent,r=n.eventManager,e.abrupt("return",(r.onListen=Ls.bind(null,n.syncEngine),r.onUnlisten=Os.bind(null,n.syncEngine),r));case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function $c(e){return e.asyncQueue.enqueue(g(p().mark(function t(){var n,r;return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Qc(e);case 2:return n=t.sent,t.next=5,Hc(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!0),function(e){var t=H(r);return t.lu.delete(0),wo(t)}()));case 7:case"end":return t.stop()}},t)})))}function Zc(e){return e.asyncQueue.enqueue(g(p().mark(function t(){var n,r;return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Qc(e);case 2:return n=t.sent,t.next=5,Hc(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!1),function(){var e=g(p().mark(function e(t){var n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=H(t)).lu.add(0),e.next=4,bo(n);case 4:n._u.set("Offline");case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()(r)));case 7:case"end":return t.stop()}},t)})))}function el(e,t){var n=new X;return e.asyncQueue.enqueueAndForget(g(p().mark(function r(){return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=g(p().mark(function e(t,n,r){var i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,function(e,t){var n=H(e);return n.persistence.runTransaction("read document","readonly",function(e){return n.localDocuments.getDocument(e,t)})}(t,n);case 3:(i=e.sent).isFoundDocument()?r.resolve(i):i.isNoDocument()?r.resolve(null):r.reject(new J(Y.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),a=ss(e.t0,"Failed to get document '".concat(n," from cache")),r.reject(a);case 11:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Wc(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}},r)}))),n.promise}function tl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new X;return e.asyncQueue.enqueueAndForget(g(p().mark(function i(){return p().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new Vc({next:function(a){t.enqueueAndForget(function(){return ps(e,u)});var o=a.docs.has(n);!o&&a.fromCache?i.reject(new J(Y.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&a.fromCache&&r&&"server"===r.source?i.reject(new J(Y.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:function(e){return i.reject(e)}}),u=new xs(fn(n.path),a,{includeMetadataChanges:!0,Du:!0});return vs(e,u)},i.next=3,Jc(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}},i)}))),r.promise}function nl(e,t){var n=new X;return e.asyncQueue.enqueueAndForget(g(p().mark(function r(){return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=g(p().mark(function e(t,n,r){var i,a,u,o,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Uu(t,n,!0);case 3:i=e.sent,a=new _s(n,i.ji),u=a.Ku(i.documents),o=a.applyChanges(u,!1),r.resolve(o.snapshot),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),s=ss(e.t0,"Failed to execute query '".concat(n," against cache")),r.reject(s);case 14:case"end":return e.stop()}},e,null,[[0,10]])}));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Wc(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}},r)}))),n.promise}function rl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new X;return e.asyncQueue.enqueueAndForget(g(p().mark(function i(){return p().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new Vc({next:function(n){t.enqueueAndForget(function(){return ps(e,u)}),n.fromCache&&"server"===r.source?i.reject(new J(Y.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(e){return i.reject(e)}}),u=new xs(n,a,{includeMetadataChanges:!0,Du:!0});return vs(e,u)},i.next=3,Jc(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}},i)}))),r.promise}function il(e,t){var n=new Vc(t);return e.asyncQueue.enqueueAndForget(g(p().mark(function t(){return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){H(e).Tu.add(t),t.next()},t.next=3,Jc(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}},t)}))),function(){n.Tc(),e.asyncQueue.enqueueAndForget(g(p().mark(function t(){return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){H(e).Tu.delete(t)},t.next=3,Jc(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}},t)})))}}function al(e,t,n){var r=new X;return e.asyncQueue.enqueueAndForget(g(p().mark(function i(){var a;return p().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,function(e){return jc(e).then(function(e){return e.datastore})}(e);case 2:a=i.sent,new Oc(e.asyncQueue,a,n,t,r).run();case 4:case"end":return i.stop()}},i)}))),r.promise}function ul(e,t,n,r){var i=function(e,t){return function(e,t){return new Mc(e,t)}(function(e,t){if(e instanceof Uint8Array)return Lc(e,t);if(e instanceof ArrayBuffer)return Lc(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),t)}(n,fo(t));e.asyncQueue.enqueueAndForget(g(p().mark(function t(){return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Dc,t.next=3,Yc(e);case 3:t.t1=t.sent,t.t2=i,t.t3=r,(0,t.t0)(t.t1,t.t2,t.t3);case 7:case"end":return t.stop()}},t)})))}function ol(e,t){return e.asyncQueue.enqueue(g(p().mark(function n(){return p().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=function(e,t){var n=H(e);return n.persistence.runTransaction("Get named query","readonly",function(e){return n.Ds.getNamedQuery(e,t)})},n.next=3,Wc(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}},n)})))}var sl=new Map;function cl(e,t,n){if(!n)throw new J(Y.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function ll(e,t,n,r){if(!0===t&&!0===r)throw new J(Y.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))}function fl(e){if(!ge.isDocumentKey(e))throw new J(Y.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function hl(e){if(ge.isDocumentKey(e))throw new J(Y.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function dl(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==v(e)){if(e instanceof Array)return"an array";var t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}return"function"==typeof e?"a function":z()}function vl(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new J(Y.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=dl(e);throw new J(Y.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}return e}function yl(e,t){if(t<=0)throw new J(Y.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}var pl=function(){function e(t){var n;if(L(this,e),void 0===t.host){if(void 0!==t.ssl)throw new J(Y.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(n=t.ssl)||void 0===n||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new J(Y.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,ll("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return M(e,[{key:"isEqual",value:function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]),e}(),ml=function(){function e(t,n,r){L(this,e),this._authCredentials=n,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new pl({}),this._settingsFrozen=!1,t instanceof ft?this._databaseId=t:(this._app=t,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new J(Y.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ft(e.options.projectId)}(t))}return M(e,[{key:"app",get:function(){if(!this._app)throw new J(Y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return void 0!==this._terminateTask}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new J(Y.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new pl(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Z;switch(e.type){case"gapi":var t=e.client;return Q(!("object"!=v(t)||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new re(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new J(Y.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return e=this,(t=sl.get(e))&&(B("ComponentProvider","Removing Datastore"),sl.delete(e),t.terminate()),Promise.resolve();var e,t}}]),e}();function gl(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=(e=vl(e,ml))._getSettings();if("firestore.googleapis.com"!==u.host&&u.host!==t&&G("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},u),{host:"".concat(t,":").concat(n),ssl:!1})),i.mockUserToken){var o,s;if("string"==typeof i.mockUserToken)o=i.mockUserToken,s=O.MOCK_USER;else{o=(0,a.createMockUserToken)(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);var c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new J(Y.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");s=new O(c)}e._authCredentials=new ee(new $(o,s))}}var kl=function(){function e(t,n,r){L(this,e),this.converter=n,this._key=r,this.type="document",this.firestore=t}return M(e,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new xl(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(t){return new e(this.firestore,t,this._key)}}]),e}();exports.DocumentReference=kl;var wl=function(){function e(t,n,r){L(this,e),this.converter=n,this._query=r,this.type="query",this.firestore=t}return M(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._query)}}]),e}();exports.Query=wl;var xl=function(e){k(n,wl);var t=x(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this,e,r,fn(i)))._path=i,a.type="collection",a}return M(n,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new kl(this.firestore,null,new ge(e))}},{key:"withConverter",value:function(e){return new n(this.firestore,e,this._path)}}]),n}();function bl(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,a.getModularInstance)(e),cl("collection","path",t),e instanceof ml){var u=ye.fromString.apply(ye,[t].concat(r));return hl(u),new xl(e,null,u)}if(!(e instanceof kl||e instanceof xl))throw new J(Y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(ye.fromString.apply(ye,[t].concat(r)));return hl(o),new xl(e.firestore,null,o)}function Il(e,t){if(e=vl(e,ml),cl("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new J(Y.INVALID_ARGUMENT,"Invalid collection ID '".concat(t,"' passed to function collectionGroup(). Collection IDs must not contain '/'."));return new wl(e,null,function(e){return new cn(ye.emptyPath(),e)}(t))}function El(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,a.getModularInstance)(e),1===arguments.length&&(t=se.I()),cl("doc","path",t),e instanceof ml){var u=ye.fromString.apply(ye,[t].concat(r));return fl(u),new kl(e,null,new ge(u))}if(!(e instanceof kl||e instanceof xl))throw new J(Y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(ye.fromString.apply(ye,[t].concat(r)));return fl(o),new kl(e.firestore,e instanceof xl?e.converter:null,new ge(o))}function Tl(e,t){return e=(0,a.getModularInstance)(e),t=(0,a.getModularInstance)(t),(e instanceof kl||e instanceof xl)&&(t instanceof kl||t instanceof xl)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Sl(e,t){return e=(0,a.getModularInstance)(e),t=(0,a.getModularInstance)(t),e instanceof wl&&t instanceof wl&&e.firestore===t.firestore&&kn(e._query,t._query)&&e.converter===t.converter}exports.CollectionReference=xl;var Dl=function(){function e(){var t=this;L(this,e),this.Oc=Promise.resolve(),this.Mc=[],this.Fc=!1,this.$c=[],this.Bc=null,this.Lc=!1,this.Uc=!1,this.qc=[],this.So=new ho(this,"async_queue_retry"),this.Kc=function(){var e=lo();e&&B("AsyncQueue","Visibility state changed to "+e.visibilityState),t.So.Eo()};var n=lo();n&&"function"==typeof n.addEventListener&&n.addEventListener("visibilitychange",this.Kc)}return M(e,[{key:"isShuttingDown",get:function(){return this.Fc}},{key:"enqueueAndForget",value:function(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(e){this.Gc(),this.Qc(e)}},{key:"enterRestrictedMode",value:function(e){if(!this.Fc){this.Fc=!0,this.Uc=e||!1;var t=lo();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Kc)}}},{key:"enqueue",value:function(e){var t=this;if(this.Gc(),this.Fc)return new Promise(function(){});var n=new X;return this.Qc(function(){return t.Fc&&t.Uc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})}},{key:"enqueueRetryable",value:function(e){var t=this;this.enqueueAndForget(function(){return t.Mc.push(e),t.jc()})}},{key:"jc",value:function(){var e=g(p().mark(function e(){var t=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.Mc.length){e.next=14;break}return e.prev=1,e.next=4,this.Mc[0]();case 4:this.Mc.shift(),this.So.reset(),e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),Fe(e.t0)){e.next=12;break}throw e.t0;case 12:B("AsyncQueue","Operation failed with retryable error: "+e.t0);case 13:this.Mc.length>0&&this.So.Io(function(){return t.jc()});case 14:case"end":return e.stop()}},e,this,[[1,8]])}));return function(){return e.apply(this,arguments)}}()},{key:"Qc",value:function(e){var t=this,n=this.Oc.then(function(){return t.Lc=!0,e().catch(function(e){throw t.Bc=e,t.Lc=!1,K("INTERNAL UNHANDLED ERROR: ",function(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(function(e){return t.Lc=!1,e})});return this.Oc=n,n}},{key:"enqueueAfterDelay",value:function(e,t,n){var r=this;this.Gc(),this.qc.indexOf(e)>-1&&(t=0);var i=os.createAndSchedule(this,e,t,n,function(e){return r.Wc(e)});return this.$c.push(i),i}},{key:"Gc",value:function(){this.Bc&&z()}},{key:"verifyOperationInProgress",value:function(){}},{key:"zc",value:function(){var e=g(p().mark(function e(){var t;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.Oc,e.next=3,t;case 3:if(t!==this.Oc){e.next=0;break}case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"Hc",value:function(e){var t,n=y(this.$c);try{for(n.s();!(t=n.n()).done;){if(t.value.timerId===e)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"Jc",value:function(e){var t=this;return this.zc().then(function(){t.$c.sort(function(e,t){return e.targetTimeMs-t.targetTimeMs});var n,r=y(t.$c);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),"all"!==e&&i.timerId===e)break}}catch(a){r.e(a)}finally{r.f()}return t.zc()})}},{key:"Yc",value:function(e){this.qc.push(e)}},{key:"Wc",value:function(e){var t=this.$c.indexOf(e);this.$c.splice(t,1)}}]),e}();function _l(e){return function(e,t){if("object"!=v(e)||null===e)return!1;var n,r=e,i=y(["next","error","complete"]);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in r&&"function"==typeof r[a])return!0}}catch(u){i.e(u)}finally{i.f()}return!1}(e)}var Al=function(){function e(){L(this,e),this._progressObserver={},this._taskCompletionResolver=new X,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return M(e,[{key:"onProgress",value:function(e,t,n){this._progressObserver={next:e,error:t,complete:n}}},{key:"catch",value:function(e){return this._taskCompletionResolver.promise.catch(e)}},{key:"then",value:function(e,t){return this._taskCompletionResolver.promise.then(e,t)}},{key:"_completeWith",value:function(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}},{key:"_failWith",value:function(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}},{key:"_updateProgress",value:function(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}]),e}();exports.LoadBundleTask=Al;var Nl=-1;exports.CACHE_SIZE_UNLIMITED=Nl;var Cl=function(e){k(n,ml);var t=x(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this,e,r,i)).type="firestore",a._queue=new Dl,a._persistenceKey="name"in e?e.name:"[DEFAULT]",a}return M(n,[{key:"_terminate",value:function(){return this._firestoreClient||Rl(this),this._firestoreClient.terminate()}}]),n}();function Ll(e,t){var r=(0,n._getProvider)(e,"firestore");if(r.isInitialized()){var i=r.getImmediate(),u=r.getOptions();if((0,a.deepEqual)(u,t))return i;throw new J(Y.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new J(Y.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:t})}function Vl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.getApp)();return(0,n._getProvider)(e,"firestore").getImmediate()}function Ml(e){return e._firestoreClient||Rl(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Rl(e){var t,n=e._freezeSettings(),r=function(e,t,n,r){return new lt(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Fc(e._authCredentials,e._appCheckCredentials,e._queue,r)}function Ol(e,t){Ql(e=vl(e,Cl));var n=Ml(e),r=e._freezeSettings(),i=new Cc;return Pl(n,i,new Ac(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function Fl(e){Ql(e=vl(e,Cl));var t=Ml(e),n=e._freezeSettings(),r=new Cc;return Pl(t,r,new Nc(r,n.cacheSizeBytes))}function Pl(e,t,n){var r=new X;return e.asyncQueue.enqueue(g(p().mark(function i(){return p().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,Pc(e,n);case 3:return i.next=5,Uc(e,t);case 5:r.resolve(),i.next=13;break;case 8:if(i.prev=8,i.t0=i.catch(0),function(e){return"FirebaseError"===e.name?e.code===Y.FAILED_PRECONDITION||e.code===Y.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)}(i.t0)){i.next=12;break}throw i.t0;case 12:console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+i.t0),r.reject(i.t0);case 13:case"end":return i.stop()}},i,null,[[0,8]])}))).then(function(){return r.promise})}function ql(e){if(e._initialized&&!e._terminated)throw new J(Y.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var t=new X;return e._queue.enqueueAndForgetEvenWhileRestricted(g(p().mark(function n(){return p().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,function(){var e=g(p().mark(function e(t){var n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Me.V()){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return n=t+"main",e.next=5,Me.delete(n);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()(Tu(e._databaseId,e._persistenceKey));case 3:t.resolve(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t.reject(n.t0);case 9:case"end":return n.stop()}},n,null,[[0,6]])}))),t.promise}function Ul(e){return function(e){var t=new X;return e.asyncQueue.enqueueAndForget(g(p().mark(function n(){return p().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=Ys,n.next=3,Yc(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}},n)}))),t.promise}(Ml(e=vl(e,Cl)))}function Bl(e){return $c(Ml(e=vl(e,Cl)))}function Kl(e){return Zc(Ml(e=vl(e,Cl)))}function Gl(e){return(0,n._removeServiceInstance)(e.app,"firestore"),e._delete()}function jl(e,t){var n=Ml(e=vl(e,Cl)),r=new Al;return ul(n,e._databaseId,t,r),r}function zl(e,t){return ol(Ml(e=vl(e,Cl)),t).then(function(t){return t?new wl(e,null,t.query):null})}function Ql(e){if(e._initialized||e._terminated)throw new J(Y.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}exports.Firestore=Cl;var Wl=function(){function e(){L(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;++i)if(0===n[i].length)throw new J(Y.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new me(n)}return M(e,[{key:"isEqual",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}();function Hl(){return new Wl("__name__")}exports.FieldPath=Wl;var Yl=function(){function e(t){L(this,e),this._byteString=t}return M(e,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(t){try{return new e(nt.fromBase64String(t))}catch(t){throw new J(Y.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}},{key:"fromUint8Array",value:function(t){return new e(nt.fromUint8Array(t))}}]),e}();exports.Bytes=Yl;var Jl=M(function e(t){L(this,e),this._methodName=t});exports.FieldValue=Jl;var Xl=function(){function e(t,n){if(L(this,e),!isFinite(t)||t<-90||t>90)throw new J(Y.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new J(Y.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return M(e,[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(e){return ce(this._lat,e._lat)||ce(this._long,e._long)}}]),e}();exports.GeoPoint=Xl;var $l=/^__.*__$/,Zl=function(){function e(t,n,r){L(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return M(e,[{key:"toMutation",value:function(e,t){return null!==this.fieldMask?new Zn(e,this.data,this.fieldMask,t,this.fieldTransforms):new $n(e,this.data,t,this.fieldTransforms)}}]),e}(),ef=function(){function e(t,n,r){L(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return M(e,[{key:"toMutation",value:function(e,t){return new Zn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]),e}();function tf(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw z()}}var nf=function(){function e(t,n,r,i,a,u){L(this,e),this.settings=t,this.databaseId=n,this.wt=r,this.ignoreUndefinedProperties=i,void 0===a&&this.Xc(),this.fieldTransforms=a||[],this.fieldMask=u||[]}return M(e,[{key:"path",get:function(){return this.settings.path}},{key:"Zc",get:function(){return this.settings.Zc}},{key:"ta",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.wt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"ea",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ta({path:n,na:!1});return r.sa(e),r}},{key:"ia",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ta({path:n,na:!1});return r.Xc(),r}},{key:"ra",value:function(e){return this.ta({path:void 0,na:!0})}},{key:"oa",value:function(e){return If(e,this.settings.methodName,this.settings.ua||!1,this.path,this.settings.ca)}},{key:"contains",value:function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})}},{key:"Xc",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.sa(this.path.get(e))}},{key:"sa",value:function(e){if(0===e.length)throw this.oa("Document fields must not be empty");if(tf(this.Zc)&&$l.test(e))throw this.oa('Document fields cannot begin and end with "__"')}}]),e}(),rf=function(){function e(t,n,r){L(this,e),this.databaseId=t,this.ignoreUndefinedProperties=n,this.wt=r||fo(t)}return M(e,[{key:"aa",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new nf({Zc:e,methodName:t,ca:n,path:me.emptyPath(),na:!1,ua:r},this.databaseId,this.wt,this.ignoreUndefinedProperties)}}]),e}();function af(e){var t=e._freezeSettings(),n=fo(e._databaseId);return new rf(e._databaseId,!!t.ignoreUndefinedProperties,n)}function uf(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},u=e.aa(a.merge||a.mergeFields?2:0,t,n,i);kf("Data must be an object, but it was:",u,r);var o,s,c=mf(r,u);if(a.merge)o=new et(u.fieldMask),s=u.fieldTransforms;else if(a.mergeFields){var l,f=[],h=y(a.mergeFields);try{for(h.s();!(l=h.n()).done;){var d=wf(t,l.value,n);if(!u.contains(d))throw new J(Y.INVALID_ARGUMENT,"Field '".concat(d,"' is specified in your field mask but missing from your input data."));Ef(f,d)||f.push(d)}}catch(v){h.e(v)}finally{h.f()}o=new et(f),s=u.fieldTransforms.filter(function(e){return o.covers(e.field)})}else o=null,s=u.fieldTransforms;return new Zl(new Ot(c),o,s)}var of=function(e){k(n,Jl);var t=x(n);function n(){return L(this,n),t.apply(this,arguments)}return M(n,[{key:"_toFieldTransform",value:function(e){if(2!==e.Zc)throw 1===e.Zc?e.oa("".concat(this._methodName,"() can only appear at the top level of your update data")):e.oa("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}();function sf(e,t,n){return new nf({Zc:3,ca:t.settings.ca,methodName:e._methodName,na:n},t.databaseId,t.wt,t.ignoreUndefinedProperties)}var cf=function(e){k(n,Jl);var t=x(n);function n(){return L(this,n),t.apply(this,arguments)}return M(n,[{key:"_toFieldTransform",value:function(e){return new Bn(e.path,new Vn)}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(),lf=function(e){k(n,Jl);var t=x(n);function n(e,r){var i;return L(this,n),(i=t.call(this,e)).ha=r,i}return M(n,[{key:"_toFieldTransform",value:function(e){var t=sf(this,e,!0),n=this.ha.map(function(e){return pf(e,t)}),r=new Mn(n);return new Bn(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(),ff=function(e){k(n,Jl);var t=x(n);function n(e,r){var i;return L(this,n),(i=t.call(this,e)).ha=r,i}return M(n,[{key:"_toFieldTransform",value:function(e){var t=sf(this,e,!0),n=this.ha.map(function(e){return pf(e,t)}),r=new On(n);return new Bn(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(),hf=function(e){k(n,Jl);var t=x(n);function n(e,r){var i;return L(this,n),(i=t.call(this,e)).la=r,i}return M(n,[{key:"_toFieldTransform",value:function(e){var t=new Pn(e.wt,_n(e.wt,this.la));return new Bn(e.path,t)}},{key:"isEqual",value:function(e){return this===e}}]),n}();function df(e,t,n,r){var i=e.aa(1,t,n);kf("Data must be an object, but it was:",i,r);var u=[],o=Ot.empty();Qe(r,function(e,r){var s=bf(t,e,n);r=(0,a.getModularInstance)(r);var c=i.ia(s);if(r instanceof of)u.push(s);else{var l=pf(r,c);null!=l&&(u.push(s),o.set(s,l))}});var s=new et(u);return new ef(o,s,i.fieldTransforms)}function vf(e,t,n,r,i,u){var o=e.aa(1,t,n),s=[wf(t,r,n)],c=[i];if(u.length%2!=0)throw new J(Y.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var l=0;l<u.length;l+=2)s.push(wf(t,u[l])),c.push(u[l+1]);for(var f=[],h=Ot.empty(),d=s.length-1;d>=0;--d)if(!Ef(f,s[d])){var v=s[d],y=c[d];y=(0,a.getModularInstance)(y);var p=o.ia(v);if(y instanceof of)f.push(v);else{var m=pf(y,p);null!=m&&(f.push(v),h.set(v,m))}}var g=new et(f);return new ef(h,g,o.fieldTransforms)}function yf(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return pf(n,e.aa(r?4:3,t))}function pf(e,t){if(gf(e=(0,a.getModularInstance)(e)))return kf("Unsupported field value:",t,e),mf(e,t);if(e instanceof Jl)return function(e,t){if(!tf(t.Zc))throw t.oa("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.oa("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.na&&4!==t.Zc)throw t.oa("Nested arrays are not supported");return function(e,t){var n,r=[],i=0,a=y(e);try{for(a.s();!(n=a.n()).done;){var u=pf(n.value,t.ra(i));null==u&&(u={nullValue:"NULL_VALUE"}),r.push(u),i++}}catch(o){a.e(o)}finally{a.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=(0,a.getModularInstance)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return _n(t.wt,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=he.fromDate(e);return{timestampValue:Or(t.wt,n)}}if(e instanceof he){var r=new he(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Or(t.wt,r)}}if(e instanceof Xl)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Yl)return{bytesValue:Fr(t.wt,e._byteString)};if(e instanceof kl){var i=t.databaseId,u=e.firestore._databaseId;if(!u.isEqual(i))throw t.oa("Document reference is for database ".concat(u.projectId,"/").concat(u.database," but should be for database ").concat(i.projectId,"/").concat(i.database));return{referenceValue:Ur(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.oa("Unsupported field value: ".concat(dl(e)))}(e,t)}function mf(e,t){var n={};return We(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Qe(e,function(e,r){var i=pf(r,t.ea(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function gf(e){return!("object"!=v(e)||null===e||e instanceof Array||e instanceof Date||e instanceof he||e instanceof Xl||e instanceof Yl||e instanceof kl||e instanceof Jl)}function kf(e,t,n){if(!gf(n)||!function(e){return"object"==v(e)&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var r=dl(n);throw"an object"===r?t.oa(e+" a custom object"):t.oa(e+" "+r)}}function wf(e,t,n){if((t=(0,a.getModularInstance)(t))instanceof Wl)return t._internalPath;if("string"==typeof t)return bf(e,t);throw If("Field path arguments must be of type string or ",e,!1,void 0,n)}var xf=new RegExp("[~\\*/\\[\\]]");function bf(e,t,n){if(t.search(xf)>=0)throw If("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return o(Wl,S(t.split(".")))._internalPath}catch(r){throw If("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function If(e,t,n,r,i){var a=r&&!r.isEmpty(),u=void 0!==i,o="Function ".concat(t,"() called with invalid data");n&&(o+=" (via `toFirestore()`)"),o+=". ";var s="";return(a||u)&&(s+=" (found",a&&(s+=" in field ".concat(r)),u&&(s+=" in document ".concat(i)),s+=")"),new J(Y.INVALID_ARGUMENT,o+e+s)}function Ef(e,t){return e.some(function(e){return e.isEqual(t)})}var Tf=function(){function e(t,n,r,i,a){L(this,e),this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=a}return M(e,[{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new kl(this._firestore,this._converter,this._key)}},{key:"exists",value:function(){return null!==this._document}},{key:"data",value:function(){if(this._document){if(this._converter){var e=new Sf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(e){if(this._document){var t=this._document.data.field(Df("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]),e}(),Sf=function(e){k(n,Tf);var t=x(n);function n(){return L(this,n),t.apply(this,arguments)}return M(n,[{key:"data",value:function(){return s(T(n.prototype),"data",this).call(this)}}]),n}();function Df(e,t){return"string"==typeof t?bf(e,t):t instanceof Wl?t._internalPath:t._delegate._internalPath}var _f=function(){function e(t,n){L(this,e),this.hasPendingWrites=t,this.fromCache=n}return M(e,[{key:"isEqual",value:function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]),e}();exports.SnapshotMetadata=_f;var Af=function(e){k(n,Tf);var t=x(n);function n(e,r,i,a,u,o){var s;return L(this,n),(s=t.call(this,e,r,i,a,o))._firestore=e,s._firestoreImpl=e,s.metadata=u,s}return M(n,[{key:"exists",value:function(){return s(T(n.prototype),"exists",this).call(this)}},{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var t=new Nf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(Df("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]),n}();exports.DocumentSnapshot=Af;var Nf=function(e){k(n,Af);var t=x(n);function n(){return L(this,n),t.apply(this,arguments)}return M(n,[{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(T(n.prototype),"data",this).call(this,e)}}]),n}();exports.QueryDocumentSnapshot=Nf;var Cf=function(){function e(t,n,r,i){L(this,e),this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new _f(i.hasPendingWrites,i.fromCache),this.query=r}return M(e,[{key:"docs",get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e}},{key:"size",get:function(){return this._snapshot.docs.size}},{key:"empty",get:function(){return 0===this.size}},{key:"forEach",value:function(e,t){var n=this;this._snapshot.docs.forEach(function(r){e.call(t,new Nf(n._firestore,n._userDataWriter,r.key,r,new _f(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})}},{key:"docChanges",value:function(){var e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new J(Y.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map(function(t){return{type:"added",doc:new Nf(e._firestore,e._userDataWriter,t.doc.key,t.doc,new _f(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:n++}})}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(function(e){return t||3!==e.type}).map(function(t){var n=new Nf(e._firestore,e._userDataWriter,t.doc.key,t.doc,new _f(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(a=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:Lf(t.type),doc:n,oldIndex:i,newIndex:a}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}]),e}();function Lf(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return z()}}function Vf(e,t){return e instanceof Af&&t instanceof Af?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Cf&&t instanceof Cf&&e._firestore===t._firestore&&Sl(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function Mf(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new J(Y.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}exports.QuerySnapshot=Cf;var Rf=M(function e(){L(this,e)});function Of(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){e=a[i]._apply(e)}return e}exports.QueryConstraint=Rf;var Ff=function(e){k(n,Rf);var t=x(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this)).fa=e,a.da=r,a._a=i,a.type="where",a}return M(n,[{key:"_apply",value:function(e){var t=af(e.firestore),n=function(e,t,n,r,i,a,u){var o;if(i.isKeyField()){if("array-contains"===a||"array-contains-any"===a)throw new J(Y.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(a,"' queries on documentId()."));if("in"===a||"not-in"===a){$f(u,a);var s,c=[],l=y(u);try{for(l.s();!(s=l.n()).done;){var f=s.value;c.push(Xf(r,e,f))}}catch(d){l.e(d)}finally{l.f()}o={arrayValue:{values:c}}}else o=Xf(r,e,u)}else"in"!==a&&"not-in"!==a&&"array-contains-any"!==a||$f(u,a),o=yf(n,"where",u,"in"===a||"not-in"===a);var h=Ht.create(i,a,o);return function(e,t){if(t.ht()){var n=vn(e);if(null!==n&&!n.isEqual(t.field))throw new J(Y.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '".concat(n.toString(),"' and '").concat(t.field.toString(),"'"));var r=dn(e);null!==r&&Zf(e,t.field,r)}var i=function(e,t){var n,r=y(e.filters);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(t.indexOf(i.op)>=0)return i.op}}catch(d){r.e(d)}finally{r.f()}return null}(e,function(e){switch(t.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==i)throw i===t.op?new J(Y.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new J(Y.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(i.toString(),"' filters."))}(e,h),h}(e._query,0,t,e.firestore._databaseId,this.fa,this.da,this._a);return new wl(e.firestore,e.converter,function(e,t){var n=e.filters.concat([t]);return new cn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}]),n}();function Pf(e,t,n){var r=t,i=Df("where",e);return new Ff(i,r,n)}var qf=function(e){k(n,Rf);var t=x(n);function n(e,r){var i;return L(this,n),(i=t.call(this)).fa=e,i.wa=r,i.type="orderBy",i}return M(n,[{key:"_apply",value:function(e){var t=function(e,t,n){if(null!==e.startAt)throw new J(Y.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new J(Y.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new an(t,n);return function(e,t){if(null===dn(e)){var n=vn(e);null!==n&&Zf(e,n,t.field)}}(e,r),r}(e._query,this.fa,this.wa);return new wl(e.firestore,e.converter,function(e,t){var n=e.explicitOrderBy.concat([t]);return new cn(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}]),n}();function Uf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=Df("orderBy",e);return new qf(n,t)}var Bf=function(e){k(n,Rf);var t=x(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this)).type=e,a.ma=r,a.ga=i,a}return M(n,[{key:"_apply",value:function(e){return new wl(e.firestore,e.converter,gn(e._query,this.ma,this.ga))}}]),n}();function Kf(e){return yl("limit",e),new Bf("limit",e,"F")}function Gf(e){return yl("limitToLast",e),new Bf("limitToLast",e,"L")}var jf=function(e){k(n,Rf);var t=x(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this)).type=e,a.ya=r,a.pa=i,a}return M(n,[{key:"_apply",value:function(e){var t=Jf(e,this.type,this.ya,this.pa);return new wl(e.firestore,e.converter,function(e,t){return new cn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}]),n}();function zf(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new jf("startAt",t,!0)}function Qf(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new jf("startAfter",t,!1)}var Wf=function(e){k(n,Rf);var t=x(n);function n(e,r,i){var a;return L(this,n),(a=t.call(this)).type=e,a.ya=r,a.pa=i,a}return M(n,[{key:"_apply",value:function(e){var t=Jf(e,this.type,this.ya,this.pa);return new wl(e.firestore,e.converter,function(e,t){return new cn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}]),n}();function Hf(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Wf("endBefore",t,!1)}function Yf(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Wf("endAt",t,!0)}function Jf(e,t,n,r){if(n[0]=(0,a.getModularInstance)(n[0]),n[0]instanceof Tf)return function(e,t,n,r,i){if(!r)throw new J(Y.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for ".concat(n,"()."));var a,u=[],o=y(pn(e));try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.field.isKeyField())u.push(Et(t,r.key));else{var c=r.data.field(s.field);if(ot(c))throw new J(Y.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var l=s.field.canonicalString();throw new J(Y.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '".concat(l,"' (used as the orderBy) does not exist."))}u.push(c)}}}catch(f){o.e(f)}finally{o.f()}return new rn(u,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=af(e.firestore);return function(e,t,n,r,i,a){var u=e.explicitOrderBy;if(i.length>u.length)throw new J(Y.INVALID_ARGUMENT,"Too many arguments provided to ".concat(r,"(). The number of arguments must be less than or equal to the number of orderBy() clauses"));for(var o=[],s=0;s<i.length;s++){var c=i[s];if(u[s].field.isKeyField()){if("string"!=typeof c)throw new J(Y.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in ".concat(r,"(), but got a ").concat(v(c)));if(!yn(e)&&-1!==c.indexOf("/"))throw new J(Y.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by documentId(), the value passed to ".concat(r,"() must be a plain document ID, but '").concat(c,"' contains a slash."));var l=e.path.child(ye.fromString(c));if(!ge.isDocumentKey(l))throw new J(Y.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by documentId(), the value passed to ".concat(r,"() must result in a valid document path, but '").concat(l,"' is not because it contains an odd number of segments."));var f=new ge(l);o.push(Et(t,f))}else{var h=yf(n,r,c);o.push(h)}}return new rn(o,a)}(e._query,e.firestore._databaseId,i,t,n,r)}function Xf(e,t,n){if("string"==typeof(n=(0,a.getModularInstance)(n))){if(""===n)throw new J(Y.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!yn(t)&&-1!==n.indexOf("/"))throw new J(Y.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));var r=t.path.child(ye.fromString(n));if(!ge.isDocumentKey(r))throw new J(Y.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return Et(e,new ge(r))}if(n instanceof kl)return Et(e,n._key);throw new J(Y.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(dl(n),"."))}function $f(e,t){if(!Array.isArray(e)||0===e.length)throw new J(Y.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."));if(e.length>10)throw new J(Y.INVALID_ARGUMENT,"Invalid Query. '".concat(t.toString(),"' filters support a maximum of 10 elements in the value array."))}function Zf(e,t,n){if(!n.isEqual(t))throw new J(Y.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '".concat(t.toString(),"' and so you must also use '").concat(t.toString(),"' as your first argument to orderBy(), but your first orderBy() is on field '").concat(n.toString(),"' instead."))}var eh={maxAttempts:5},th=function(){function e(){L(this,e)}return M(e,[{key:"convertValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(mt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return at(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ut(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw z()}}},{key:"convertObject",value:function(e,t){var n=this,r={};return Qe(e.fields,function(e,i){r[e]=n.convertValue(i,t)}),r}},{key:"convertGeoPoint",value:function(e){return new Xl(at(e.latitude),at(e.longitude))}},{key:"convertArray",value:function(e,t){var n=this;return(e.values||[]).map(function(e){return n.convertValue(e,t)})}},{key:"convertServerTimestamp",value:function(e,t){switch(t){case"previous":var n=st(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ct(e));default:return null}}},{key:"convertTimestamp",value:function(e){var t=it(e);return new he(t.seconds,t.nanos)}},{key:"convertDocumentKey",value:function(e,t){var n=ye.fromString(e);Q(di(n));var r=new ft(n.get(1),n.get(3)),i=new ge(n.popFirst(5));return r.isEqual(t)||K("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}]),e}();function nh(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}exports.AbstractUserDataWriter=th;var rh=function(e){k(n,th);var t=x(n);function n(e){var r;return L(this,n),(r=t.call(this)).firestore=e,r}return M(n,[{key:"convertBytes",value:function(e){return new Yl(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new kl(this.firestore,null,t)}}]),n}(),ih=function(){function e(t,n){L(this,e),this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=af(t)}return M(e,[{key:"set",value:function(e,t,n){this._verifyNotCommitted();var r=ah(e,this._firestore),i=nh(r.converter,t,n),a=uf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(a.toMutation(r._key,jn.none())),this}},{key:"update",value:function(e,t,n){this._verifyNotCommitted();for(var r,i=ah(e,this._firestore),u=arguments.length,o=new Array(u>3?u-3:0),s=3;s<u;s++)o[s-3]=arguments[s];return r="string"==typeof(t=(0,a.getModularInstance)(t))||t instanceof Wl?vf(this._dataReader,"WriteBatch.update",i._key,t,n,o):df(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(r.toMutation(i._key,jn.exists(!0))),this}},{key:"delete",value:function(e){this._verifyNotCommitted();var t=ah(e,this._firestore);return this._mutations=this._mutations.concat(new ar(t._key,jn.none())),this}},{key:"commit",value:function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}},{key:"_verifyNotCommitted",value:function(){if(this._committed)throw new J(Y.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}]),e}();function ah(e,t){if((e=(0,a.getModularInstance)(e)).firestore!==t)throw new J(Y.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function uh(e){e=vl(e,kl);var t=vl(e.firestore,Cl);return tl(Ml(t),e._key).then(function(n){return wh(t,e,n)})}exports.WriteBatch=ih;var oh=function(e){k(n,th);var t=x(n);function n(e){var r;return L(this,n),(r=t.call(this)).firestore=e,r}return M(n,[{key:"convertBytes",value:function(e){return new Yl(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new kl(this.firestore,null,t)}}]),n}();function sh(e){e=vl(e,kl);var t=vl(e.firestore,Cl),n=Ml(t),r=new oh(t);return el(n,e._key).then(function(n){return new Af(t,r,e._key,n,new _f(null!==n&&n.hasLocalMutations,!0),e.converter)})}function ch(e){e=vl(e,kl);var t=vl(e.firestore,Cl);return tl(Ml(t),e._key,{source:"server"}).then(function(n){return wh(t,e,n)})}function lh(e){e=vl(e,wl);var t=vl(e.firestore,Cl),n=Ml(t),r=new oh(t);return Mf(e._query),rl(n,e._query).then(function(n){return new Cf(t,r,e,n)})}function fh(e){e=vl(e,wl);var t=vl(e.firestore,Cl),n=Ml(t),r=new oh(t);return nl(n,e._query).then(function(n){return new Cf(t,r,e,n)})}function hh(e){e=vl(e,wl);var t=vl(e.firestore,Cl),n=Ml(t),r=new oh(t);return rl(n,e._query,{source:"server"}).then(function(n){return new Cf(t,r,e,n)})}function dh(e,t,n){e=vl(e,kl);var r=vl(e.firestore,Cl),i=nh(e.converter,t,n);return kh(r,[uf(af(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,jn.none())])}function vh(e,t,n){e=vl(e,kl);for(var r=vl(e.firestore,Cl),i=af(r),u=arguments.length,o=new Array(u>3?u-3:0),s=3;s<u;s++)o[s-3]=arguments[s];return kh(r,[("string"==typeof(t=(0,a.getModularInstance)(t))||t instanceof Wl?vf(i,"updateDoc",e._key,t,n,o):df(i,"updateDoc",e._key,t)).toMutation(e._key,jn.exists(!0))])}function yh(e){return kh(vl(e.firestore,Cl),[new ar(e._key,jn.none())])}function ph(e,t){var n=vl(e.firestore,Cl),r=El(e),i=nh(e.converter,t);return kh(n,[uf(af(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,jn.exists(!1))]).then(function(){return r})}function mh(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,u,o;e=(0,a.getModularInstance)(e);var s={includeMetadataChanges:!1},c=0;"object"!=v(n[c])||_l(n[c])||(s=n[c],c++);var l,f,h,d={includeMetadataChanges:s.includeMetadataChanges};if(_l(n[c])){var y=n[c];n[c]=null===(i=y.next)||void 0===i?void 0:i.bind(y),n[c+1]=null===(u=y.error)||void 0===u?void 0:u.bind(y),n[c+2]=null===(o=y.complete)||void 0===o?void 0:o.bind(y)}if(e instanceof kl)f=vl(e.firestore,Cl),h=fn(e._key.path),l={next:function(t){n[c]&&n[c](wh(f,e,t))},error:n[c+1],complete:n[c+2]};else{var m=vl(e,wl);f=vl(m.firestore,Cl),h=m._query;var k=new oh(f);l={next:function(e){n[c]&&n[c](new Cf(f,k,m,e))},error:n[c+1],complete:n[c+2]},Mf(e._query)}return function(e,t,n,r){var i=new Vc(l),a=new xs(t,i,n);return e.asyncQueue.enqueueAndForget(g(p().mark(function t(){return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=vs,t.next=3,Jc(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}},t)}))),function(){i.Tc(),e.asyncQueue.enqueueAndForget(g(p().mark(function t(){return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=ps,t.next=3,Jc(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}},t)})))}}(Ml(f),h,d)}function gh(e,t){return il(Ml(e=vl(e,Cl)),_l(t)?t:{next:t})}function kh(e,t){return function(e,t){var n=new X;return e.asyncQueue.enqueueAndForget(g(p().mark(function r(){return p().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=Ps,r.next=3,Yc(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}},r)}))),n.promise}(Ml(e),t)}function wh(e,t,n){var r=n.docs.get(t._key),i=new oh(e);return new Af(e,i,t._key,r,new _f(n.hasPendingWrites,n.fromCache),t.converter)}var xh=function(e){k(n,e);var t=x(n);function n(e,r){var i;return L(this,n),(i=t.call(this,e,r))._firestore=e,i}return M(n,[{key:"get",value:function(e){var t=this,r=ah(e,this._firestore),i=new oh(this._firestore);return s(T(n.prototype),"get",this).call(this,e).then(function(e){return new Af(t._firestore,i,r._key,e._document,new _f(!1,!1),r.converter)})}}]),n}(function(){function e(t,n){L(this,e),this._firestore=t,this._transaction=n,this._dataReader=af(t)}return M(e,[{key:"get",value:function(e){var t=this,n=ah(e,this._firestore),r=new rh(this._firestore);return this._transaction.lookup([n._key]).then(function(e){if(!e||1!==e.length)return z();var i=e[0];if(i.isFoundDocument())return new Tf(t._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Tf(t._firestore,r,n._key,null,n.converter);throw z()})}},{key:"set",value:function(e,t,n){var r=ah(e,this._firestore),i=nh(r.converter,t,n),a=uf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,a),this}},{key:"update",value:function(e,t,n){for(var r,i=ah(e,this._firestore),u=arguments.length,o=new Array(u>3?u-3:0),s=3;s<u;s++)o[s-3]=arguments[s];return r="string"==typeof(t=(0,a.getModularInstance)(t))||t instanceof Wl?vf(this._dataReader,"Transaction.update",i._key,t,n,o):df(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,r),this}},{key:"delete",value:function(e){var t=ah(e,this._firestore);return this._transaction.delete(t._key),this}}]),e}());function bh(e,t,n){e=vl(e,Cl);var r=Object.assign(Object.assign({},eh),n);return function(e){if(r.maxAttempts<1)throw new J(Y.INVALID_ARGUMENT,"Max attempts must be at least 1")}(),al(Ml(e),function(n){return t(new xh(e,n))},r)}function Ih(){return new of("deleteField")}function Eh(){return new cf("serverTimestamp")}function Th(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new lf("arrayUnion",t)}function Sh(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new ff("arrayRemove",t)}function Dh(e){return new hf("increment",e)}function _h(e){return Ml(e=vl(e,Cl)),new ih(e,function(t){return kh(e,t)})}function Ah(e,t){Ml(e=vl(e,Cl));var n="string"==typeof t?function(e){try{return JSON.parse(e)}catch(e){throw new J(Y.INVALID_ARGUMENT,"Failed to parse JSON:"+e.message)}}(t):t,r=[];if(Array.isArray(n.indexes)){var i,a=y(n.indexes);try{for(a.s();!(i=a.n()).done;){var u=i.value,o=Nh(u,"collectionGroup"),s=[];if(Array.isArray(u.fields)){var c,l=y(u.fields);try{for(l.s();!(c=l.n()).done;){var f=c.value,h=bf("setIndexConfiguration",Nh(f,"fieldPath"));"CONTAINS"===f.arrayConfig?s.push(new be(h,2)):"ASCENDING"===f.order?s.push(new be(h,0)):"DESCENDING"===f.order&&s.push(new be(h,1))}}catch(d){l.e(d)}finally{l.f()}}r.push(new ke(ke.UNKNOWN_ID,o,s,Ie.empty()))}}catch(d){a.e(d)}finally{a.f()}}return Promise.resolve()}function Nh(e,t){if("string"!=typeof e[t])throw new J(Y.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}exports.Transaction=xh,function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){F=e}(n.SDK_VERSION),(0,n._registerComponent)(new r.Component("firestore",function(e,n){var r=n.options,i=e.getProvider("app").getImmediate(),a=new Cl(i,new te(e.getProvider("auth-internal")),new ae(e.getProvider("app-check-internal")));return r=Object.assign({useFetchStreams:t},r),a._setSettings(r),a},"PUBLIC")),(0,n.registerVersion)(R,"3.4.10",e),(0,n.registerVersion)(R,"3.4.10","esm2017")}();
},{"@firebase/app":"h2Mb","@firebase/component":"vhY9","@firebase/logger":"JJem","@firebase/util":"chA2","@firebase/webchannel-wrapper":"qQDx","process":"pBGv"}],"vHL5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@firebase/firestore");Object.keys(e).forEach(function(r){"default"!==r&&"__esModule"!==r&&(r in exports&&exports[r]===e[r]||Object.defineProperty(exports,r,{enumerable:!0,get:function(){return e[r]}}))});
},{"@firebase/firestore":"lBbe"}],"OJEJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@firebase/app");Object.keys(e).forEach(function(r){"default"!==r&&"__esModule"!==r&&(r in exports&&exports[r]===e[r]||Object.defineProperty(exports,r,{enumerable:!0,get:function(){return e[r]}}))});var r="firebase",t="9.8.3";(0,e.registerVersion)(r,t,"app");
},{"@firebase/app":"h2Mb"}],"xNpv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FIREBASE_CONFIG=void 0;var e={apiKey:"AIzaSyBvi6hAC-oBI-LUUTO2CkbooYtjTX-8eCc",authDomain:"studiocontrol-98e5e.firebaseapp.com",projectId:"studiocontrol-98e5e",storageBucket:"studiocontrol-98e5e.appspot.com",messagingSenderId:"180109338218",appId:"1:180109338218:web:89b23d19f98ea0ff134c13",measurementId:"G-MRPP5CEXQ7"};exports.FIREBASE_CONFIG=e;
},{}],"SJVi":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("firebase/firestore"),r=require("firebase/app"),e=require("../constants/utilsConstants");function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(){o=function(){return t};var t={},r=Object.prototype,e=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function f(t,r,e){return Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{f({},"")}catch(P){f=function(t,r,e){return t[r]=e}}function s(t,r,e,n){var o=r&&r.prototype instanceof p?r:p,i=Object.create(o.prototype),a=new _(n||[]);return i._invoke=function(t,r,e){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return S()}for(e.method=o,e.arg=i;;){var a=e.delegate;if(a){var c=L(a,e);if(c){if(c===h)continue;return c}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===n)throw n="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);n="executing";var u=l(t,r,e);if("normal"===u.type){if(n=e.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:e.done}}"throw"===u.type&&(n="completed",e.method="throw",e.arg=u.arg)}}}(t,e,a),i}function l(t,r,e){try{return{type:"normal",arg:t.call(r,e)}}catch(P){return{type:"throw",arg:P}}}t.wrap=s;var h={};function p(){}function y(){}function v(){}var d={};f(d,a,function(){return this});var g=Object.getPrototypeOf,m=g&&g(g(j([])));m&&m!==r&&e.call(m,a)&&(d=m);var w=v.prototype=p.prototype=Object.create(d);function b(t){["next","throw","return"].forEach(function(r){f(t,r,function(t){return this._invoke(r,t)})})}function x(t,r){var o;this._invoke=function(i,a){function c(){return new r(function(o,c){!function o(i,a,c,u){var f=l(t[i],t,a);if("throw"!==f.type){var s=f.arg,h=s.value;return h&&"object"==n(h)&&e.call(h,"__await")?r.resolve(h.__await).then(function(t){o("next",t,c,u)},function(t){o("throw",t,c,u)}):r.resolve(h).then(function(t){s.value=t,c(s)},function(t){return o("throw",t,c,u)})}u(f.arg)}(i,a,o,c)})}return o=o?o.then(c,c):c()}}function L(t,r){var e=t.iterator[r.method];if(void 0===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,L(t,r),"throw"===r.method))return h;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var n=l(e,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,h;var o=n.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,h):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function E(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function O(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function j(t){if(t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function r(){for(;++n<t.length;)if(e.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=void 0,r.done=!0,r};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return y.prototype=v,f(w,"constructor",v),f(v,"constructor",y),y.displayName=f(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===y||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,f(t,u,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},b(x.prototype),f(x.prototype,c,function(){return this}),t.AsyncIterator=x,t.async=function(r,e,n,o,i){void 0===i&&(i=Promise);var a=new x(s(r,e,n,o),i);return t.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},b(w),f(w,u,"Generator"),f(w,a,function(){return this}),f(w,"toString",function(){return"[object Generator]"}),t.keys=function(t){var r=[];for(var e in t)r.push(e);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=j,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&e.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e,n){return a.type="throw",a.arg=t,r.next=e,n&&(r.method="next",r.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=e.call(i,"catchLoc"),u=e.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,r){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&e.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=r&&r<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=r,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),h},finish:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),O(e),h}},catch:function(t){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===t){var n=e.completion;if("throw"===n.type){var o=n.arg;O(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,e){return this.delegate={iterator:j(t),resultName:r,nextLoc:e},"next"===this.method&&(this.arg=void 0),h}},t}function i(t,r,e,n,o,i,a){try{var c=t[i](a),u=c.value}catch(f){return void e(f)}c.done?r(u):Promise.resolve(u).then(n,o)}function a(t){return function(){var r=this,e=arguments;return new Promise(function(n,o){var a=t.apply(r,e);function c(t){i(a,n,o,c,u,"next",t)}function u(t){i(a,n,o,c,u,"throw",t)}c(void 0)})}}function c(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function u(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function f(t,r,e){return r&&u(t.prototype,r),e&&u(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var l=function(){function n(){c(this,n),s(this,"app",(0,r.initializeApp)(e.FIREBASE_CONFIG)),s(this,"firebaseDB",(0,t.getFirestore)(this.app))}return f(n,[{key:"createOrder",value:function(){var r=a(o().mark(function r(e,n){var i;return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=(0,t.doc)(this.firebaseDB,"Orders",e),r.next=3,(0,t.setDoc)(i,n);case 3:case"end":return r.stop()}},r,this)}));return function(t,e){return r.apply(this,arguments)}}()}]),n}(),h=new l;exports.default=h;
},{"firebase/firestore":"vHL5","firebase/app":"OJEJ","../constants/utilsConstants":"xNpv"}],"wZfi":[function(require,module,exports) {
module.exports="/logo.67d56211.svg";
},{}],"SuKH":[function(require,module,exports) {

},{}],"RUu2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("../../constants/root"),n=r(require("../../utils/FirebaseManager")),t=r(require("./images/logo.svg"));function r(e){return e&&e.__esModule?e:{default:e}}function a(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function s(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,n,t){return n&&s(e.prototype,n),t&&s(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}require("./Form.css");var i=function(){function r(){a(this,r)}return c(r,[{key:"render",value:function(){var n='\n            <div class="wrapper">\n                <div class="service-container">\n                    <div class="service__modal">\n                        <div class="service__element">\n                            <span class="service__name">Сведение</span>\n                            <input class="service__item" type="radio" value="Сведение" name="service">\n                        </div>\n                        <div class="service__element">\n                            <span class="service__name">Запись</span>\n                            <input class="service__item" type="radio" value="Запись" name="service">\n                        </div>\n                    </div>\n                </div>\n                \n                <div class="title">\n                    <img src="'.concat(t.default,'" alt="">\n                    <h1>Studio Control</h1>\n                </div>\n            \n                <div class="form">\n                    <div class="form__element">\n                        <span class="form__span">Имя</span>\n                        <input type="text" class="form__input name" placeholder="Введите ваше имя">\n                    </div>\n                    <div class="form__element">\n                        <span class="form__span">Псевдоним</span>\n                        <input type="text" class="form__input nickname" placeholder="Введите ваш псевдоним">\n                    </div>\n                    <div class="form__element">\n                        <span class="form__span">Услуга</span>\n                        <input type="text" class="form__input service" placeholder="Введите услугу(сведение/запись)">\n                    </div>\n                    <div class="form__element">\n                        <span class="form__span">Контакт</span>\n                        <input type="text" class="form__input contact" placeholder="Введите ваш контакт">\n                    </div>\n                    <div class="form__element">\n                        <span class="form__span">Название трека</span>\n                        <input type="text" class="form__input track-name" placeholder="Введите название трека">\n                    </div>\n                    <div class="form__element">\n                        <span class="form__date">Введите дату</span>\n                        <input type="text" class="form__input date" placeholder="Введите дату">\n                    </div>\n                    <button class="form__button">Отправить</button>\n                </div>\n            </div>\n        ');e.ROOT_FORM.innerHTML=n,this.eventListener()}},{key:"eventListener",value:function(){document.querySelector(".service").addEventListener("click",this.showModal),document.querySelector(".form__button").addEventListener("click",this.createOrder)}},{key:"createOrder",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",t=e.length,r=0;r<length;r++)e.charAt(Math.floor(Math.random()*t));n.default.createOrder("result",{contact:document.querySelector(".contact").value,date:document.querySelector(".date").value,isDone:!1,name:document.querySelector(".name").value,nickname:document.querySelector(".nickname").value,price:"сведение"==document.querySelector(".service").value?50:35,service:document.querySelector(".service").value,track:document.querySelector(".track-name").value})}},{key:"showModal",value:function(){var e=document.querySelector(".service-container");e.style.display="flex",document.querySelectorAll(".service__item").forEach(function(n){n.addEventListener("click",function(){document.querySelector(".service").value=this.value,e.style.display="none"})})}}]),r}(),l=new i;exports.default=l;
},{"../../constants/root":"kqQd","../../utils/FirebaseManager":"SJVi","./images/logo.svg":"wZfi","./Form.css":"SuKH"}],"junt":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return e.default}});var e=r(require("./Form"));function r(e){return e&&e.__esModule?e:{default:e}}
},{"./Form":"RUu2"}],"lh5E":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("../Form"));function r(e){return e&&e.__esModule?e:{default:e}}function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function n(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}require("./App.css");var u=function(){function r(){t(this,r)}return o(r,[{key:"render",value:function(){e.default.render()}}]),r}(),a=new u;exports.default=a;
},{"../Form":"junt","./App.css":"SuKH"}],"ToZP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return e.default}});var e=t(require("./App"));function t(e){return e&&e.__esModule?e:{default:e}}
},{"./App":"lh5E"}],"uBxZ":[function(require,module,exports) {
"use strict";var e=n(require("./components/App"));function n(e){return e&&e.__esModule?e:{default:e}}function r(){e.default.render()}r();
},{"./components/App":"ToZP"}]},{},["uBxZ"], null)
//# sourceMappingURL=/src.d830ab79.js.map